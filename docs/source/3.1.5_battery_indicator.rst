.. note::

    Â¡Hola! Bienvenido a la comunidad de entusiastas de SunFounder para Raspberry Pi, Arduino y ESP32 en Facebook. SumÃ©rgete en el mundo de Raspberry Pi, Arduino y ESP32 junto a otros entusiastas.

    **Â¿Por quÃ© unirse?**

    - **Soporte de Expertos**: Resuelve problemas postventa y desafÃ­os tÃ©cnicos con ayuda de nuestra comunidad y equipo.
    - **Aprende y Comparte**: Intercambia consejos y tutoriales para mejorar tus habilidades.
    - **Avances Exclusivos**: Acceso anticipado a anuncios de nuevos productos y adelantos.
    - **Descuentos Especiales**: Disfruta de descuentos exclusivos en nuestros productos mÃ¡s recientes.
    - **Promociones Festivas y Sorteos**: Participa en sorteos y promociones especiales por temporadas.

    ğŸ‘‰ Â¿Listo para explorar y crear con nosotros? Haz clic en [|link_sf_facebook|] y Ãºnete hoy mismo.

3.1.5 Indicador de BaterÃ­a
================================

IntroducciÃ³n
-----------------

En este curso, crearemos un dispositivo indicador de baterÃ­a que puede 
mostrar visualmente el nivel de carga en una barra LED.

Componentes
------------

.. image:: img/list_Battery_Indicator.png
    :align: center

Diagrama de EsquemÃ¡tico
---------------------------

============ ======== ======== ===
T-Board Name physical wiringPi BCM
GPIO17       Pin 11   0        17
GPIO18       Pin 12   1        18
GPIO27       Pin 13   2        27
GPIO25       Pin 22   6        25
GPIO12       Pin 32   26       12
GPIO16       Pin 36   27       16
GPIO20       Pin 38   28       20
GPIO21       Pin 40   29       21
GPIO5        Pin 29   21       5
GPIO6        Pin 31   22       6
GPIO13       Pin 33   23       13
GPIO19       Pin 35   24       19
GPIO26       Pin 37   25       26
============ ======== ======== ===

.. image:: img/Schematic_three_one5.png
   :align: center

Procedimientos Experimentales
--------------------------------

**Paso 1:** Monta el circuito.

.. image:: img/image248.png
   :alt: indicador_bb
   :width: 800
   :align: center

**Para Usuarios de Lenguaje C**
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

**Paso 2:** DirÃ­gete a la carpeta del cÃ³digo.

.. raw:: html

   <run></run>

.. code-block:: 

    cd ~/davinci-kit-for-raspberry-pi/c/3.1.5/

**Paso 3:** Compila el cÃ³digo.

.. raw:: html

   <run></run>

.. code-block:: 

    gcc 3.1.5_BatteryIndicator.c -lwiringPi

**Paso 4:** Ejecuta el archivo.

.. raw:: html

   <run></run>

.. code-block:: 

    sudo ./a.out

Cuando el programa se ejecute, conecta el pin 3 del ADC0834 y el pin GND de 
forma separada, luego conÃ©ctalos a los dos polos de una baterÃ­a. Puedes ver 
que el LED correspondiente en la barra LED se enciende para mostrar el nivel 
de carga (rango de mediciÃ³n: 0-5V).

.. note::

    Si el programa no funciona despuÃ©s de ejecutarse, o aparece un error como: \"wiringPi.h: No such file or directory", consulta :ref:`C code is not working?`.

**ExplicaciÃ³n del CÃ³digo**

.. code-block:: c

    voidÂ LedBarGraph(intÂ value){
    Â Â Â Â for(intÂ i=0;i<10;i++){
    Â Â Â Â Â Â Â Â digitalWrite(pins[i],HIGH);
    Â Â Â Â }
    Â Â Â Â for(intÂ i=0;i<value;i++){
    Â Â Â Â Â Â Â Â digitalWrite(pins[i],LOW);
    Â Â Â Â }
    }

Esta funciÃ³n controla el encendido o apagado de los 10 LEDs en la barra 
LED. Primero, se establece un nivel alto en los LEDs para apagarlos, luego, 
se determina cuÃ¡ntos LEDs encender segÃºn el valor analÃ³gico recibido.

.. code-block:: c

    intÂ main(void)
    {
    Â Â Â Â ucharÂ analogVal;
    Â Â Â Â if(wiringPiSetup()Â ==Â -1){Â //whenÂ initializeÂ wiringÂ failed,printÂ messagetoÂ screen
    Â Â Â Â Â Â Â Â printf("setupÂ wiringPiÂ failedÂ !");
    Â Â Â Â Â Â Â Â returnÂ 1;
    Â Â Â Â }
    Â Â Â Â pinMode(ADC_CS,Â Â OUTPUT);
    Â Â Â Â pinMode(ADC_CLK,Â OUTPUT);
    Â Â Â Â for(intÂ i=0;i<10;i++){Â Â Â Â Â Â Â //makeÂ ledÂ pins'Â modeÂ isÂ output
    Â Â Â Â Â Â Â Â pinMode(pins[i],Â OUTPUT);
    Â Â Â Â Â Â Â Â digitalWrite(pins[i],HIGH);
    Â Â Â Â }
    Â Â Â Â while(1){
    Â Â Â Â Â Â Â Â analogValÂ =Â get_ADC_Result(0);
    Â Â Â Â Â Â Â Â LedBarGraph(analogVal/25);
    Â Â Â Â Â Â Â Â delay(100);
    Â Â Â Â }
    Â Â Â Â returnÂ 0;
    }

analogVal genera valores (**0-255**) segÃºn el voltaje (**0-5V**). Por ejemplo, 
si se detecta un voltaje de 3V en una baterÃ­a, el valor correspondiente de **152** 
se muestra en el voltÃ­metro.

Los **10** LEDs de la barra LED se utilizan para mostrar las lecturas de **analogVal**. 
255/10 = 25, asÃ­ que cada **25** unidades de valor analÃ³gico que aumentan, se enciende 
un LED adicional. Por ejemplo, si â€œanalogVal = 150â€ (aproximadamente 3V), se encienden 6 LEDs.

**Para Usuarios de Lenguaje Python**
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

**Paso 2:** DirÃ­gete a la carpeta del cÃ³digo.

.. raw:: html

   <run></run>

.. code-block::

    cd ~/davinci-kit-for-raspberry-pi/python/

**Paso 3:** Ejecuta el archivo.

.. raw:: html

   <run></run>

.. code-block::

    sudo python3 3.1.5_BatteryIndicator.py

Cuando el programa se ejecute, conecta el pin 3 del ADC0834 y el pin 
GND de forma separada, luego conÃ©ctalos a los dos polos de una baterÃ­a. 
PodrÃ¡s ver que el LED correspondiente en la barra LED se enciende para 
mostrar el nivel de carga (rango de mediciÃ³n: 0-5V).

**CÃ³digo**

.. note::

    Puedes **Modificar/Restablecer/Copiar/Ejecutar/Detener** el cÃ³digo a 
    continuaciÃ³n. Pero antes de hacerlo, debes ir a la ruta del cÃ³digo 
    fuente como ``davinci-kit-for-raspberry-pi/python``. 
    
.. raw:: html

    <run></run>

.. code-block:: python

    import RPi.GPIO as GPIO
    import ADC0834
    import time

    ledPins = [25, 12, 16, 20, 21, 5, 6, 13, 19, 26]

    def setup():
        GPIO.setmode(GPIO.BCM)
        ADC0834.setup()
        for i in ledPins:
            GPIO.setup(i, GPIO.OUT)
            GPIO.output(i, GPIO.HIGH)

    def LedBarGraph(value):
        for i in ledPins:
            GPIO.output(i,GPIO.HIGH)
        for i in range(value):
            GPIO.output(ledPins[i],GPIO.LOW)

    def destroy():
        GPIO.cleanup()

    def loop():
        while True:
            analogVal = ADC0834.getResult()
            LedBarGraph(int(analogVal/25))

    if __name__ == '__main__':
        setup()
        try:
            loop()
        except KeyboardInterrupt:  # Cuando se presiona 'Ctrl+C', se ejecutarÃ¡ destroy().
            destroy()

**ExplicaciÃ³n del CÃ³digo**

.. code-block:: python

    defÂ LedBarGraph(value):
    Â Â Â Â forÂ iÂ inÂ ledPins:
    Â Â Â Â Â Â Â Â GPIO.output(i,GPIO.HIGH)
    Â Â Â Â forÂ iÂ inÂ range(value):
    Â Â Â Â Â Â Â Â GPIO.output(ledPins[i],GPIO.LOW)

Esta funciÃ³n controla el encendido o apagado de los **10** LEDs en la 
barra de LED. Primero, se establece un nivel alto en los LEDs para 
apagarlos, y luego se decide cuÃ¡ntos LEDs se encenderÃ¡n cambiando el 
valor analÃ³gico recibido.

.. code-block:: python

    defÂ loop():
    Â Â Â Â whileÂ True:
    Â Â Â Â Â Â Â Â analogValÂ =Â ADC0834.getResult()
    Â Â Â Â Â Â Â Â LedBarGraph(int(analogVal/25))

analogVal genera valores (**0-255**) segÃºn el voltaje (**0-5V**). 
Por ejemplo, si se detecta un voltaje de 3V en una baterÃ­a, el valor 
correspondiente de **152** se muestra en el voltÃ­metro.

Los **10** LEDs de la barra se utilizan para mostrar las lecturas de 
**analogVal**. 255/10 = 25, por lo tanto, cada vez que el valor analÃ³gico 
aumenta en **25**, se enciende un LED adicional. Por ejemplo, si â€œanalogVal=150â€ 
(aproximadamente 3V), se encienden 6 LEDs.

Imagen del FenÃ³meno
----------------------

.. image:: img/image249.jpeg
   :align: center
