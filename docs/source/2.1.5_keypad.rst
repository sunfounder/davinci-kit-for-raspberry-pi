.. note::

    ã“ã‚“ã«ã¡ã¯ã€SunFounderã®Raspberry Pi & Arduino & ESP32æ„›å¥½å®¶ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ã¸ã‚ˆã†ã“ãï¼Facebookä¸Šã§Raspberry Piã€Arduinoã€ESP32ã«ã¤ã„ã¦ã‚‚ã£ã¨æ·±ãæ˜ã‚Šä¸‹ã’ã€ä»–ã®æ„›å¥½å®¶ã¨äº¤æµã—ã¾ã—ã‚‡ã†ã€‚

    **å‚åŠ ã™ã‚‹ç†ç”±ã¯ï¼Ÿ**

    - **ã‚¨ã‚­ã‚¹ãƒ‘ãƒ¼ãƒˆã‚µãƒãƒ¼ãƒˆ**ï¼šã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ã‚„ãƒãƒ¼ãƒ ã®åŠ©ã‘ã‚’å€Ÿã‚Šã¦ã€è²©å£²å¾Œã®å•é¡Œã‚„æŠ€è¡“çš„ãªèª²é¡Œã‚’è§£æ±ºã—ã¾ã™ã€‚
    - **å­¦ã³ï¼†å…±æœ‰**ï¼šãƒ’ãƒ³ãƒˆã‚„ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã‚’äº¤æ›ã—ã¦ã‚¹ã‚­ãƒ«ã‚’å‘ä¸Šã•ã›ã¾ã—ã‚‡ã†ã€‚
    - **ç‹¬å çš„ãªãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼**ï¼šæ–°è£½å“ã®ç™ºè¡¨ã‚„å…ˆè¡Œãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã«æ—©æœŸã‚¢ã‚¯ã‚»ã‚¹ã—ã¾ã—ã‚‡ã†ã€‚
    - **ç‰¹åˆ¥å‰²å¼•**ï¼šæœ€æ–°è£½å“ã®ç‹¬å å‰²å¼•ã‚’ãŠæ¥½ã—ã¿ãã ã•ã„ã€‚
    - **ç¥­ã‚Šã®ãƒ—ãƒ­ãƒ¢ãƒ¼ã‚·ãƒ§ãƒ³ã¨ã‚®ãƒ•ãƒˆ**ï¼šã‚®ãƒ•ãƒˆã‚„ç¥æ—¥ã®ãƒ—ãƒ­ãƒ¢ãƒ¼ã‚·ãƒ§ãƒ³ã«å‚åŠ ã—ã¾ã—ã‚‡ã†ã€‚

    ğŸ‘‰ ç§ãŸã¡ã¨ä¸€ç·’ã«æ¢ç´¢ã—ã€å‰µé€ ã™ã‚‹æº–å‚™ã¯ã§ãã¦ã„ã¾ã™ã‹ï¼Ÿ[|link_sf_facebook|]ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ä»Šã™ãå‚åŠ ã—ã¾ã—ã‚‡ã†ï¼

.. _py_keypad:

2.1.5 ã‚­ãƒ¼ãƒ‘ãƒƒãƒ‰
=================

å‰æ›¸ã
------------

ã‚­ãƒ¼ãƒ‘ãƒƒãƒ‰ã¯ã€ãƒœã‚¿ãƒ³ã®é•·æ–¹å½¢ã®é…åˆ—ã§ã‚ã‚‹ã€‚ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã¯ã€å…¥åŠ›æ–‡å­—ã‚’ä½¿ç”¨ã™ã‚‹ã€‚

éƒ¨å“
----------

.. image:: media/list_2.1.5_keypad.png


åŸç†
---------

**ã‚­ãƒ¼ãƒ‘ãƒƒãƒ‰**

ã‚­ãƒ¼ãƒ‘ãƒƒãƒ‰ã¯12å€‹ã¾ãŸã¯16å€‹ã®OFF-ï¼ˆONï¼‰ãƒœã‚¿ãƒ³ã®é•·æ–¹å½¢é…åˆ—ã§ã‚ã‚‹ã€‚
ãƒªãƒœãƒ³ã‚±ãƒ¼ãƒ–ãƒ«ã¨ã®æ¥ç¶šã¾ãŸã¯ãƒ—ãƒªãƒ³ãƒˆåŸºæ¿ã¸ã®æŒ¿å…¥ã«é©ã—ãŸãƒ˜ãƒƒãƒ€ãƒ¼ã‚’ä»‹ã—ã¦ãã‚Œã‚‰ã®æ¥ç‚¹ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã€‚
ä¸€éƒ¨ã®ã‚­ãƒ¼ãƒ‘ãƒƒãƒ‰ã§ã¯ã€
å„ãƒœã‚¿ãƒ³ã¯ãƒ˜ãƒƒãƒ€ãƒ¼ã®å€‹åˆ¥ã®é€£çµ¡å…ˆã«æ¥ç¶šã•ã‚Œã‚‹ãŒã€ã™ã¹ã¦ã®ãƒœã‚¿ãƒ³ã¯å…±é€šã®æ¥åœ°ã‚’å…±æœ‰ã™ã‚‹ã€‚

.. image:: media/image314.png


å¤šãã®å ´åˆã€ãƒœã‚¿ãƒ³ã¯ãƒãƒˆãƒªãƒƒã‚¯ã‚¹ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã•ã‚Œã¦ã„ã‚‹ã€‚
ã¤ã¾ã‚Šã€å„ãƒœã‚¿ãƒ³ã¯ãƒãƒˆãƒªãƒƒã‚¯ã‚¹å†…ã®ä¸€æ„ã®ã‚³ãƒ³ãƒ€ã‚¯ã‚¿ãƒ¼ãƒšã‚¢ã‚’ãƒ–ãƒªãƒƒã‚¸ã—ã¦ã„ã‚‹ã€‚
ã“ã®æ§‹æˆã¯ã€ãƒã‚¤ã‚¯ãƒ­ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ã«ã‚ˆã‚‹ãƒãƒ¼ãƒªãƒ³ã‚°ã«é©ã—ã€
4æœ¬ã®æ°´å¹³ç·šã®ãã‚Œãã‚Œã«é †ç•ªã«å‡ºåŠ›ãƒ‘ãƒ«ã‚¹ã‚’é€ä¿¡ã™ã‚‹ã‚ˆã†ã«ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã§ãã‚‹ã€‚
å„ãƒ‘ãƒ«ã‚¹ä¸­ã«ã€æ®‹ã‚Šã®4æœ¬ã®å‚ç›´ãƒ¯ã‚¤ãƒ¤ã‚’é †ç•ªã«ãƒã‚§ãƒƒã‚¯ã—ã¦ã€ä¿¡å·ã‚’ä¼é€ã—ã¦ã„ã‚‹ã®ãŒã©ã‚Œã‹ã‚’åˆ¤æ–­ã™ã‚‹ã€‚
ä¿¡å·ãŒå­˜åœ¨ã—ãªã„å ´åˆã«ãƒã‚¤ã‚¯ãƒ­ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ã®å…¥åŠ›ãŒäºˆæœŸã—ãªã„å‹•ä½œã‚’ã™ã‚‹ã“ã¨ã‚’é˜²ããŸã‚ã€
å…¥åŠ›ãƒ¯ã‚¤ãƒ¤ã«ãƒ—ãƒ«ã‚¢ãƒƒãƒ—ã¾ãŸã¯ãƒ—ãƒ«ãƒ€ã‚¦ãƒ³æŠµæŠ—ã‚’è¿½åŠ ã—ã¦ãã ã•ã„ã€‚

å›è·¯å›³
-----------------

.. image:: media/image315.png


.. image:: media/image316.png


å®Ÿé¨“æ‰‹é †
-----------------------

ã‚¹ãƒ†ãƒƒãƒ—1ï¼š å›è·¯ã‚’ä½œã‚‹ã€‚

.. image:: media/image186.png
    :width: 800



Cè¨€èªãƒ¦ãƒ¼ã‚¶ãƒ¼å‘ã‘
^^^^^^^^^^^^^^^^^^^^^^

ã‚¹ãƒ†ãƒƒãƒ—2ï¼š ã‚³ãƒ¼ãƒ‰ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é–‹ãã€‚

.. raw:: html

   <run></run>

.. code-block::

    cd ~/davinci-kit-for-raspberry-pi/c/2.1.5/

ã‚¹ãƒ†ãƒƒãƒ—3ï¼š ã‚³ãƒ¼ãƒ‰ã‚’ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã™ã‚‹ã€‚

.. raw:: html

   <run></run>

.. code-block::

    gcc 2.1.5_Keypad.cpp -lwiringPi

ã‚¹ãƒ†ãƒƒãƒ—4ï¼š å®Ÿè¡Œã™ã‚‹ã€‚

.. raw:: html

   <run></run>

.. code-block::

    sudo ./a.out

ã‚³ãƒ¼ãƒ‰ã®å®Ÿè¡Œå¾Œã€ã‚­ãƒ¼ãƒ‘ãƒƒãƒ‰ã§æŠ¼ã•ã‚ŒãŸãƒœã‚¿ãƒ³ã®å€¤ï¼ˆãƒœã‚¿ãƒ³å€¤ï¼‰ãŒç”»é¢ã«ãƒ—ãƒªãƒ³ãƒˆã•ã‚Œã‚‹ã€‚

**ã‚³ãƒ¼ãƒ‰**

.. code-block:: c

    #include <wiringPi.h>
    #include <stdio.h>

    #define ROWS  4 
    #define COLS  4
    #define BUTTON_NUM (ROWS * COLS)

    unsigned char KEYS[BUTTON_NUM] {  
    '1','2','3','A',
    '4','5','6','B',
    '7','8','9','C',
    '*','0','#','D'};

    unsigned char rowPins[ROWS] = {1, 4, 5, 6}; 
    unsigned char colPins[COLS] = {12, 3, 2, 0};

    void keyRead(unsigned char* result);
    bool keyCompare(unsigned char* a, unsigned char* b);
    void keyCopy(unsigned char* a, unsigned char* b);
    void keyPrint(unsigned char* a);
    void keyClear(unsigned char* a);
    int keyIndexOf(const char value);

    void init(void) {
        for(int i=0 ; i<4 ; i++) {
            pinMode(rowPins[i], OUTPUT);
            pinMode(colPins[i], INPUT);
        }
    }

    int main(void){
        unsigned char pressed_keys[BUTTON_NUM];
        unsigned char last_key_pressed[BUTTON_NUM];

        if(wiringPiSetup() == -1){ //when initialize wiring failed,print message to screen
            printf("setup wiringPi failed !");
            return 1; 
        }
        init();
        while(1){
            keyRead(pressed_keys);
            bool comp = keyCompare(pressed_keys, last_key_pressed);
            if (!comp){
                keyPrint(pressed_keys);
                keyCopy(last_key_pressed, pressed_keys);
            }
            delay(100);
        }
        return 0;  
    }

    void keyRead(unsigned char* result){
        int index;
        int count = 0;
        keyClear(result);
        for(int i=0 ; i<ROWS ; i++ ){
            digitalWrite(rowPins[i], HIGH);
            for(int j =0 ; j < COLS ; j++){
                index = i * ROWS + j;
                if(digitalRead(colPins[j]) == 1){
                    result[count]=KEYS[index];
                    count += 1;
                }
            }
            delay(1);
            digitalWrite(rowPins[i], LOW);
        }
    }

    bool keyCompare(unsigned char* a, unsigned char* b){
        for (int i=0; i<BUTTON_NUM; i++){
            if (a[i] != b[i]){
                return false;
            }
        }
        return true;
    }

    void keyCopy(unsigned char* a, unsigned char* b){
        for (int i=0; i<BUTTON_NUM; i++){
            a[i] = b[i];
        }
    }

    void keyPrint(unsigned char* a){
        if (a[0] != 0){
            printf("%c",a[0]);
        }
        for (int i=1; i<BUTTON_NUM; i++){
            if (a[i] != 0){
                printf(", %c",a[i]);
            }
        }
        printf("\n");
    }

    void keyClear(unsigned char* a){
        for (int i=0; i<BUTTON_NUM; i++){
            a[i] = 0;
        }
    }

    int keyIndexOf(const char value){
        for (int i=0; i<BUTTON_NUM; i++){
            if ((const char)KEYS[i] == value){
                return i;
            }
        }
        return -1;
    }

**ã‚³ãƒ¼ãƒ‰ã®èª¬æ˜**

.. code-block:: c

    unsigned char KEYS[BUTTON_NUM] {  
    '1','2','3','A',
    '4','5','6','B',
    '7','8','9','C',
    '*','0','#','D'};

    unsigned char rowPins[ROWS] = {1, 4, 5, 6}; 
    unsigned char colPins[COLS] = {12, 3, 2, 0};

ãƒãƒˆãƒªãƒƒã‚¯ã‚¹ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã®å„ã‚­ãƒ¼ã‚’é…åˆ— ``keys[]`` ã«è¡¨ç¤ºã—ã€å„è¡Œã¨åˆ—ã«ãƒ”ãƒ³ã‚’å®šç¾©ã™ã‚‹ã€‚

.. code-block:: c

    while(1){
            keyRead(pressed_keys);
            bool comp = keyCompare(pressed_keys, last_key_pressed);
            if (!comp){
                keyPrint(pressed_keys);
                keyCopy(last_key_pressed, pressed_keys);
            }
            delay(100);
        }



ã“ã‚Œã¯ã€ãƒœã‚¿ãƒ³å€¤ã‚’èª­ã¿å–ã‚Šã€ãƒ—ãƒªãƒ³ãƒˆã™ã‚‹ãƒ¡ã‚¤ãƒ³é–¢æ•°ã®ä¸€éƒ¨ã§ã‚ã‚‹ã€‚

é–¢æ•° ``keyRead()`` ã¯ã€ã™ã¹ã¦ã®ãƒœã‚¿ãƒ³ã®çŠ¶æ…‹ã‚’èª­ã¿å–ã‚‹ã€‚

``KeyCompare()`` ã¨ ``keyCopy()`` ã¯ã€ãƒœã‚¿ãƒ³ã®çŠ¶æ…‹ãŒå¤‰åŒ–ã—ãŸã‹ã©ã†ã‹ï¼ˆã¤ã¾ã‚Šã€ãƒœã‚¿ãƒ³ãŒæŠ¼ã•ã‚ŒãŸã‹é›¢ã•ã‚ŒãŸã‹ï¼‰ã‚’åˆ¤æ–­ã™ã‚‹ãŸã‚ã«ä½¿ç”¨ã•ã‚Œã‚‹ã€‚

``keyPrint()`` ã¯ç¾åœ¨ã®ãƒ¬ãƒ™ãƒ«ãŒé«˜ãƒ¬ãƒ™ãƒ«ï¼ˆãƒœã‚¿ãƒ³ãŒæŠ¼ã•ã‚Œã¦ã„ã‚‹ï¼‰ã®ãƒœã‚¿ãƒ³ã®ãƒœã‚¿ãƒ³å€¤ã‚’ãƒ—ãƒªãƒ³ãƒˆã™ã‚‹ã€‚

.. code-block:: c

    void keyRead(unsigned char* result){
        int index;
        int count = 0;
        keyClear(result);
        for(int i=0 ; i<ROWS ; i++ ){
            digitalWrite(rowPins[i], HIGH);
            for(int j =0 ; j < COLS ; j++){
                index = i * ROWS + j;
                if(digitalRead(colPins[j]) == 1){
                    result[count]=KEYS[index];
                    count += 1;
                }
            }
            delay(1);
            digitalWrite(rowPins[i], LOW);
        }
    }

ã“ã®é–¢æ•°ã¯å„è¡Œã«é †ç•ªã«é«˜ãƒ¬ãƒ™ãƒ«ã‚’å‰²ã‚Šå½“ã¦ã€åˆ—ã®ã‚­ãƒ¼ãŒæŠ¼ã•ã‚Œã‚‹ã¨ã€
ã‚­ãƒ¼ãŒé…ç½®ã•ã‚Œã¦ã„ã‚‹åˆ—ãŒé«˜ãƒ¬ãƒ™ãƒ«ã«ãªã‚‹ã€‚two- layer loopã®åˆ¤å®šå¾Œã€
ã‚­ãƒ¼çŠ¶æ…‹ã®ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã«ã‚ˆã‚Šé…åˆ—ï¼ˆ ``reasult[]`` ï¼‰ãŒç”Ÿæˆã•ã‚Œã‚‹ã€‚

ãƒœã‚¿ãƒ³3ã‚’æŠ¼ã™ã¨ãï¼š

.. image:: media/image187.png


``RowPin[0]`` ã¯é«˜ãƒ¬ãƒ™ãƒ«ã§æ›¸ãè¾¼ã¿ã€
``colPin[2]`` ã¯é«˜ãƒ¬ãƒ™ãƒ«ã«ãªã‚‹ã€‚
``ColPin[0]`` ã€ ``colPin[1]`` ã€ ``colPin[3]`` ã¯ä½ãƒ¬ãƒ™ãƒ«ã«ãªã‚‹ã€‚

ã“ã‚Œã«ã‚ˆã‚Šã€ ``0,0,1,0`` ãŒå¾—ã‚‰ã‚Œã‚‹ã€‚ ``rowPin[1]`` ã€ ``rowPin[2]`` ã€ ``rowPin[3]`` ãŒé«˜ãƒ¬ãƒ™ãƒ«ã§æ›¸ãè¾¼ã¾ã‚Œã‚‹ã¨ã€
``colPin[0]`` ã€œ ``colPin[4]`` ã¯ä½ãƒ¬ãƒ™ãƒ«ã«ãªã‚‹ã€‚

ãƒ«ãƒ¼ãƒ—åˆ¤å®šãŒå®Œäº†ã™ã‚‹ã¨ã€é…åˆ—ãŒç”Ÿæˆã•ã‚Œã‚‹ï¼š

.. code-block:: c

    result[BUTTON_NUM] {  
    0, 0, 1, 0,
    0, 0, 0, 0,
    0, 0, 0, 0,
    0, 0, 0, 0};

.. code-block:: c

    bool keyCompare(unsigned char* a, unsigned char* b){
        for (int i=0; i<BUTTON_NUM; i++){
            if (a[i] != b[i]){
                return false;
            }
        }
        return true;
    }

    void keyCopy(unsigned char* a, unsigned char* b){
        for (int i=0; i<BUTTON_NUM; i++){
            a[i] = b[i];
        }
    }


ã“ã‚Œã‚‰äºŒã¤ã®é–¢æ•°ã¯ã€ã‚­ãƒ¼ã®çŠ¶æ…‹ãŒå¤‰åŒ–ã—ãŸã‹ã©ã†ã‹ã‚’åˆ¤æ–­ã™ã‚‹ãŸã‚ã«ä½¿ç”¨ã•ã‚Œã€ãŸã¨ãˆã°ã€
ã€Œ3ã€ã¾ãŸã¯ã€Œ2ã€ã‚’æŠ¼ã—ãŸã¨ãã«æ‰‹ã‚’é›¢ã™ã¨ã€ ``keyCompare()`` ã¯falseã‚’è¿”ã™ã€‚

``KeyCopy() ``ã¯ãã‚Œãã‚Œã®æ¯”è¼ƒå¾Œã«é…åˆ—ï¼ˆ ``last_key_pressed[BUTTON_NUM]`` ï¼‰
ã®ç¾åœ¨ã®ãƒœã‚¿ãƒ³å€¤ã‚’æ›¸ãæ›ãˆã‚‹ãŸã‚ã«ä½¿ç”¨ã•ã‚Œã‚‹ã€‚ã§ã™ã‹ã‚‰æ¬¡å›ã«ãã‚Œã‚‰ã‚’æ¯”è¼ƒã§ãã‚‹ã€‚

.. code-block:: c

    void keyPrint(unsigned char* a){
    //printf("{");
        if (a[0] != 0){
            printf("%c",a[0]);
        }
        for (int i=1; i<BUTTON_NUM; i++){
            if (a[i] != 0){
                printf(", %c",a[i]);
            }
        }
        printf("\n");
    }

ã“ã®é–¢æ•°ã¯ç¾åœ¨æŠ¼ã•ã‚Œã¦ã„ã‚‹ãƒœã‚¿ãƒ³ã®å€¤ã‚’ãƒ—ãƒªãƒ³ãƒˆã™ã‚‹ãŸã‚ã«ä½¿ç”¨ã•ã‚Œã‚‹ã€‚
ã€Œ1ã€ãƒœã‚¿ãƒ³ã‚’æŠ¼ã™ã¨ã€ã€Œ1ã€ãŒãƒ—ãƒªãƒ³ãƒˆã•ã‚Œã‚‹ã€‚
ãƒœã‚¿ãƒ³ã€Œ1ã€ã¨ã€Œ3ã€ãŒæŠ¼ã•ã‚Œã‚‹ã¨ã€ã€Œ1ã€3ã€ãŒãƒ—ãƒªãƒ³ãƒˆã•ã‚Œã‚‹ã€‚

Pythonè¨€èªãƒ¦ãƒ¼ã‚¶ãƒ¼å‘ã‘
^^^^^^^^^^^^^^^^^^^^^^^^^

ã‚¹ãƒ†ãƒƒãƒ—2ï¼š ã‚³ãƒ¼ãƒ‰ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é–‹ãã€‚

.. raw:: html

   <run></run>

.. code-block:: 

    cd ~/davinci-kit-for-raspberry-pi/python/

ã‚¹ãƒ†ãƒƒãƒ—3ï¼š å®Ÿè¡Œã™ã‚‹ã€‚

.. raw:: html

   <run></run>

.. code-block:: 

    sudo python3 2.1.5_Keypad.py

ã‚³ãƒ¼ãƒ‰ã®å®Ÿè¡Œå¾Œã€ã‚­ãƒ¼ãƒ‘ãƒƒãƒ‰ã§æŠ¼ã•ã‚ŒãŸãƒœã‚¿ãƒ³ã®å€¤ï¼ˆãƒœã‚¿ãƒ³å€¤ï¼‰ãŒç”»é¢ã«ãƒ—ãƒªãƒ³ãƒˆã•ã‚Œã‚‹ã€‚



**ã‚³ãƒ¼ãƒ‰**


.. note::

   ä»¥ä¸‹ã®ã‚³ãƒ¼ãƒ‰ã‚’ **å¤‰æ›´/ãƒªã‚»ãƒƒãƒˆ/ã‚³ãƒ”ãƒ¼/å®Ÿè¡Œ/åœæ­¢** ã§ãã¾ã™ã€‚ ãŸã ã—ã€ãã®å‰ã«ã€ ``davinci-kit-for-raspberry-pi/python`` ã®ã‚ˆã†ãªã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ãƒ‘ã‚¹ã«ç§»å‹•ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ 
    
.. raw:: html

    <run></run>

.. code-block:: python

    import RPi.GPIO as GPIO
    import time

    class Keypad():

        def __init__(self, rowsPins, colsPins, keys):
            self.rowsPins = rowsPins
            self.colsPins = colsPins
            self.keys = keys
            GPIO.setwarnings(False)
            GPIO.setmode(GPIO.BCM)
            GPIO.setup(self.rowsPins, GPIO.OUT, initial=GPIO.LOW)
            GPIO.setup(self.colsPins, GPIO.IN, pull_up_down=GPIO.PUD_DOWN)

        def read(self):
            pressed_keys = []
            for i, row in enumerate(self.rowsPins):
                GPIO.output(row, GPIO.HIGH)
                for j, col in enumerate(self.colsPins):
                    index = i * len(self.colsPins) + j
                    if (GPIO.input(col) == 1):
                        pressed_keys.append(self.keys[index])
                GPIO.output(row, GPIO.LOW)
            return pressed_keys

    def setup():
        global keypad, last_key_pressed
        rowsPins = [18,23,24,25]
        colsPins = [10,22,27,17]
        keys = ["1","2","3","A",
                "4","5","6","B",
                "7","8","9","C",
                "*","0","#","D"]
        keypad = Keypad(rowsPins, colsPins, keys)
        last_key_pressed = []

    def loop():
        global keypad, last_key_pressed
        pressed_keys = keypad.read()
        if len(pressed_keys) != 0 and last_key_pressed != pressed_keys:
            print(pressed_keys)
        last_key_pressed = pressed_keys
        time.sleep(0.1)

    # Define a destroy function for clean up everything after the script finished
    def destroy():
        # Release resource
        GPIO.cleanup() 

    if __name__ == '__main__':     # Program start from here
        try:
            setup()
            while True:
                loop()
        except KeyboardInterrupt:   # When 'Ctrl+C' is pressed, the program destroy() will be executed.
            destroy()

**ã‚³ãƒ¼ãƒ‰ã®èª¬æ˜**

.. code-block:: python

    def setup():
        global keypad, last_key_pressed
        rowsPins = [18,23,24,25]
        colsPins = [10,22,27,17]
        keys = ["1","2","3","A",
                "4","5","6","B",
                "7","8","9","C",
                "*","0","#","D"]
        keypad = Keypad(rowsPins, colsPins, keys)
        last_key_pressed = []

ãƒãƒˆãƒªãƒƒã‚¯ã‚¹ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã®å„ã‚­ãƒ¼ã‚’é…åˆ— ``keys[]`` ã«è¡¨ç¤ºã—ã€å„è¡Œã¨åˆ—ã«ãƒ”ãƒ³ã‚’å®šç¾©ã™ã‚‹ã€‚

.. code-block:: python

    def loop():
        global keypad, last_key_pressed
        pressed_keys = keypad.read()
        if len(pressed_keys) != 0 and last_key_pressed != pressed_keys:
            print(pressed_keys)
        last_key_pressed = pressed_keys
        time.sleep(0.1)

ã“ã‚Œã¯ã€ãƒœã‚¿ãƒ³å€¤ã‚’èª­ã¿å–ã‚Šã€ãƒ—ãƒªãƒ³ãƒˆã™ã‚‹ãƒ¡ã‚¤ãƒ³é–¢æ•°ã®ä¸€éƒ¨ã§ã‚ã‚‹ã€‚

é–¢æ•° ``keyRead()`` ã¯ã€ã™ã¹ã¦ã®ãƒœã‚¿ãƒ³ã®çŠ¶æ…‹ã‚’èª­ã¿å–ã‚‹ã€‚

``if len(pressed_keys)!= 0`` ã¨ ``last_key_pressed != Pressed_keys`` ã®ã‚¹ãƒ†ãƒ¼ãƒˆãƒ¡ãƒ³ãƒˆã¯ã€

ã‚­ãƒ¼ãŒæŠ¼ã•ã‚ŒãŸã‹ã©ã†ã‹ã€æŠ¼ã•ã‚ŒãŸãƒœã‚¿ãƒ³ã®çŠ¶æ…‹ã‚’åˆ¤æ–­ã™ã‚‹ãŸã‚ã«ä½¿ç”¨ã•ã‚Œã‚‹ã€‚ï¼ˆã€Œ1ã€ã‚’æŠ¼ã—ãŸã¨ãã«ã€Œ3ã€ã‚’æŠ¼ã—ãŸå ´åˆã€åˆ¤æ–­ã¯å—ã‘å…¥ã‚Œã‚‰ã‚Œã‚‹ã€‚ï¼‰

æ¡ä»¶ãŒä¸»å¼µã§ãã‚‹å ´åˆã€ç¾åœ¨æŠ¼ã•ã‚Œã¦ã„ã‚‹ã‚­ãƒ¼ã®å€¤ã‚’ãƒ—ãƒªãƒ³ãƒˆã™ã‚‹ã€‚

ã‚¹ãƒ†ãƒ¼ãƒˆãƒ¡ãƒ³ãƒˆ ``last_key_pressed = pressed_keys`` ã¯ã€ãã‚Œãã‚Œã®åˆ¤æ–­ã®çŠ¶æ…‹ã‚’é…åˆ— ``last_key_pressed`` ã«å‰²ã‚Šå½“ã¦ã€æ¬¡ã®æ¡ä»¶åˆ¤æ–­ã‚’å®¹æ˜“ã«ã™ã‚‹ã€‚

.. code-block:: python

    def read(self):
            pressed_keys = []
            for i, row in enumerate(self.rowsPins):
                GPIO.output(row, GPIO.HIGH)
                for j, col in enumerate(self.colsPins):
                    index = i * len(self.colsPins) + j
                    if (GPIO.input(col) == 1):
                        pressed_keys.append(self.keys[index])
                GPIO.output(row, GPIO.LOW)
            return pressed_keys

ã“ã®é–¢æ•°ã¯å„è¡Œã«é †ç•ªã«é«˜ãƒ¬ãƒ™ãƒ«ã‚’å‰²ã‚Šå½“ã¦ã€åˆ—ã®ãƒœã‚¿ãƒ³ãŒæŠ¼ã•ã‚Œã‚‹ã¨ã€
ã‚­ãƒ¼ãŒé…ç½®ã•ã‚Œã¦ã„ã‚‹åˆ—ãŒé«˜ãƒ¬ãƒ™ãƒ«ã«ãªã‚‹ã€‚
2å±¤ãƒ«ãƒ¼ãƒ—ãŒåˆ¤å®šã•ã‚ŒãŸå¾Œã€çŠ¶æ…‹ãŒ1ã®ãƒœã‚¿ãƒ³ã®å€¤ã¯ã€ ``pressed_keys`` é…åˆ—ã«ä¿å­˜ã•ã‚Œã‚‹ã€‚

ã‚­ãƒ¼ã€Œ3ã€ã‚’æŠ¼ã™ã¨ï¼š

.. image:: media/image187.png


``rowPins[0]`` ã¯é«˜ãƒ¬ãƒ™ãƒ«ã§æ›¸ãè¾¼ã¾ã‚Œã€ ``colPins[2]`` ã¯é«˜ãƒ¬ãƒ™ãƒ«ã«ãªã‚Šã€‚

``colPins[0]`` ã€ ``colPins[1]`` ã€ ``colPins[3]`` ã¯ä½ãƒ¬ãƒ™ãƒ«ã«ãªã‚‹ã€‚

4ã¤ã®çŠ¶æ…‹ãŒã‚ã‚‹ï¼š ``0ã€0ã€1ã€0`` ã€‚ãã—ã¦ã€ ``pressed_keys`` ã«ã€Œ3ã€ã‚’æ›¸ãè¾¼ã‚€ã€‚

``rowPins[1]`` ã€ ``rowPins[2]`` ã€ ``rowPins[3]`` ãŒé«˜ãƒ¬ãƒ™ãƒ«ã«æ›¸ãè¾¼ã¾ã‚Œã‚‹ã¨ã€ ``colPins[0]`` ã€œ ``colPins[4]`` ã¯ä½ãƒ¬ãƒ™ãƒ«ã«ãªã‚‹ã€‚

ãƒ«ãƒ¼ãƒ—ãŒåœæ­¢ã—ã€ ``pressed_keys = '3'`` ãŒè¿”ã•ã‚Œã‚‹ã€‚

ãƒœã‚¿ãƒ³ã€Œ1ã€ã¨ã€Œ3ã€ã‚’æŠ¼ã™ã¨ã€ ``pressed_keys =['1'ã€'3']`` ãŒè¿”ã•ã‚Œã‚‹ã€‚

ç¾è±¡ç”»åƒ
------------------

.. image:: media/image188.jpeg


