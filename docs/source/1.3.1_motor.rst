.. note::

    隆Hola! Bienvenido a la Comunidad de Entusiastas de SunFounder Raspberry Pi, Arduino y ESP32 en Facebook. Sum茅rgete en el mundo de Raspberry Pi, Arduino y ESP32 junto a otros entusiastas.

    **驴Por qu茅 unirse?**

    - **Soporte experto**: Resuelve problemas t茅cnicos y de postventa con la ayuda de nuestra comunidad y equipo.
    - **Aprende y comparte**: Intercambia consejos y tutoriales para mejorar tus habilidades.
    - **Preestrenos exclusivos**: Obt茅n acceso anticipado a nuevos anuncios de productos y adelantos.
    - **Descuentos especiales**: Disfruta de descuentos exclusivos en nuestros productos m谩s recientes.
    - **Promociones y sorteos festivos**: Participa en sorteos y promociones especiales de temporada.

     驴Listo para explorar y crear con nosotros? Haz clic en [|link_sf_facebook|] y 煤nete hoy.

1.3.1 Motor
=============

Introducci贸n
------------

En esta lecci贸n, aprenderemos a usar el L293D para controlar un motor de 
corriente continua (DC) y hacer que gire en sentido horario y antihorario. 
Como el motor DC requiere una corriente mayor, utilizaremos el m贸dulo de 
alimentaci贸n para proporcionar energ铆a al motor de forma segura.

Componentes
-------------

.. image:: img/list_1.3.1.png

Principio
-----------

**L293D**

El L293D es un chip controlador de motores de 4 canales que soporta altos 
voltajes y corrientes elevadas. Est谩 dise帽ado para conectarse a niveles 
l贸gicos est谩ndar DTL y TTL, y puede manejar cargas inductivas (como bobinas 
de rel茅s, motores DC, motores paso a paso) y transistores de conmutaci贸n de 
potencia. Los motores DC convierten la energ铆a el茅ctrica en energ铆a mec谩nica 
y son ampliamente utilizados en sistemas de accionamiento el茅ctrico debido a 
su excelente capacidad de regulaci贸n de velocidad.

Observa la siguiente figura de los pines. El L293D tiene dos pines de 
alimentaci贸n (Vcc1 y Vcc2). Vcc2 se usa para alimentar el motor, mientras que 
Vcc1 alimenta el chip. Aqu铆 se utiliza un motor DC de peque帽o tama帽o, por lo 
que ambos pines se conectan a +5V.

.. image:: img/image111.png

A continuaci贸n, se muestra la estructura interna del L293D. El pin EN es el 
pin de habilitaci贸n y solo funciona en nivel alto; A representa la entrada y 
Y la salida. Puedes ver la relaci贸n entre estos en la parte inferior derecha. 
Cuando el pin EN est谩 en nivel alto, si A est谩 en alto, Y proporciona nivel 
alto; si A est谩 en bajo, Y proporciona nivel bajo. Cuando el pin EN est谩 en 
bajo, el L293D no funciona.

.. image:: img/image334.png

**Motor DC**

.. image:: img/image114.jpeg

Este es un motor DC de 5V. Gira cuando los dos terminales de la l谩mina de cobre 
reciben uno nivel alto y otro bajo. Para facilitar la conexi贸n, puedes soldar 
los pines al motor.

.. image:: img/image335.png

**M贸dulo de Alimentaci贸n**

En este experimento, se necesitan grandes corrientes para accionar el motor, 
especialmente al iniciar y detener, lo que puede interferir con el funcionamiento 
normal de la Raspberry Pi. Por lo tanto, utilizamos un m贸dulo de alimentaci贸n 
separado para el motor, permitiendo que funcione de manera segura y estable.

Puedes conectarlo directamente en la protoboard para suministrar energ铆a. 
Proporciona voltajes de 3.3V y 5V, que se pueden seleccionar mediante un jumper.

.. image:: img/image115.png

Diagrama de Conexi贸n
--------------------

Conecta el m贸dulo de alimentaci贸n en la protoboard e inserta el jumper en el 
pin de 5V para que emita una tensi贸n de 5V. Conecta el pin 1 del L293D al GPIO22 
y config煤ralo en nivel alto. Conecta el pin 2 al GPIO27 y el pin 7 al GPIO17, 
luego configura un pin en alto y el otro en bajo para cambiar la direcci贸n de 
rotaci贸n del motor.

.. image:: img/image336.png

Procedimiento Experimental
-----------------------------
**Paso 1:** Monta el circuito.

.. image:: img/1.3.1.png
    :width: 800

.. note::
    El m贸dulo de alimentaci贸n puede utilizar una bater铆a de 9V con el conector 
    de bater铆a de 9V incluido en el kit. Inserta el jumper del m贸dulo de 
    alimentaci贸n en el bus de 5V de la protoboard.

.. image:: img/image118.jpeg


Para Usuarios de Lenguaje C
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

**Paso 2:** Accede a la carpeta del c贸digo.

.. raw:: html

    <run></run>
    
.. code-block::

    cd ~/davinci-kit-for-raspberry-pi/c/1.3.1/

**Paso 3:** Compila el c贸digo.

.. raw:: html

   <run></run>

.. code-block::

    gcc 1.3.1_Motor.c -lwiringPi

**Paso 4:** Ejecuta el archivo ejecutable.

.. raw:: html

   <run></run>

.. code-block::

    sudo ./a.out

Cuando el c贸digo se ejecute, el motor primero girar谩 en sentido horario 
durante 5 segundos, luego se detendr谩 durante 5 segundos, despu茅s girar谩 
en sentido antihorario durante 5 segundos y, posteriormente, se detendr谩 
otros 5 segundos. Esta secuencia de acciones se repetir谩 continuamente.

.. note::

    Si no funciona despu茅s de ejecutarlo o aparece un mensaje de error: \"wiringPi.h: No such file or directory\", consulta :ref:`c code is not working?`.
**C贸digo**

.. code-block:: c

    #include <wiringPi.h>
    #include <stdio.h>

    #define MotorPin1       0
    #define MotorPin2       2
    #define MotorEnable     3

    int main(void){
        int i;
        if(wiringPiSetup() == -1){ //si falla la inicializaci贸n de wiringPi, imprime mensaje en pantalla
            printf("setup wiringPi failed !");
            return 1;
        }
        
        pinMode(MotorPin1, OUTPUT);
        pinMode(MotorPin2, OUTPUT);
        pinMode(MotorEnable, OUTPUT);
        while(1){
            printf("Clockwise\n");
            delay(100);
            digitalWrite(MotorEnable, HIGH);
            digitalWrite(MotorPin1, HIGH);
            digitalWrite(MotorPin2, LOW);
            for(i=0;i<3;i++){
                delay(1000);
            }

            printf("Stop\n");
            delay(100);
            digitalWrite(MotorEnable, LOW);
            for(i=0;i<3;i++){
                delay(1000);
            }

            printf("Anti-clockwise\n");
            delay(100);
            digitalWrite(MotorEnable, HIGH);
            digitalWrite(MotorPin1, LOW);
            digitalWrite(MotorPin2, HIGH);
            for(i=0;i<3;i++){
                delay(1000);
            }

            printf("Stop\n");
            delay(100);
            digitalWrite(MotorEnable, LOW);
            for(i=0;i<3;i++){
                delay(1000);
            }
        }
        return 0;
    }

**Explicaci贸n del C贸digo**

.. code-block:: c

    digitalWrite(MotorEnable, HIGH);

Habilita el L239D.

.. code-block:: c

    digitalWrite(MotorPin1, HIGH);
    digitalWrite(MotorPin2, LOW);

Configura un nivel alto para 2A (pin 7); dado que 1,2EN (pin 1) est谩 en 
nivel alto, 2Y emitir谩 nivel alto.

Configura un nivel bajo para 1A; entonces, 1Y emitir谩 nivel bajo, y 
el motor girar谩.

.. code-block:: c

    for(i=0;i<3;i++){
    delay(1000);
    }

Este bucle es para generar una demora de 3*1000 ms.

.. code-block:: c

    digitalWrite(MotorEnable, LOW)

Si 1,2EN (pin 1) est谩 en nivel bajo, el L293D no funciona. El motor deja de girar.

.. code-block:: c

    digitalWrite(MotorPin1, LOW)
    digitalWrite(MotorPin2, HIGH)

Invierte el flujo de corriente del motor, y el motor girar谩 en sentido inverso.

Para Usuarios de Lenguaje Python
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

**Paso 2**: Entra en la carpeta del c贸digo.

.. raw:: html

   <run></run>

.. code-block::

    cd ~/davinci-kit-for-raspberry-pi/python

**Paso 3**: Ejecuta el c贸digo.

.. raw:: html

   <run></run>

.. code-block::

    sudo python3 1.3.1_Motor.py

Cuando se ejecuta el c贸digo, el motor primero gira en sentido horario 
durante 5 segundos, luego se detiene durante 5 segundos; despu茅s, gira 
en sentido antihorario durante 5 segundos, y finalmente se detiene nuevamente 
por 5 segundos. Esta serie de acciones se repetir谩 continuamente.  

**C贸digo**

.. note::

    Puedes **Modificar/Restablecer/Copiar/Ejecutar/Detener** el c贸digo a continuaci贸n. Pero antes de hacerlo, necesitas ir a la ruta del c贸digo fuente, como ``davinci-kit-for-raspberry-pi/python``. 
    
.. raw:: html

    <run></run>

.. code-block:: python

    #!/usr/bin/env python3

    import RPi.GPIO as GPIO
    import time
    
    # Configuraci贸n de pines
    MotorPin1   = 17
    MotorPin2   = 27
    MotorEnable = 22
    
    def setup():
        # Configura el modo de numeraci贸n GPIO en BCM
        GPIO.setmode(GPIO.BCM)
        # Configura los pines como salida
        GPIO.setup(MotorPin1, GPIO.OUT)
        GPIO.setup(MotorPin2, GPIO.OUT)
        GPIO.setup(MotorEnable, GPIO.OUT, initial=GPIO.LOW)
    
    # Define una funci贸n para hacer girar el motor
    # la direcci贸n debe ser
    # 1(sentido horario), 0(detener), -1(sentido antihorario)
    def motor(direction):
        # Sentido horario
        if direction == 1:
            # Configura la direcci贸n
            GPIO.output(MotorPin1, GPIO.HIGH)
            GPIO.output(MotorPin2, GPIO.LOW)
            # Habilita el motor
            GPIO.output(MotorEnable, GPIO.HIGH)
    		print ("Clockwise")
        # Sentido antihorario
        if direction == -1:
            # Configura la direcci贸n
            GPIO.output(MotorPin1, GPIO.LOW)
            GPIO.output(MotorPin2, GPIO.HIGH)
            # Habilita el motor
            GPIO.output(MotorEnable, GPIO.HIGH)
    		print ("Counterclockwise")
        # Detener
        if direction == 0:
            # Desactiva el motor
            GPIO.output(MotorEnable, GPIO.LOW)
    		print ("Stop")
    
    def main():
    
        # Define un diccionario para hacer el script m谩s legible
        # CW como sentido horario, CCW como sentido antihorario, STOP como detener
        directions = {'CW': 1, 'CCW': -1, 'STOP': 0}
        while True:
            # Sentido horario
            motor(directions['CW'])
            time.sleep(5)
            # Detener
            motor(directions['STOP'])
            time.sleep(5)
            # Sentido antihorario
            motor(directions['CCW'])
            time.sleep(5)
            # Detener
            motor(directions['STOP'])
            time.sleep(5)
    
    def destroy():
        # Detiene el motor
        GPIO.output(MotorEnable, GPIO.LOW)
        # Libera los recursos
        GPIO.cleanup()    
    
    # Si ejecutas este script directamente, haz:
    if __name__ == '__main__':
        setup()
        try:
            main()
        # Cuando se presiona 'Ctrl+C', se ejecutar谩 el programa destroy().
        except KeyboardInterrupt:
            destroy()

**Explicaci贸n del C贸digo**

.. code-block:: python

    def motor(direction):
        # Sentido horario
        if direction == 1:
            # Configura la direcci贸n
            GPIO.output(MotorPin1, GPIO.HIGH)
            GPIO.output(MotorPin2, GPIO.LOW)
            # Habilita el motor
            GPIO.output(MotorEnable, GPIO.HIGH)
            print ("Clockwise")
    ...

Crea una funci贸n, **motor()**, cuyo par谩metro es direcci贸n. Cuando la
condici贸n es direcci贸n=1, el motor gira en sentido horario; si
direcci贸n=-1, el motor gira en sentido antihorario; y cuando
direcci贸n=0, se detiene.

.. code-block:: python

    def main():
        # Define un diccionario para hacer el script m谩s legible
        # CW como sentido horario, CCW como sentido antihorario, STOP como detener
        directions = {'CW': 1, 'CCW': -1, 'STOP': 0}
        while True:
            # Sentido horario
            motor(directions['CW'])
            time.sleep(5)
            # Detener
            motor(directions['STOP'])
            time.sleep(5)
            # Sentido antihorario
            motor(directions['CCW'])
            time.sleep(5)
            # Detener
            motor(directions['STOP'])
            time.sleep(5)
        
En la funci贸n main(), crea un diccionario, directions[], en el cual CW
es igual a 1, CCW es -1, y el n煤mero 0 se refiere a Stop (detener).

Al ejecutarse el c贸digo, el motor primero gira en sentido horario durante 
5 segundos, luego se detiene durante 5 segundos; despu茅s, gira en sentido 
antihorario durante 5 segundos y finalmente se detiene nuevamente por 5 segundos. 
Esta serie de acciones se repetir谩 continuamente.

Ahora deber铆as ver la h茅lice del motor girando.

Imagen de Fen贸meno
---------------------

.. image:: img/image119.jpeg
