.. note::

    Â¡Hola! Bienvenido a la Comunidad de Entusiastas de SunFounder para Raspberry Pi, Arduino y ESP32 en Facebook. SumÃ©rgete mÃ¡s en el mundo de Raspberry Pi, Arduino y ESP32 junto a otros apasionados.

    **Â¿Por quÃ© unirte?**

    - **Soporte Experto**: Resuelve problemas postventa y desafÃ­os tÃ©cnicos con la ayuda de nuestra comunidad y equipo.
    - **Aprende y Comparte**: Intercambia consejos y tutoriales para mejorar tus habilidades.
    - **Preestrenos Exclusivos**: Accede anticipadamente a anuncios de nuevos productos.
    - **Descuentos Especiales**: Disfruta de descuentos exclusivos en nuestros productos mÃ¡s recientes.
    - **Promociones Festivas y Sorteos**: Participa en sorteos y promociones especiales.

    ðŸ‘‰ Â¿Listo para explorar y crear con nosotros? Haz clic en [|link_sf_facebook|] y Ãºnete hoy.

3.1.11 Generador de CÃ³digo Morse
=====================================

IntroducciÃ³n
--------------

En esta lecciÃ³n, vamos a crear un generador de cÃ³digo Morse. Escribe una 
serie de letras en inglÃ©s en la Raspberry Pi para verlas en cÃ³digo Morse.

Componentes
--------------

.. image:: img/3.1.10.png
    :align: center

Diagrama de EsquemÃ¡tico
--------------------------

============ ======== ======== ===
T-Board Name physical wiringPi BCM
GPIO17       Pin 11   0        17
GPIO22       Pin 15   3        22
============ ======== ======== ===

.. image:: img/Schematic_three_one11.png
   :align: center

Procedimientos Experimentales
--------------------------------

**Paso 1:** Construye el circuito. (Presta atenciÃ³n a los polos del zumbador: 
el polo positivo tiene la etiqueta + y el otro es el negativo).

.. image:: img/image269.png
   :alt: Morse_bb
   :width: 800

**Paso 2**: Abre el archivo de cÃ³digo.

.. raw:: html

   <run></run>

.. code-block::

    cd ~/davinci-kit-for-raspberry-pi/c/3.1.11/

**Paso 3**: Compila el cÃ³digo.

.. raw:: html

   <run></run>

.. code-block::

    gcc 3.1.11_MorseCodeGenerator.c -lwiringPi

**Paso 4**: Ejecuta el archivo ejecutable.

.. raw:: html

   <run></run>

.. code-block:: 

    sudo ./a.out

DespuÃ©s de ejecutar el programa, escribe una serie de caracteres, y el 
zumbador y el LED emitirÃ¡n las seÃ±ales correspondientes en cÃ³digo Morse.

.. note::

    Si no funciona despuÃ©s de ejecutar el cÃ³digo o aparece un mensaje de error: \"wiringPi.h: No such file or directory\", consulta :ref:`C code is not working?`.

**ExplicaciÃ³n del CÃ³digo**

.. code-block:: c

    structÂ MORSE{
    Â Â Â Â charÂ word;
    Â Â Â Â unsignedÂ charÂ *code;
    };

    structÂ MORSEÂ morseDict[]=
    {
    Â Â Â Â {'A',"01"},Â {'B',"1000"},Â {'C',"1010"},Â {'D',"100"},Â {'E',"0"},Â 
    Â Â Â Â {'F',"0010"},Â {'G',"110"},Â {'H',"0000"},Â {'I',"00"},Â {'J',"0111"},Â 
    Â Â Â Â {'K',"101"},Â {'L',"0100"},Â {'M',"11"},Â {'N',"10"},Â {'O',"111"},Â 
    Â Â Â Â {'P',"0110"},Â {'Q',"1101"},Â {'R',"010"},Â {'S',"000"},Â {'T',"1"},
    Â Â Â Â {'U',"001"},Â {'V',"0001"},Â {'W',"011"},Â {'X',"1001"},Â {'Y',"1011"},Â 
    Â Â Â Â {'Z',"1100"},{'1',"01111"},Â {'2',"00111"},Â {'3',"00011"},Â {'4',"00001"},Â 
    Â Â Â Â {'5',"00000"},{'6',"10000"},Â {'7',"11000"},Â {'8',"11100"},Â {'9',"11110"},
    Â Â Â Â {'0',"11111"},{'?',"001100"},Â {'/',"10010"},Â {',',"110011"},Â {'.',"010101"},
    Â Â Â Â {';',"101010"},{'!',"101011"},Â {'@',"011010"},Â {':',"111000"}
    };

Esta estructura MORSE es el diccionario de cÃ³digo Morse, que contiene caracteres 
de la A-Z, nÃºmeros del 0-9 y signos \"?\" \"/\" \":\" \",\" \".\" \";\" \"!\" \"@\" .

.. code-block:: c

    charÂ *lookup(charÂ key,structÂ MORSEÂ *dict,intÂ length)
    {
    Â Â Â Â forÂ (intÂ i=0;i<length;i++)
        {
            if(dict[i].word==key){
    Â Â Â Â Â Â Â Â Â Â Â Â returnÂ dict[i].code;
            }
        }     
    }

La funciÃ³n **lookup()** permite â€œconsultar el diccionarioâ€. Define una 
**key** y busca palabras que coincidan con **key** en la estructura 
**morseDict**, devolviendo el \"**code**\" correspondiente a la palabra encontrada.

.. code-block:: c

    voidÂ on(){
        digitalWrite(ALedPin,HIGH);
        digitalWrite(BeepPin,HIGH);     
    }

Se crea la funciÃ³n on() para encender el zumbador y el LED.

.. code-block:: c

    voidÂ off(){
        digitalWrite(ALedPin,LOW);
        digitalWrite(BeepPin,LOW);
    }

La funciÃ³n off() apaga el zumbador y el LED.

.. code-block:: c

    voidÂ beep(intÂ dt){
        on();
        delay(dt);
        off();
        delay(dt);
    }

Define la funciÃ³n beep() para que el zumbador y el LED emitan 
sonidos y parpadeen a intervalos de tiempo especÃ­ficos **dt**.

.. code-block:: c

    voidÂ morsecode(charÂ *code){
    Â Â Â Â intÂ pauseÂ =Â 250;
    Â Â Â Â charÂ *pointÂ =Â NULL;
    Â Â Â Â intÂ lengthÂ =Â sizeof(morseDict)/sizeof(morseDict[0]);
    Â Â Â Â forÂ (intÂ i=0;i<strlen(code);i++)
        {
            point=lookup(code[i],morseDict,length);
    Â Â Â Â Â Â Â Â forÂ (intÂ j=0;j<strlen(point);j++){
    Â Â Â Â Â Â Â Â Â Â Â Â ifÂ (point[j]=='0')
                {
                    beep(pause/2);
    Â Â Â Â Â Â Â Â Â Â Â Â }elseÂ if(point[j]=='1')
                {
                    beep(pause);
                }
                delay(pause);
            }
        }
    }

La funciÃ³n morsecode() procesa el cÃ³digo Morse de los caracteres de 
entrada, haciendo que el \"1\" del cÃ³digo emita sonidos o luces de 
mayor duraciÃ³n y el \"0\" emita luces y sonidos breves. Por ejemplo, 
al ingresar \"SOS\", se generarÃ¡ una seÃ±al que contiene tres puntos, 
tres guiones y luego tres puntos \" Â· Â· Â· - - - Â· Â· Â· \".

.. code-block:: c

    intÂ toupper(intÂ c)
    {
    Â Â Â Â ifÂ ((cÂ >=Â 'a')Â &&Â (cÂ <=Â 'z'))
    Â Â Â Â Â Â Â Â returnÂ cÂ +Â ('A'Â -Â 'a');
    Â Â Â Â returnÂ c;
    }
    charÂ *strupr(charÂ *str)
    {
    Â Â Â Â charÂ *orign=str;
    Â Â Â Â forÂ (;Â *str!='\0';Â str++)
    Â Â Â Â Â Â Â Â *strÂ =Â toupper(*str);
    returnÂ orign;
    }

Antes de codificar, es necesario unificar las letras en mayÃºsculas.

.. code-block:: c

    voidÂ main(){
        setup();
    Â Â Â Â charÂ *code;
    Â Â Â Â intÂ length=8;
    Â Â Â Â codeÂ =Â (char*)malloc(sizeof(char)*length);
    Â Â Â Â whileÂ (1){
    Â Â Â Â Â Â Â Â printf("PleaseÂ inputÂ theÂ messenger:");
            delay(100);
            scanf("%s",code);
            code=strupr(code);
            printf("%s\n",code);
            delay(100);
            morsecode(code);
        }
    }

Cuando escribes los caracteres relevantes en el teclado, code=strupr(code) 
convierte las letras en mayÃºsculas. Printf() luego imprime el texto claro 
en la pantalla de la computadora, y la funciÃ³n morsecode() hace que el 
zumbador y el LED emitan el cÃ³digo Morse.

Nota que la longitud del carÃ¡cter de entrada no debe exceder el **length** 
(este valor puede modificarse).

