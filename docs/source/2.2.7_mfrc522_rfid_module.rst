.. note::

    隆Hola! Bienvenido a la comunidad de entusiastas de SunFounder para Raspberry Pi, Arduino y ESP32 en Facebook. Sum茅rgete m谩s en Raspberry Pi, Arduino y ESP32 junto a otros entusiastas.

    **驴Por qu茅 unirse?**

    - **Soporte experto**: Resuelve problemas post-venta y desaf铆os t茅cnicos con la ayuda de nuestra comunidad y equipo.
    - **Aprende y comparte**: Intercambia consejos y tutoriales para mejorar tus habilidades.
    - **Avances exclusivos**: Obt茅n acceso anticipado a anuncios de nuevos productos y adelantos.
    - **Descuentos especiales**: Disfruta de descuentos exclusivos en nuestros productos m谩s recientes.
    - **Promociones festivas y sorteos**: Participa en sorteos y promociones de temporada.

     驴Listo para explorar y crear con nosotros? Haz clic en [|link_sf_facebook|] y 煤nete hoy.

2.2.7 M贸dulo RFID MFRC522
============================

Introducci贸n
---------------

La Identificaci贸n por Radiofrecuencia (RFID) se refiere a las tecnolog铆as 
que utilizan comunicaci贸n inal谩mbrica entre un objeto (o etiqueta) y un 
dispositivo de interrogaci贸n (o lector) para rastrear e identificar 
autom谩ticamente dichos objetos.

Algunas de las aplicaciones m谩s comunes de esta tecnolog铆a incluyen cadenas 
de suministro minoristas, cadenas de suministro militares, m茅todos de pago 
automatizados, seguimiento y gesti贸n de equipaje, seguimiento de documentos 
y gesti贸n farmac茅utica, entre otros.

En este proyecto, utilizaremos RFID para leer y escribir.

Componentes
----------------

.. image:: img/list_2.2.7.png

Principio
------------

**RFID**

La Identificaci贸n por Radiofrecuencia (RFID) se refiere a tecnolog铆as que 
implican el uso de comunicaci贸n inal谩mbrica entre un objeto (o etiqueta) y 
un dispositivo de interrogaci贸n (o lector) para rastrear e identificar 
autom谩ticamente dichos objetos. El alcance de transmisi贸n de la etiqueta se 
limita a varios metros desde el lector. No es estrictamente necesaria una 
l铆nea de visi贸n clara entre el lector y la etiqueta.

La mayor铆a de las etiquetas contienen al menos un circuito integrado (IC) y 
una antena. El microchip almacena informaci贸n y es responsable de gestionar 
la comunicaci贸n por radiofrecuencia (RF) con el lector. Las etiquetas pasivas 
no tienen una fuente de energ铆a independiente y dependen de una se帽al 
electromagn茅tica externa, proporcionada por el lector, para alimentar sus 
operaciones. Las etiquetas activas contienen una fuente de energ铆a independiente, 
como una bater铆a, lo que puede aumentar sus capacidades de procesamiento, 
transmisi贸n y alcance.

.. image:: img/image230.png

**MFRC522**

El MFRC522 es un tipo de chip lector y escritor de tarjetas integradas. 
Es com煤nmente utilizado en radiofrecuencia de 13.56 MHz. Lanzado por la 
compa帽铆a NXP, es un chip de tarjeta sin contacto de bajo voltaje, bajo 
costo y tama帽o reducido, ideal para instrumentos inteligentes y dispositivos 
port谩tiles.

El MF RC522 utiliza un concepto avanzado de modulaci贸n y demodulaci贸n que se 
presenta completamente en todos los m茅todos de comunicaci贸n sin contacto pasiva 
de 13.56 MHz y sus protocolos. Adem谩s, admite el algoritmo de cifrado r谩pido 
CRYPTO1 para verificar productos MIFARE. El MFRC522 tambi茅n admite la serie 
MIFARE de comunicaci贸n de alta velocidad sin contacto, con una tasa de 
transmisi贸n de datos bidireccional de hasta 424 kbit/s. Como un nuevo miembro 
de la serie de tarjetas lectoras altamente integradas de 13.56 MHz, el MF RC522 
es muy similar a los ya existentes MF RC500 y MF RC530, aunque presenta algunas 
diferencias importantes. Se comunica con la m谩quina host de forma serial, lo que 
requiere menos cableado. Puedes elegir entre los modos SPI, I2C y UART serial 
(similar a RS232), lo que ayuda a reducir la conexi贸n, ahorrar espacio en la 
placa PCB (tama帽o m谩s peque帽o) y reducir costos.


Diagrama de conexi贸n
----------------------

.. image:: img/image331.png


Procedimiento Experimental
--------------------------

**Paso 1:** Construir el circuito.

.. image:: img/image232.png
    :width: 800



**Paso 2:** Configurar SPI (consulta el :ref:`Appendix` para m谩s detalles. 
Si ya configuraste SPI, omite este paso).


Para usuarios de C
^^^^^^^^^^^^^^^^^^^^^^^

**Paso 3:** Dir铆gete a la carpeta del c贸digo.

.. raw:: html

   <run></run>

.. code-block:: 

    cd ~/davinci-kit-for-raspberry-pi/c/2.2.7/

**Paso 4:** Compila el c贸digo.

.. raw:: html

   <run></run>

.. code-block:: 

    make read
    make write

.. note::
    Hay dos ejemplos para leer o escribir el ID de la tarjeta,
    y puedes elegir uno de ellos seg煤n tu necesidad.

**Paso 5:** Ejecuta el archivo ejecutable.

.. raw:: html

   <run></run>

.. code-block:: 

    sudo ./read

.. raw:: html

   <run></run>
   
.. code-block:: 

    sudo ./write

.. note::

    Si no funciona despu茅s de ejecutarlo, o si aparece un mensaje de error: "wiringPi.h: No such file or directory", consulta:ref:`C code is not working?`.

**Explicaci贸n del C贸digo**

.. code-block:: c

    InitRc522();

Esta funci贸n se utiliza para inicializar el m贸dulo RFID RC522.

.. code-block:: c

    uint8_t read_card_data();

Esta funci贸n se utiliza para leer los datos de la tarjeta; si la lectura
es exitosa, devolver谩 "1".

.. code-block:: c

    uint8_t write_card_data(uint8_t *data);

Esta funci贸n permite escribir datos en la tarjeta y devuelve "1" si la escritura 
es exitosa. \*data es la informaci贸n que se escribir谩 en la tarjeta.

Para usuarios de Python
^^^^^^^^^^^^^^^^^^^^^^^^^^

**Paso 2**: Activar el entorno virtual.

.. note::
    
    * Antes de activarlo, debes asegurarte de haber creado un entorno virtual; consulta: :ref:`create_virtual`.

    * Cada vez que reinicies la Raspberry Pi o abras una nueva terminal, deber谩s ejecutar el siguiente comando nuevamente para activar el entorno virtual.

.. raw:: html

    <run></run>

.. code-block:: shell

    source myenv/bin/activate

Una vez activado el entorno virtual, ver谩s el nombre del entorno antes del indicador de la l铆nea de comandos, lo cual indica que est谩s trabajando dentro del entorno virtual.


**Paso 3:** Instalar las bibliotecas.

La biblioteca ``spidev`` ayuda a gestionar las interacciones con el SPI y es un componente clave en este tutorial, ya que la necesitamos para que la Raspberry Pi interact煤e con el RFID RC522.

Ejecuta el siguiente comando para instalar ``spidev`` en tu Raspberry Pi a trav茅s de ``pip``.

.. raw:: html

    <run></run>
 
.. code-block::

    sudo pip3 install spidev


Contin煤a con la instalaci贸n de la biblioteca MFRC522. La biblioteca MFRC522 contiene dos archivos: ``MFRC522.py`` y ``SimpleMFRC522.py``.


Entre ellos, ``MFRC522.py`` es la implementaci贸n de la interfaz del RFID RC522; 
esta biblioteca maneja todo el trabajo pesado de la comunicaci贸n con el RFID a 
trav茅s de la interfaz SPI de la Pi.

``SimpleMFRC522.py`` toma el archivo ``MFRC522.py`` y lo simplifica enormemente, 
permiti茅ndote manejar solo unas pocas funciones en lugar de muchas.

.. raw:: html

    <run></run>
 
.. code-block::

    sudo pip3 install mfrc522


**Paso 4**: Salir del entorno virtual.

Cuando hayas terminado tu trabajo y desees salir del entorno virtual, simplemente ejecuta:

.. raw:: html

    <run></run>

.. code-block:: shell

    deactivate

Esto te devolver谩 al entorno global de Python del sistema.

**Paso 5:** Ve a la carpeta del c贸digo.

.. raw:: html

    <run></run>
 
.. code-block::

    cd ~/davinci-kit-for-raspberry-pi/python/2.2.7

**Paso 6:** Ejecuta el archivo ejecutable.

.. raw:: html

   <run></run>

.. code-block::

    sudo python3 2.2.7_read.py

.. raw:: html

   <run></run>

.. code-block::

    sudo python3 2.2.7_write.py

.. note::

    * Despu茅s de ejecutar ``2.2.7_read.py``, se imprimir谩 el ``id`` y el ``texto`` de tu tarjeta en la terminal.
    * Despu茅s de ejecutar ``2.2.7_write.py``, primero debes escribir un mensaje, presionar ``Enter`` para confirmar y, 
    finalmente, colocar tu tarjeta en el m贸dulo RFID MFRC522 para completar la escritura.


**c贸digo**

.. note::

    Puedes **Modificar/Restablecer/Copiar/Ejecutar/Detener** el c贸digo a continuaci贸n. Pero antes de eso, debes ir a la ruta del c贸digo fuente, como ``davinci-kit-for-raspberry-pi/python``.

.. raw:: html

    <run></run>

.. code-block:: python

    # lectura
    import time
    from mfrc522 import SimpleMFRC522
    import RPi.GPIO as GPIO

    reader = SimpleMFRC522()

    def main():
        while True:
            print("Reading...Please place the card...")
            id, text = reader.read()
            print("ID: %s\nText: %s" % (id,text))
            time.sleep(3)
            
    def destroy():
        GPIO.cleanup()
        
    if __name__ == '__main__':
        try:
            main()
        # Cuando se presiona 'Ctrl+C', se ejecutar谩 la funci贸n destroy().
        except KeyboardInterrupt:
            destroy()


.. raw:: html

    <run></run>
        
.. code-block:: python

    # escritura
    from mfrc522 import SimpleMFRC522
    import RPi.GPIO as GPIO

    reader = SimpleMFRC522()

    def main():
        while True:
            text = input('Please write new data:')
            print("Please place the card to complete writing")
            reader.write(text)
            print("Data writing is complete")
            
    def destroy():
        GPIO.cleanup()
        
    if __name__ == '__main__':
        try:
            main()
        # Cuando se presiona 'Ctrl+C', se ejecutar谩 la funci贸n destroy().
        except KeyboardInterrupt:
            destroy()

**Explicaci贸n del C贸digo**

.. code-block:: python

    reader = SimpleMFRC522()

Instancia la clase ``SimpleMFRC522()``.

.. code-block:: python

    reader.read()

Esta funci贸n se utiliza para leer los datos de la tarjeta. Si la lectura es exitosa, devolver谩 el id y el texto.

.. code-block:: python

    reader.write(text)

Esta funci贸n se utiliza para escribir informaci贸n en la tarjeta; presiona la tecla ``Enter`` para finalizar la escritura. ``text`` es la informaci贸n que se escribir谩 en la tarjeta.

Imagen del Fen贸meno
-------------------------

.. image:: img/image233.jpeg