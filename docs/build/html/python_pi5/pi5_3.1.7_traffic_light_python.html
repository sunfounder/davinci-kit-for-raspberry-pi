<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>3.1.7 Traffic Light &mdash; SunFounder davinci-kit-for-raspberry-pi  documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/copybutton.css" type="text/css" />
      <link rel="stylesheet" href="https://ezblock.cc/readDocFile/custom.css" type="text/css" />
      <link rel="stylesheet" href="https://ezblock.cc/readDocFile/readTheDoc/src/css/index.css" type="text/css" />
      <link rel="stylesheet" href="https://ezblock.cc/readDocFile/readTheDoc/src/css/xterm.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/jquery.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/sphinx_highlight.js"></script>
        <script src="../_static/clipboard.min.js"></script>
        <script src="../_static/copybutton.js"></script>
        <script src="https://ezblock.cc/readDocFile/custom.js"></script>
        <script src="../_static/./lang.js"></script>
        <script src="https://ezblock.cc/readDocFile/readTheDoc/src/js/ace.js"></script>
        <script src="https://ezblock.cc/readDocFile/readTheDoc/src/js/ext-language_tools.js"></script>
        <script src="https://ezblock.cc/readDocFile/readTheDoc/src/js/theme-chrome.js"></script>
        <script src="https://ezblock.cc/readDocFile/readTheDoc/src/js/mode-python.js"></script>
        <script src="https://ezblock.cc/readDocFile/readTheDoc/src/js/mode-sh.js"></script>
        <script src="https://ezblock.cc/readDocFile/readTheDoc/src/js/monokai.js"></script>
        <script src="https://ezblock.cc/readDocFile/readTheDoc/src/js/xterm.js"></script>
        <script src="https://ezblock.cc/readDocFile/readTheDoc/src/js/FitAddon.js"></script>
        <script src="https://ezblock.cc/readDocFile/readTheDoc/src/js/readTheDocIndex.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="3.1.8 Overheat Monitor" href="pi5_3.1.8_overheat_monitor_python.html" />
    <link rel="prev" title="3.1.6 Motion Control" href="pi5_3.1.6_motion_control_python.html" /> 
</head>

<body class="wy-body-for-nav">
<nav id="nav-bar">
  <ul class="nav-bar-items" id="nav-bar-items">
    <li class="nav-bar-logo">
      <a href="https://sunfounder.com">
        <img class="logo-img" src="https://ezblock.cc/readDocFile/sunfounder_LOGO_160x@2x.png"/>
      </a>
    </li>
  </ul>
</nav>

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            SunFounder davinci-kit-for-raspberry-pi
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../index.html">About this Kit</a></li>
<li class="toctree-l1"><a class="reference internal" href="../component_list.html">Component List</a></li>
<li class="toctree-l1"><a class="reference internal" href="../libraries.html">Libraries</a></li>
<li class="toctree-l1"><a class="reference internal" href="../gpio_extension_board.html">GPIO Extension Board</a></li>
<li class="toctree-l1"><a class="reference internal" href="../download_the_code.html">Download the Code</a></li>
<li class="toctree-l1"><a class="reference internal" href="../preparation/preparation.html">Preparation</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../for_pi5.html">For Pi 5</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="play_with_python_pi5.html">Play with Python</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="check_the_gpiozero_python.html">Check the <code class="docutils literal notranslate"><span class="pre">GPIO</span> <span class="pre">Zero</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="pi5_output_python.html">Output</a></li>
<li class="toctree-l3"><a class="reference internal" href="pi5_input_python.html">Input</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="pi5_extension_python.html">Extension</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="pi5_3.1.1_counting_device_python.html">3.1.1 Counting Device</a></li>
<li class="toctree-l4"><a class="reference internal" href="pi5_3.1.2_welcome_python.html">3.1.2 Welcome</a></li>
<li class="toctree-l4"><a class="reference internal" href="pi5_3.1.3_reversing_alarm_python.html">3.1.3 Reversing Alarm</a></li>
<li class="toctree-l4"><a class="reference internal" href="pi5_3.1.4_smart_fan_python.html">3.1.4 Smart Fan</a></li>
<li class="toctree-l4"><a class="reference internal" href="pi5_3.1.5_battery_indicator_python.html">3.1.5 Battery Indicator</a></li>
<li class="toctree-l4"><a class="reference internal" href="pi5_3.1.6_motion_control_python.html">3.1.6 Motion Control</a></li>
<li class="toctree-l4 current"><a class="current reference internal" href="#">3.1.7 Traffic Light</a></li>
<li class="toctree-l4"><a class="reference internal" href="pi5_3.1.8_overheat_monitor_python.html">3.1.8 Overheat Monitor</a></li>
<li class="toctree-l4"><a class="reference internal" href="pi5_3.1.9_password_lock_python.html">3.1.9 Password Lock</a></li>
<li class="toctree-l4"><a class="reference internal" href="pi5_3.1.10_alarm_bell_python.html">3.1.10 Alarm Bell</a></li>
<li class="toctree-l4"><a class="reference internal" href="pi5_3.1.11_morse_code_generator_python.html">3.1.11 Morse Code Generator</a></li>
<li class="toctree-l4"><a class="reference internal" href="pi5_3.1.12_game_guess_number_python.html">3.1.12 GAME‚Äì Guess Number</a></li>
<li class="toctree-l4"><a class="reference internal" href="pi5_3.1.13_game_10_second_python.html">3.1.13 GAME - 10 Second</a></li>
<li class="toctree-l4"><a class="reference internal" href="pi5_3.1.14_game_not_not_python.html">3.1.14 GAME‚Äì Not Not</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../c_pi5/play_with_c.html">Play with C</a></li>
<li class="toctree-l2"><a class="reference internal" href="../scratch_pi5/play_with_scratch.html">Play with Scratch</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../for_other_models.html">For Pi 4, 3, and All Other Pi Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="../python_video/python_video.html">Python Video Course</a></li>
<li class="toctree-l1"><a class="reference internal" href="../appendix/appendix.html">Appendix</a></li>
<li class="toctree-l1"><a class="reference internal" href="../faq.html">FAQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="../thank-learning.html">Thank You</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">SunFounder davinci-kit-for-raspberry-pi</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../for_pi5.html">For Pi 5</a></li>
          <li class="breadcrumb-item"><a href="play_with_python_pi5.html">Play with Python</a></li>
          <li class="breadcrumb-item"><a href="pi5_extension_python.html">Extension</a></li>
      <li class="breadcrumb-item active">3.1.7 Traffic Light</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/python_pi5/pi5_3.1.7_traffic_light_python.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="admonition note">
<p class="admonition-title">Note</p>
<p>Hello, welcome to the SunFounder Raspberry Pi &amp; Arduino &amp; ESP32 Enthusiasts Community on Facebook! Dive deeper into Raspberry Pi, Arduino, and ESP32 with fellow enthusiasts.</p>
<p><strong>Why Join?</strong></p>
<ul class="simple">
<li><p><strong>Expert Support</strong>: Solve post-sale issues and technical challenges with help from our community and team.</p></li>
<li><p><strong>Learn &amp; Share</strong>: Exchange tips and tutorials to enhance your skills.</p></li>
<li><p><strong>Exclusive Previews</strong>: Get early access to new product announcements and sneak peeks.</p></li>
<li><p><strong>Special Discounts</strong>: Enjoy exclusive discounts on our newest products.</p></li>
<li><p><strong>Festive Promotions and Giveaways</strong>: Take part in giveaways and holiday promotions.</p></li>
</ul>
<p>üëâ Ready to explore and create with us? Click [<a href="https://bit.ly/raphaelkit " target="_blank">here</a>] and join today!</p>
</div>
<section id="traffic-light">
<span id="py-pi5-traffic"></span><h1>3.1.7 Traffic Light<a class="headerlink" href="#traffic-light" title="Permalink to this heading">ÔÉÅ</a></h1>
<section id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this heading">ÔÉÅ</a></h2>
<p>In this project, we will use LED lights of three colors to realize the
change of traffic lights and a four-digit 7-segment display will be used
to display the timing of each traffic state.</p>
</section>
<section id="required-components">
<h2>Required Components<a class="headerlink" href="#required-components" title="Permalink to this heading">ÔÉÅ</a></h2>
<p>In this project, we need the following components.</p>
<a class="reference internal image-reference" href="../_images/4.1.12_traffic_light_list.png"><img alt="../_images/4.1.12_traffic_light_list.png" class="align-center" src="../_images/4.1.12_traffic_light_list.png" style="width: 800px;" /></a>
</section>
<section id="schematic-diagram">
<h2>Schematic Diagram<a class="headerlink" href="#schematic-diagram" title="Permalink to this heading">ÔÉÅ</a></h2>
<table class="docutils align-default">
<tbody>
<tr class="row-odd"><td><p>T-Board Name</p></td>
<td><p>physical</p></td>
<td><p>wiringPi</p></td>
<td><p>BCM</p></td>
</tr>
<tr class="row-even"><td><p>GPIO17</p></td>
<td><p>Pin 11</p></td>
<td><p>0</p></td>
<td><p>17</p></td>
</tr>
<tr class="row-odd"><td><p>GPIO27</p></td>
<td><p>Pin 13</p></td>
<td><p>2</p></td>
<td><p>27</p></td>
</tr>
<tr class="row-even"><td><p>GPIO22</p></td>
<td><p>Pin 15</p></td>
<td><p>3</p></td>
<td><p>22</p></td>
</tr>
<tr class="row-odd"><td><p>SPIMOSI</p></td>
<td><p>Pin 19</p></td>
<td><p>12</p></td>
<td><p>10</p></td>
</tr>
<tr class="row-even"><td><p>GPIO18</p></td>
<td><p>Pin 12</p></td>
<td><p>1</p></td>
<td><p>18</p></td>
</tr>
<tr class="row-odd"><td><p>GPIO23</p></td>
<td><p>Pin 16</p></td>
<td><p>4</p></td>
<td><p>23</p></td>
</tr>
<tr class="row-even"><td><p>GPIO24</p></td>
<td><p>Pin 18</p></td>
<td><p>5</p></td>
<td><p>24</p></td>
</tr>
<tr class="row-odd"><td><p>GPIO25</p></td>
<td><p>Pin 22</p></td>
<td><p>6</p></td>
<td><p>25</p></td>
</tr>
<tr class="row-even"><td><p>SPICE0</p></td>
<td><p>Pin 24</p></td>
<td><p>10</p></td>
<td><p>8</p></td>
</tr>
<tr class="row-odd"><td><p>SPICE1</p></td>
<td><p>Pin 26</p></td>
<td><p>11</p></td>
<td><p>7</p></td>
</tr>
</tbody>
</table>
<img alt="../_images/4.1.12_traffic_light_schematic.png" class="align-center" src="../_images/4.1.12_traffic_light_schematic.png" />
</section>
<section id="experimental-procedures">
<h2>Experimental Procedures<a class="headerlink" href="#experimental-procedures" title="Permalink to this heading">ÔÉÅ</a></h2>
<p><strong>Step 1:</strong> Build the circuit.</p>
<img alt="../_images/4.1.12_traffic_light_circuit.png" src="../_images/4.1.12_traffic_light_circuit.png" />
<p><strong>Step 2:</strong> Change directory.</p>
<run></run><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="o">~/</span><span class="n">raphael</span><span class="o">-</span><span class="n">kit</span><span class="o">/</span><span class="n">python</span><span class="o">-</span><span class="n">pi5</span>
</pre></div>
</div>
<p><strong>Step 3:</strong> Run.</p>
<run></run><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">python3</span> <span class="mf">3.1.7</span><span class="n">_TrafficLight</span><span class="o">.</span><span class="n">py</span>
</pre></div>
</div>
<p>As the code runs, LEDs will simulate the color changing of traffic
lights. Firstly, the red LED lights up for 60s, then the green LED
lights up for 30s; next, the yellow LED lights up for 5s. After that,
the red LED lights up for 60s once again. In this way, this series of
actions will be executed repeatedly. Meanwhile, the 4-digit 7-segment
display displays the countdown time continuously.</p>
</section>
<section id="code">
<h2>Code<a class="headerlink" href="#code" title="Permalink to this heading">ÔÉÅ</a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>You can <strong>Modify/Reset/Copy/Run/Stop</strong> the code below. But before that, you need to go to  source code path like <code class="docutils literal notranslate"><span class="pre">raphael-kit/python-pi5</span></code>. After modifying the code, you can run it directly to see the effect.</p>
</div>
<run></run><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env python3</span>

<span class="kn">from</span> <span class="nn">gpiozero</span> <span class="kn">import</span> <span class="n">OutputDevice</span><span class="p">,</span> <span class="n">LED</span>
<span class="kn">import</span> <span class="nn">threading</span>

<span class="c1"># Setup GPIO pins for 74HC595 shift register</span>
<span class="n">SDI</span> <span class="o">=</span> <span class="n">OutputDevice</span><span class="p">(</span><span class="mi">24</span><span class="p">)</span>   <span class="c1"># Serial Data Input</span>
<span class="n">RCLK</span> <span class="o">=</span> <span class="n">OutputDevice</span><span class="p">(</span><span class="mi">23</span><span class="p">)</span>  <span class="c1"># Register Clock</span>
<span class="n">SRCLK</span> <span class="o">=</span> <span class="n">OutputDevice</span><span class="p">(</span><span class="mi">18</span><span class="p">)</span> <span class="c1"># Shift Register Clock</span>

<span class="c1"># Setup GPIO pins for digit selection on 7-segment display</span>
<span class="n">placePin</span> <span class="o">=</span> <span class="p">[</span><span class="n">OutputDevice</span><span class="p">(</span><span class="n">pin</span><span class="p">)</span> <span class="k">for</span> <span class="n">pin</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="mi">27</span><span class="p">,</span> <span class="mi">17</span><span class="p">)]</span>

<span class="c1"># Segment codes for numbers 0-9 on 7-segment display</span>
<span class="n">number</span> <span class="o">=</span> <span class="p">(</span><span class="mh">0xc0</span><span class="p">,</span> <span class="mh">0xf9</span><span class="p">,</span> <span class="mh">0xa4</span><span class="p">,</span> <span class="mh">0xb0</span><span class="p">,</span> <span class="mh">0x99</span><span class="p">,</span> <span class="mh">0x92</span><span class="p">,</span> <span class="mh">0x82</span><span class="p">,</span> <span class="mh">0xf8</span><span class="p">,</span> <span class="mh">0x80</span><span class="p">,</span> <span class="mh">0x90</span><span class="p">)</span>

<span class="c1"># Setup GPIO pins for traffic light LEDs</span>
<span class="n">ledPinR</span> <span class="o">=</span> <span class="n">LED</span><span class="p">(</span><span class="mi">25</span><span class="p">)</span> <span class="c1"># Red LED</span>
<span class="n">ledPinG</span> <span class="o">=</span> <span class="n">LED</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span>  <span class="c1"># Green LED</span>
<span class="n">ledPinY</span> <span class="o">=</span> <span class="n">LED</span><span class="p">(</span><span class="mi">7</span><span class="p">)</span>  <span class="c1"># Yellow LED</span>

<span class="c1"># Duration settings for traffic lights</span>
<span class="n">greenLight</span> <span class="o">=</span> <span class="mi">30</span>
<span class="n">yellowLight</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">redLight</span> <span class="o">=</span> <span class="mi">60</span>

<span class="c1"># Traffic light color names</span>
<span class="n">lightColor</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;Red&quot;</span><span class="p">,</span> <span class="s2">&quot;Green&quot;</span><span class="p">,</span> <span class="s2">&quot;Yellow&quot;</span><span class="p">)</span>

<span class="c1"># Initialize state variables</span>
<span class="n">colorState</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">counter</span> <span class="o">=</span> <span class="mi">60</span>
<span class="n">timer1</span> <span class="o">=</span> <span class="kc">None</span>

<span class="k">def</span> <span class="nf">setup</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Initialize the traffic light system and start the timer. &quot;&quot;&quot;</span>
    <span class="k">global</span> <span class="n">timer1</span>
    <span class="n">timer1</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Timer</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">timer</span><span class="p">)</span>
    <span class="n">timer1</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">clearDisplay</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Clear the 7-segment display. &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">8</span><span class="p">):</span>
        <span class="n">SDI</span><span class="o">.</span><span class="n">on</span><span class="p">()</span>
        <span class="n">SRCLK</span><span class="o">.</span><span class="n">on</span><span class="p">()</span>
        <span class="n">SRCLK</span><span class="o">.</span><span class="n">off</span><span class="p">()</span>
    <span class="n">RCLK</span><span class="o">.</span><span class="n">on</span><span class="p">()</span>
    <span class="n">RCLK</span><span class="o">.</span><span class="n">off</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">hc595_shift</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Shift data to the 74HC595 shift register for digit display. &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">8</span><span class="p">):</span>
        <span class="n">SDI</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="mh">0x80</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">data</span> <span class="o">&lt;&lt;</span> <span class="n">i</span><span class="p">)</span>
        <span class="n">SRCLK</span><span class="o">.</span><span class="n">on</span><span class="p">()</span>
        <span class="n">SRCLK</span><span class="o">.</span><span class="n">off</span><span class="p">()</span>
    <span class="n">RCLK</span><span class="o">.</span><span class="n">on</span><span class="p">()</span>
    <span class="n">RCLK</span><span class="o">.</span><span class="n">off</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">pickDigit</span><span class="p">(</span><span class="n">digit</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Select a specific digit to display on the 7-segment display. &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">pin</span> <span class="ow">in</span> <span class="n">placePin</span><span class="p">:</span>
        <span class="n">pin</span><span class="o">.</span><span class="n">off</span><span class="p">()</span>
    <span class="n">placePin</span><span class="p">[</span><span class="n">digit</span><span class="p">]</span><span class="o">.</span><span class="n">on</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">timer</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Handle the timing for traffic light changes. &quot;&quot;&quot;</span>
    <span class="k">global</span> <span class="n">counter</span><span class="p">,</span> <span class="n">colorState</span><span class="p">,</span> <span class="n">timer1</span>
    <span class="n">timer1</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Timer</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">timer</span><span class="p">)</span>
    <span class="n">timer1</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
    <span class="n">counter</span> <span class="o">-=</span> <span class="mi">1</span>
    <span class="k">if</span> <span class="n">counter</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">counter</span> <span class="o">=</span> <span class="p">[</span><span class="n">greenLight</span><span class="p">,</span> <span class="n">yellowLight</span><span class="p">,</span> <span class="n">redLight</span><span class="p">][</span><span class="n">colorState</span><span class="p">]</span>
        <span class="n">colorState</span> <span class="o">=</span> <span class="p">(</span><span class="n">colorState</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="mi">3</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;counter : </span><span class="si">{</span><span class="n">counter</span><span class="si">}</span><span class="s2">    color: </span><span class="si">{</span><span class="n">lightColor</span><span class="p">[</span><span class="n">colorState</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">lightup</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Update the traffic light LED based on the current state. &quot;&quot;&quot;</span>
    <span class="k">global</span> <span class="n">colorState</span>
    <span class="n">ledPinR</span><span class="o">.</span><span class="n">off</span><span class="p">()</span>
    <span class="n">ledPinG</span><span class="o">.</span><span class="n">off</span><span class="p">()</span>
    <span class="n">ledPinY</span><span class="o">.</span><span class="n">off</span><span class="p">()</span>
    <span class="p">[</span><span class="n">ledPinR</span><span class="p">,</span> <span class="n">ledPinG</span><span class="p">,</span> <span class="n">ledPinY</span><span class="p">][</span><span class="n">colorState</span><span class="p">]</span><span class="o">.</span><span class="n">on</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">display</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Display the current counter value on the 7-segment display. &quot;&quot;&quot;</span>
    <span class="k">global</span> <span class="n">counter</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
        <span class="n">digit</span> <span class="o">=</span> <span class="n">counter</span> <span class="o">//</span> <span class="p">(</span><span class="mi">10</span> <span class="o">**</span> <span class="p">(</span><span class="mi">3</span> <span class="o">-</span> <span class="n">i</span><span class="p">))</span> <span class="o">%</span> <span class="mi">10</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">digit</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="n">clearDisplay</span><span class="p">()</span>
        <span class="n">pickDigit</span><span class="p">(</span><span class="mi">3</span> <span class="o">-</span> <span class="n">i</span><span class="p">)</span>
        <span class="n">hc595_shift</span><span class="p">(</span><span class="n">number</span><span class="p">[</span><span class="n">digit</span><span class="p">])</span>

<span class="k">def</span> <span class="nf">loop</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Main loop to continuously update display and lights. &quot;&quot;&quot;</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">display</span><span class="p">()</span>
        <span class="n">lightup</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">destroy</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Clean up resources when the script is terminated. &quot;&quot;&quot;</span>
    <span class="k">global</span> <span class="n">timer1</span>
    <span class="n">timer1</span><span class="o">.</span><span class="n">cancel</span><span class="p">()</span>
    <span class="n">ledPinR</span><span class="o">.</span><span class="n">off</span><span class="p">()</span>
    <span class="n">ledPinG</span><span class="o">.</span><span class="n">off</span><span class="p">()</span>
    <span class="n">ledPinY</span><span class="o">.</span><span class="n">off</span><span class="p">()</span>

<span class="k">try</span><span class="p">:</span>
    <span class="n">setup</span><span class="p">()</span>
    <span class="n">loop</span><span class="p">()</span>
<span class="k">except</span> <span class="ne">KeyboardInterrupt</span><span class="p">:</span>
    <span class="n">destroy</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="code-explanation">
<h2>Code Explanation<a class="headerlink" href="#code-explanation" title="Permalink to this heading">ÔÉÅ</a></h2>
<ol class="arabic">
<li><p>Imports the <code class="docutils literal notranslate"><span class="pre">OutputDevice</span></code> and <code class="docutils literal notranslate"><span class="pre">LED</span></code> classes from the gpiozero library, enabling control of general output devices and specifically LEDs. Imports Python‚Äôs threading module, which will be used for creating and handling threads for concurrent execution.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env python3</span>
<span class="kn">from</span> <span class="nn">gpiozero</span> <span class="kn">import</span> <span class="n">OutputDevice</span><span class="p">,</span> <span class="n">LED</span>
<span class="kn">import</span> <span class="nn">threading</span>
</pre></div>
</div>
</li>
<li><p>Initializes GPIO pins connected to the shift register‚Äôs Serial Data Input (SDI), Register Clock Input (RCLK), and Shift Register Clock Input (SRCLK).</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Setup GPIO pins for 74HC595 shift register</span>
<span class="n">SDI</span> <span class="o">=</span> <span class="n">OutputDevice</span><span class="p">(</span><span class="mi">24</span><span class="p">)</span>   <span class="c1"># Serial Data Input</span>
<span class="n">RCLK</span> <span class="o">=</span> <span class="n">OutputDevice</span><span class="p">(</span><span class="mi">23</span><span class="p">)</span>  <span class="c1"># Register Clock</span>
<span class="n">SRCLK</span> <span class="o">=</span> <span class="n">OutputDevice</span><span class="p">(</span><span class="mi">18</span><span class="p">)</span> <span class="c1"># Shift Register Clock</span>
</pre></div>
</div>
</li>
<li><p>Initializes the pins for each digit of the 7-segment display and defines the binary codes for displaying numbers 0-9.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Setup GPIO pins for digit selection on 7-segment display</span>
<span class="n">placePin</span> <span class="o">=</span> <span class="p">[</span><span class="n">OutputDevice</span><span class="p">(</span><span class="n">pin</span><span class="p">)</span> <span class="k">for</span> <span class="n">pin</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="mi">27</span><span class="p">,</span> <span class="mi">17</span><span class="p">)]</span>

<span class="c1"># Segment codes for numbers 0-9 on 7-segment display</span>
<span class="n">number</span> <span class="o">=</span> <span class="p">(</span><span class="mh">0xc0</span><span class="p">,</span> <span class="mh">0xf9</span><span class="p">,</span> <span class="mh">0xa4</span><span class="p">,</span> <span class="mh">0xb0</span><span class="p">,</span> <span class="mh">0x99</span><span class="p">,</span> <span class="mh">0x92</span><span class="p">,</span> <span class="mh">0x82</span><span class="p">,</span> <span class="mh">0xf8</span><span class="p">,</span> <span class="mh">0x80</span><span class="p">,</span> <span class="mh">0x90</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><p>Initializes GPIO pins for the Red, Green, and Yellow LEDs used in the traffic light simulation. Sets the duration (in seconds) for each color state in the traffic light system. Defines the names of the traffic light colors for reference.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Setup GPIO pins for traffic light LEDs</span>
<span class="n">ledPinR</span> <span class="o">=</span> <span class="n">LED</span><span class="p">(</span><span class="mi">25</span><span class="p">)</span> <span class="c1"># Red LED</span>
<span class="n">ledPinG</span> <span class="o">=</span> <span class="n">LED</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span>  <span class="c1"># Green LED</span>
<span class="n">ledPinY</span> <span class="o">=</span> <span class="n">LED</span><span class="p">(</span><span class="mi">7</span><span class="p">)</span>  <span class="c1"># Yellow LED</span>

<span class="c1"># Duration settings for traffic lights</span>
<span class="n">greenLight</span> <span class="o">=</span> <span class="mi">30</span>
<span class="n">yellowLight</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">redLight</span> <span class="o">=</span> <span class="mi">60</span>

<span class="c1"># Traffic light color names</span>
<span class="n">lightColor</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;Red&quot;</span><span class="p">,</span> <span class="s2">&quot;Green&quot;</span><span class="p">,</span> <span class="s2">&quot;Yellow&quot;</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><p>Initializes variables for tracking the current color state, a counter for timing, and a placeholder for a timer object.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Initialize state variables</span>
<span class="n">colorState</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">counter</span> <span class="o">=</span> <span class="mi">60</span>
<span class="n">timer1</span> <span class="o">=</span> <span class="kc">None</span>
</pre></div>
</div>
</li>
<li><p>Initializes the traffic light system and starts the timer thread.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">setup</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Initialize the traffic light system and start the timer. &quot;&quot;&quot;</span>
    <span class="k">global</span> <span class="n">timer1</span>
    <span class="n">timer1</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Timer</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">timer</span><span class="p">)</span>
    <span class="n">timer1</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
</pre></div>
</div>
</li>
<li><p>Functions to control the 7-segment display. <code class="docutils literal notranslate"><span class="pre">clearDisplay</span></code> turns off all segments, <code class="docutils literal notranslate"><span class="pre">hc595_shift</span></code> shifts data into the shift register, and <code class="docutils literal notranslate"><span class="pre">pickDigit</span></code> activates a specific digit on the display.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">clearDisplay</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Clear the 7-segment display. &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">8</span><span class="p">):</span>
        <span class="n">SDI</span><span class="o">.</span><span class="n">on</span><span class="p">()</span>
        <span class="n">SRCLK</span><span class="o">.</span><span class="n">on</span><span class="p">()</span>
        <span class="n">SRCLK</span><span class="o">.</span><span class="n">off</span><span class="p">()</span>
    <span class="n">RCLK</span><span class="o">.</span><span class="n">on</span><span class="p">()</span>
    <span class="n">RCLK</span><span class="o">.</span><span class="n">off</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">hc595_shift</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Shift data to the 74HC595 shift register for digit display. &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">8</span><span class="p">):</span>
        <span class="n">SDI</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="mh">0x80</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">data</span> <span class="o">&lt;&lt;</span> <span class="n">i</span><span class="p">)</span>
        <span class="n">SRCLK</span><span class="o">.</span><span class="n">on</span><span class="p">()</span>
        <span class="n">SRCLK</span><span class="o">.</span><span class="n">off</span><span class="p">()</span>
    <span class="n">RCLK</span><span class="o">.</span><span class="n">on</span><span class="p">()</span>
    <span class="n">RCLK</span><span class="o">.</span><span class="n">off</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">pickDigit</span><span class="p">(</span><span class="n">digit</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Select a specific digit to display on the 7-segment display. &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">pin</span> <span class="ow">in</span> <span class="n">placePin</span><span class="p">:</span>
        <span class="n">pin</span><span class="o">.</span><span class="n">off</span><span class="p">()</span>
    <span class="n">placePin</span><span class="p">[</span><span class="n">digit</span><span class="p">]</span><span class="o">.</span><span class="n">on</span><span class="p">()</span>
</pre></div>
</div>
</li>
<li><p>Manages the timing for traffic light changes and updates the counter and color state.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">timer</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Handle the timing for traffic light changes. &quot;&quot;&quot;</span>
    <span class="k">global</span> <span class="n">counter</span><span class="p">,</span> <span class="n">colorState</span><span class="p">,</span> <span class="n">timer1</span>
    <span class="n">timer1</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Timer</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">timer</span><span class="p">)</span>
    <span class="n">timer1</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
    <span class="n">counter</span> <span class="o">-=</span> <span class="mi">1</span>
    <span class="k">if</span> <span class="n">counter</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">counter</span> <span class="o">=</span> <span class="p">[</span><span class="n">greenLight</span><span class="p">,</span> <span class="n">yellowLight</span><span class="p">,</span> <span class="n">redLight</span><span class="p">][</span><span class="n">colorState</span><span class="p">]</span>
        <span class="n">colorState</span> <span class="o">=</span> <span class="p">(</span><span class="n">colorState</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="mi">3</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;counter : </span><span class="si">{</span><span class="n">counter</span><span class="si">}</span><span class="s2">    color: </span><span class="si">{</span><span class="n">lightColor</span><span class="p">[</span><span class="n">colorState</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><p>Updates the state of the traffic light LEDs based on the current color state.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">lightup</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Update the traffic light LED based on the current state. &quot;&quot;&quot;</span>
    <span class="k">global</span> <span class="n">colorState</span>
    <span class="n">ledPinR</span><span class="o">.</span><span class="n">off</span><span class="p">()</span>
    <span class="n">ledPinG</span><span class="o">.</span><span class="n">off</span><span class="p">()</span>
    <span class="n">ledPinY</span><span class="o">.</span><span class="n">off</span><span class="p">()</span>
    <span class="p">[</span><span class="n">ledPinR</span><span class="p">,</span> <span class="n">ledPinG</span><span class="p">,</span> <span class="n">ledPinY</span><span class="p">][</span><span class="n">colorState</span><span class="p">]</span><span class="o">.</span><span class="n">on</span><span class="p">()</span>
</pre></div>
</div>
</li>
<li><p>Calculates the digit to be displayed on each segment of the 7-segment display and updates it accordingly.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">display</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Display the current counter value on the 7-segment display. &quot;&quot;&quot;</span>
    <span class="k">global</span> <span class="n">counter</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
        <span class="n">digit</span> <span class="o">=</span> <span class="n">counter</span> <span class="o">//</span> <span class="p">(</span><span class="mi">10</span> <span class="o">**</span> <span class="p">(</span><span class="mi">3</span> <span class="o">-</span> <span class="n">i</span><span class="p">))</span> <span class="o">%</span> <span class="mi">10</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">digit</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="n">clearDisplay</span><span class="p">()</span>
        <span class="n">pickDigit</span><span class="p">(</span><span class="mi">3</span> <span class="o">-</span> <span class="n">i</span><span class="p">)</span>
        <span class="n">hc595_shift</span><span class="p">(</span><span class="n">number</span><span class="p">[</span><span class="n">digit</span><span class="p">])</span>
</pre></div>
</div>
</li>
<li><p>The main loop that continuously updates the display and the traffic light LEDs.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">loop</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Main loop to continuously update display and lights. &quot;&quot;&quot;</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">display</span><span class="p">()</span>
        <span class="n">lightup</span><span class="p">()</span>
</pre></div>
</div>
</li>
<li><p>Cleans up resources when the script is terminated, such as turning off LEDs and stopping the timer thread.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">destroy</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Clean up resources when the script is terminated. &quot;&quot;&quot;</span>
    <span class="k">global</span> <span class="n">timer1</span>
    <span class="n">timer1</span><span class="o">.</span><span class="n">cancel</span><span class="p">()</span>
    <span class="n">ledPinR</span><span class="o">.</span><span class="n">off</span><span class="p">()</span>
    <span class="n">ledPinG</span><span class="o">.</span><span class="n">off</span><span class="p">()</span>
    <span class="n">ledPinY</span><span class="o">.</span><span class="n">off</span><span class="p">()</span>
</pre></div>
</div>
</li>
</ol>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="pi5_3.1.6_motion_control_python.html" class="btn btn-neutral float-left" title="3.1.6 Motion Control" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="pi5_3.1.8_overheat_monitor_python.html" class="btn btn-neutral float-right" title="3.1.8 Overheat Monitor" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, SunFounder.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>