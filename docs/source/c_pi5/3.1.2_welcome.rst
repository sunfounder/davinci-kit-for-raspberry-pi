.. note::

    춰Hola! Bienvenidos a la comunidad de entusiastas de SunFounder para Raspberry Pi, Arduino y ESP32 en Facebook. Sum칠rgete en el mundo de Raspberry Pi, Arduino y ESP32 junto con otros apasionados.

    **쯇or qu칠 unirse?**

    - **Soporte de Expertos**: Soluciona problemas post-venta y desaf칤os t칠cnicos con la ayuda de nuestra comunidad y equipo.
    - **Aprende y Comparte**: Intercambia consejos y tutoriales para mejorar tus habilidades.
    - **Avances Exclusivos**: Accede anticipadamente a anuncios de nuevos productos y adelantos.
    - **Descuentos Especiales**: Disfruta de descuentos exclusivos en nuestros productos m치s recientes.
    - **Promociones y Sorteos Festivos**: Participa en sorteos y promociones especiales en d칤as festivos.

    游녤 쯃isto para explorar y crear con nosotros? Haz clic en [|link_sf_facebook|] y 칰nete hoy.

3.1.2 Bienvenida
====================

Introducci칩n
--------------

En este proyecto, utilizaremos un sensor PIR para detectar el movimiento 
de personas y, con un servo, LED y un zumbador, simularemos el funcionamiento 
de una puerta autom치tica de tienda. Cuando el peat칩n se encuentre dentro del 
rango de detecci칩n del PIR, la luz indicadora se encender치, la puerta se abrir치 
y el zumbador emitir치 el sonido de bienvenida.

Componentes
--------------

.. image:: img/list_Welcome.png
    :align: center

Diagrama de Circuito
-----------------------

============ ======== ======== ===
T-Board Name physical wiringPi BCM
GPIO18       Pin 12   1        18
GPIO17       Pin 11   0        17
GPIO27       Pin 13   2        27
GPIO22       Pin 15   3        22
============ ======== ======== ===

.. image:: img/Schematic_three_one2.png
   :align: center

Procedimientos Experimentales
--------------------------------

**Paso 1:** Construye el circuito.

.. image:: img/image239.png
    :alt: C:\Users\sunfounder\Desktop\3.1.4_Welcome_bb.png3.1.4_Welcome_bb
    :width: 800
    :align: center


**Paso 2:** Cambia al directorio.

.. raw:: html

   <run></run>

.. code-block:: 

    cd ~/davinci-kit-for-raspberry-pi/c/3.1.2/

**Paso 3:** Compila.

.. raw:: html

   <run></run>

.. code-block:: 

    gcc 3.1.2_Welcome.c -lwiringPi

**Paso 4:** Ejecuta.

.. raw:: html

   <run></run>

.. code-block:: 

    sudo ./a.out

Al ejecutar el c칩digo, si el sensor PIR detecta a alguien pasando, la puerta 
se abrir치 autom치ticamente (simulada por el servo), se encender치 el indicador 
y se reproducir치 la m칰sica de bienvenida. Al terminar la melod칤a, el sistema 
cerrar치 la puerta y apagar치 la luz indicadora, quedando listo para la pr칩xima 
detecci칩n de alguien que pase.

El m칩dulo PIR cuenta con dos potenci칩metros: uno para ajustar la sensibilidad 
y otro para ajustar la distancia de detecci칩n. Para optimizar el rendimiento 
del m칩dulo PIR, ajusta ambos potenci칩metros al m치ximo en sentido antihorario.

.. note::

    Si no funciona tras ejecutar el c칩digo, o aparece el mensaje de error: \"wiringPi.h: No such file or directory", consulta :ref:`C code is not working?`.

**Explicaci칩n del C칩digo**

.. code-block:: c

    void setAngle(int pin, int angle){    //Crear funci칩n para controlar el 치ngulo del servo.
        if(angle < 0)
            angle = 0;
        if(angle > 180)
            angle = 180;
        softPwmWrite(pin,Map(angle, 0, 180, 5, 25));   
    } 

Crea una funci칩n, setAngle, para definir el 치ngulo en el servo en un rango de 0 a 180.

.. code-block:: c

    void doorbell(){
    for(int i=0;i<sizeof(song)/4;i++){
            softToneWrite(BuzPin, song[i]); 
            delay(beat[i] * 250);
        }

Crea una funci칩n doorbell para activar el zumbador y reproducir m칰sica.

.. code-block:: c

    void closedoor(){
    digitalWrite(ledPin, LOW);   //apaga el LED
    for(int i=180;i>-1;i--){  //gira el servo desde el 치ngulo m치ximo al m칤nimo
        setAngle(servoPin,i);
        delay(1);
        }
    }

Crea una funci칩n closedoor para simular el cierre de la puerta, apagar el LED y hacer que el servo gire de 180 grados a 0 grados.

.. code-block:: c

    void opendoor(){
        digitalWrite(ledPin, HIGH);   //enciende el LED
        for(int i=0;i<181;i++){  //gira el servo desde el 치ngulo m칤nimo al m치ximo
            setAngle(servoPin,i);
            delay(1);
        }
        doorbell();
        closedoor();
    }

La funci칩n opendoor() incluye varias acciones: encender la luz indicadora, 
girar el servo (simulando la apertura de la puerta), reproducir la m칰sica de 
bienvenida de la tienda y llamar a la funci칩n closedoor() despu칠s de la m칰sica.

.. code-block:: c

        int main(void)
    {
        if(wiringPiSetup() == -1){ //si la inicializaci칩n de wiring falla, imprime mensaje en pantalla
            printf("setup wiringPi failed !");
            return 1;
        }
        if(softToneCreate(BuzPin) == -1){
            printf("setup softTone failed !");
            return 1;
    ......

En la funci칩n main(), inicializa la biblioteca wiringPi y configura softTone, 
luego establece ledPin en estado de salida y pirPin en estado de entrada. Si 
el sensor PIR detecta que alguien pasa, la funci칩n opendoor ser치 llamada para 
simular la apertura de la puerta.
