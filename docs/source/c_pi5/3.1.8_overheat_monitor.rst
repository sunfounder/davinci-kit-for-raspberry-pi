.. note::

    춰Hola! Bienvenidos a la comunidad de entusiastas de SunFounder para Raspberry Pi, Arduino y ESP32 en Facebook. Sum칠rgete en el mundo de Raspberry Pi, Arduino y ESP32 junto con otros apasionados.

    **쯇or qu칠 unirse?**

    - **Soporte de Expertos**: Soluciona problemas post-venta y desaf칤os t칠cnicos con la ayuda de nuestra comunidad y equipo.
    - **Aprende y Comparte**: Intercambia consejos y tutoriales para mejorar tus habilidades.
    - **Avances Exclusivos**: Accede anticipadamente a anuncios de nuevos productos y adelantos.
    - **Descuentos Especiales**: Disfruta de descuentos exclusivos en nuestros productos m치s recientes.
    - **Promociones y Sorteos Festivos**: Participa en sorteos y promociones especiales en d칤as festivos.

    游녤 쯃isto para explorar y crear con nosotros? Haz clic en [|link_sf_facebook|] y 칰nete hoy.

3.1.8 Monitor de Sobrecalentamiento
======================================

Introducci칩n
--------------

Podr칤as necesitar un dispositivo de monitoreo de sobrecalentamiento para 
diversas situaciones; por ejemplo, en una f치brica, donde se quiera activar 
una alarma y apagar autom치ticamente la m치quina en caso de sobrecalentamiento 
en el circuito. En esta lecci칩n, usaremos un termistor, un joystick, un zumbador, 
un LED y una pantalla LCD para crear un dispositivo inteligente de monitoreo 
de temperatura con un umbral ajustable.

Componentes
-------------

.. image:: img/list_Overheat_Monitor.png
    :align: center

.. image:: img/list_Overheat_Monitor2.png
    :align: center

Diagrama de Circuito
-----------------------

============ ======== ======== ===
T-Board Name physical wiringPi BCM
GPIO17       Pin 11   0        17
GPIO18       Pin 12   1        18
GPIO27       Pin 13   2        27
GPIO22       Pin15    3        22
GPIO23       Pin16    4        23
GPIO24       Pin18    5        24
SDA1         Pin 3             
SCL1         Pin 5             
============ ======== ======== ===

.. image:: img/Schematic_three_one8.png
   :width: 700
   :align: center

Procedimientos Experimentales
---------------------------------

**Paso 1:** Construye el circuito.

.. image:: img/image258.png
   :alt: Overheat Monitor_bb
   :width: 800

**Paso 2**: Ingresa en la carpeta del c칩digo.

.. raw:: html

   <run></run>

.. code-block:: 

    cd ~/davinci-kit-for-raspberry-pi/c/3.1.8/

**Paso 3**: Compila el c칩digo.

.. raw:: html

   <run></run>

.. code-block:: 

    gcc 3.1.8_OverheatMonitor.c -lwiringPi -lm

**Paso 4**: Ejecuta el archivo ejecutable.

.. raw:: html

   <run></run>

.. code-block:: 

    sudo ./a.out

Cuando se ejecuta el c칩digo, la temperatura actual y el umbral de alta 
temperatura (**40춿**) se muestran en la pantalla **I2C LCD1602**. Si la 
temperatura actual es mayor que el umbral, se activar치n el zumbador y el 
LED para alertar.

.. note::

    Si no funciona despu칠s de ejecutar el c칩digo, o aparece el mensaje de error: \"wiringPi.h: No such file or directory", consulta :ref:`C code is not working?`.

**Joystick**: se utiliza para ajustar el umbral de alta temperatura. 
Al mover el **Joystick** en la direcci칩n del eje X o Y, puedes subir 
o bajar el valor del umbral. Presiona el **Joystick** nuevamente para 
restablecer el umbral a su valor inicial.

**Explicaci칩n del C칩digo**

.. code-block:: c

    int많et_joystick_value(){
    먝먝먝맛char맞_val;
    먝먝먝맛char맟_val;
    먝먝먝맞_val=많et_ADC_Result(1);
    먝먝먝맟_val=많et_ADC_Result(2);
    먝먝먝말f(x_val>200){
    먝먝먝먝먝먝먝return1;
    먝먝먝맣
    먝먝먝만lse말f(x_val<50){
    먝먝먝먝먝먝먝return-1;
    먝먝먝맣
    먝먝먝만lse말f(y_val>200){
    먝먝먝먝먝먝먝return-10;
    먝먝먝맣
    먝먝먝만lse말f(y_val<50){
    먝먝먝먝먝먝먝return10;
    먝먝먝맣
    먝먝먝만lse{
    먝먝먝먝먝먝먝return0;
    먝먝먝맣
    }

Esta funci칩n lee los valores de X y Y del joystick. Si **X>200**, 
devuelve "**1**"; si **X<50**, devuelve "**-1**"; si **y>200**, 
devuelve "**-10**", y si **y<50**, devuelve "**10**".

.. code-block:: c

    void맛pper_tem_setting(){
    먝먝먝망rite(0,0,"Upperㅁdjust:");
    먝먝먝말nt맊hange=많et_joystick_value();
    먝먝먝맛pperTem=맛pperTem+맊hange;
    먝먝먝맊har맙tr[6];
    먝먝먝맙nprintf(str,3,"%d",upperTem);
    먝먝먝망rite(0,1,str);
    int맓en;
    먝맓en=맙trlen(str);
    먝먝먝망rite(len,1,"먝먝먝먝먝먝먝먝먝먝먝먝");
    먝먝먝맋elay(100);
    }

Esta funci칩n ajusta el umbral de temperatura y lo muestra en la pantalla 
I2C LCD1602.

.. code-block:: c

    double맚emperature(){
    먝먝먝맛nsigned맊har맚emp_value;
    먝먝먝맋oubleVr,Rt,맚emp,맊el,Fah;
    먝먝먝맚emp_value=많et_ADC_Result(0);
    먝먝먝Vr=5*(double)(temp_value)/255;
    먝먝먝Rt=10000*(double)(Vr)/(5-(double)(Vr));
    먝먝먝맚emp=1/(((log(Rt/10000))/3950)+(1/(273.15+25)));
    먝먝먝맊el=맚emp-273.15;
    먝먝먝Fah=맊el*1.8+32;
    먝먝먝return맊el;
    }

Esta funci칩n lee el valor anal칩gico del **CH0** (termistor) del **ADC0834** 
y lo convierte en un valor de temperatura.

.. code-block:: c

    void맔onitoring_temp(){
    먝먝먝맊har맙tr[6];
    먝먝먝맋ouble맊el=맚emperature();
    먝먝먝맙nprintf(str,6,"%.2f",cel);
    먝먝먝망rite(0,0,"Temp:");
    먝먝먝망rite(6,0,맙tr);
    먝먝먝맙nprintf(str,3,"%d",upperTem);
    먝먝먝망rite(0,1,"Upper:");
    먝먝먝망rite(7,1,맙tr);
    먝먝먝맋elay(100);
    먝먝먝말f(cel>=맛pperTem){
    먝먝먝먝먝먝먝맋igitalWrite(buzzPin,HIGH);
    먝먝먝먝먝먝먝맋igitalWrite(LedPin,HIGH);
    먝먝먝맣
    먝먝먝만lse말f(cel<맛pperTem){
    먝먝먝먝먝먝먝맋igitalWrite(buzzPin,LOW);
    먝먝먝먝먝먝먝맋igitalWrite(LedPin,LOW);
    먝먝먝맣
    }

Cuando se ejecuta el c칩digo, la temperatura actual y el umbral de alta 
temperatura (**40춿**) se muestran en la pantalla **I2C LCD1602**. Si la 
temperatura actual supera el umbral, el zumbador y el LED se activar치n 
para alertar.

.. code-block:: c

    int맔ain(void)
    {
    먝먝먝맙etup();
    먝먝먝말nt맓astState=1;
    먝먝먝말nt맙tage=0;
    먝먝먝망hile(1)
    먝먝먝맡
    먝먝먝먝먝먝먝말nt맊urrentState=맋igitalRead(Joy_BtnPin);
    먝먝먝먝먝먝먝말f(currentState==1&&맓astState==0){
    먝먝먝먝먝먝먝먝먝먝먝맙tage=(stage+1)%2;
    먝먝먝먝먝먝먝먝먝먝먝맋elay(100);
    먝먝먝먝먝먝먝먝먝먝먝맓cd_clear();
    먝먝먝먝먝먝먝맣
    먝먝먝먝먝먝먝맓astState=currentState;
    먝먝먝먝먝먝먝말f(stage==1){
    먝먝먝먝먝먝먝먝먝먝먝맛pper_tem_setting();
    먝먝먝먝먝먝먝맣
    먝먝먝먝먝먝먝만lse{
    먝먝먝먝먝먝먝먝먝먝먝맔onitoring_temp();
    먝먝먝먝먝먝먝맣
    먝먝먝맣
    먝먝먝return0;
    }

La funci칩n main() contiene el proceso completo del programa:

1) Cuando el programa comienza, el valor inicial de **stage** es **0**, 
y la temperatura actual junto con el umbral de alta temperatura **40** 
se muestran en la pantalla **I2C LCD1602**. Si la temperatura actual supera 
el umbral, se activar치n el zumbador y el LED para alertar.

2) Presiona el joystick, y **stage** pasar치 a **1**, permitiendo ajustar 
el umbral de alta temperatura. Al mover el joystick en la direcci칩n del 
eje X o Y, podr치s aumentar o disminuir el valor del umbral. Presiona el 
joystick nuevamente para restablecer el umbral al valor inicial.

