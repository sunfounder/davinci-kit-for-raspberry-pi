.. note::

    隆Hola! Bienvenido a la comunidad de entusiastas de SunFounder para Raspberry Pi, Arduino y ESP32 en Facebook. nete para profundizar en Raspberry Pi, Arduino y ESP32 junto a otros apasionados.

    **驴Por qu茅 unirte?**

    - **Soporte de Expertos**: Resuelve problemas post-venta y desaf铆os t茅cnicos con la ayuda de nuestra comunidad y equipo.
    - **Aprende y Comparte**: Intercambia consejos y tutoriales para mejorar tus habilidades.
    - **Avances Exclusivos**: Obt茅n acceso anticipado a anuncios de nuevos productos y vistas previas.
    - **Descuentos Especiales**: Disfruta de descuentos exclusivos en nuestros productos m谩s recientes.
    - **Promociones Festivas y Sorteos**: Participa en sorteos y promociones de temporada.

     驴Listo para explorar y crear con nosotros? Haz clic en [|link_sf_facebook|] y 煤nete hoy.

3.1.11 Generador de C贸digo Morse
===================================

Introducci贸n
-----------------

En esta lecci贸n, crearemos un generador de c贸digo Morse. Ingresar谩s una 
serie de letras en ingl茅s en el Raspberry Pi y aparecer谩n en forma de 
c贸digo Morse.

Componentes
---------------

.. image:: img/3.1.10.png
    :align: center

Diagrama Esquem谩tico
-----------------------

============ ======== ======== ===
T-Board Name physical wiringPi BCM
GPIO17       Pin 11   0        17
GPIO22       Pin 15   3        22
============ ======== ======== ===

.. image:: img/Schematic_three_one11.png
   :align: center

Procedimientos Experimentales
---------------------------------

**Paso 1:** Construye el circuito. (Presta atenci贸n a los polos del 
zumbador: el marcado con + es el polo positivo y el otro es el negativo.)

.. image:: img/image269.png
   :alt: Morse_bb
   :width: 800

**Para Usuarios de Lenguaje C**
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

**Paso 2**: Abre el archivo de c贸digo.

.. raw:: html

   <run></run>

.. code-block:: 

    cd ~/davinci-kit-for-raspberry-pi/c/3.1.11/

**Paso 3**: Compila el c贸digo.

.. raw:: html

   <run></run>

.. code-block:: 

    gcc 3.1.11_MorseCodeGenerator.c -lwiringPi

**Paso 4**: Ejecuta el archivo ejecutable.

.. raw:: html

   <run></run>

.. code-block:: 

    sudo ./a.out

Despu茅s de ejecutar el programa, escribe una serie de caracteres y el 
zumbador y el LED enviar谩n las se帽ales correspondientes en c贸digo Morse.

.. note::

    Si no funciona despu茅s de ejecutarlo, o aparece un mensaje de error: \"wiringPi.h: No such file or directory", consulta :ref:`C code is not working?`.

**Explicaci贸n del C贸digo**

.. code-block:: c

    structMORSE{
    charword;
    unsignedchar*code;
    };

    structMORSEmorseDict[]=
    {
    {'A',"01"},{'B',"1000"},{'C',"1010"},{'D',"100"},{'E',"0"},
    {'F',"0010"},{'G',"110"},{'H',"0000"},{'I',"00"},{'J',"0111"},
    {'K',"101"},{'L',"0100"},{'M',"11"},{'N',"10"},{'O',"111"},
    {'P',"0110"},{'Q',"1101"},{'R',"010"},{'S',"000"},{'T',"1"},
    {'U',"001"},{'V',"0001"},{'W',"011"},{'X',"1001"},{'Y',"1011"},
    {'Z',"1100"},{'1',"01111"},{'2',"00111"},{'3',"00011"},{'4',"00001"},
    {'5',"00000"},{'6',"10000"},{'7',"11000"},{'8',"11100"},{'9',"11110"},
    {'0',"11111"},{'?',"001100"},{'/',"10010"},{',',"110011"},{'.',"010101"},
    {';',"101010"},{'!',"101011"},{'@',"011010"},{':',"111000"}
    };

Esta estructura MORSE es el diccionario del c贸digo Morse y contiene los 
caracteres de la A a la Z, los n煤meros del 0 al 9 y los s铆mbolos \"?\" \"/\" \":\" \",\" \".\" \";\" \"!\" \"@\" .

.. code-block:: c

    char*lookup(charkey,structMORSE*dict,intlength)
    {
    for(inti=0;i<length;i++)
        {
            if(dict[i].word==key){
    returndict[i].code;
            }
        }    
    }

La funci贸n **lookup()** funciona como un "diccionario". Define una **clave**, 
busca en la estructura **morseDict** la palabra que coincide con **key** y 
devuelve la informaci贸n correspondiente el \"**code**\" de esa palabra.

.. code-block:: c

    voidon(){
        digitalWrite(ALedPin,HIGH);
        digitalWrite(BeepPin,HIGH);     
    }

Crea una funci贸n on() para activar el zumbador y el LED.

.. code-block:: c

    voidoff(){
        digitalWrite(ALedPin,LOW);
        digitalWrite(BeepPin,LOW);
    }

La funci贸n off() apaga el zumbador y el LED.

.. code-block:: c

    voidbeep(intdt){
        on();
        delay(dt);
        off();
        delay(dt);
    }
Define una funci贸n beep() para hacer que el zumbador y el LED emitan sonidos y
parpadeen en un intervalo determinado de **dt**.

.. code-block:: c

    voidmorsecode(char*code){
    intpause=250;
    char*point=NULL;
    intlength=sizeof(morseDict)/sizeof(morseDict[0]);
    for(inti=0;i<strlen(code);i++)
        {
    point=lookup(code[i],morseDict,length);
    for(intj=0;j<strlen(point);j++){
    if(point[j]=='0')
                {
                    beep(pause/2);
    }elseif(point[j]=='1')
                {
                    beep(pause);
                }
                delay(pause);
            }
        }
    }

La funci贸n morsecode() procesa el c贸digo Morse de los caracteres ingresados 
haciendo que el "1" del c贸digo emita sonidos o luces prolongados, mientras 
que el "0" produce sonidos o luces breves; por ejemplo, al ingresar "SOS", 
se generar谩 una se帽al con tres segmentos cortos, tres largos y luego tres cortos " 路 路 路 - - - 路 路 路 ".

.. code-block:: c

    inttoupper(intc)
    {
    if((c>='a')&&(c<='z'))
    returnc+('A'-'a');
    returnc;
    }
    char*strupr(char*str)
    {
    char*orign=str;
    for(;*str!='\0';str++)
    *str=toupper(*str);
    returnorign;
    }

Antes de codificar, debes unificar las letras en may煤sculas.

.. code-block:: c

    voidmain(){
        setup();
    char*code;
    intlength=8;
    code=(char*)malloc(sizeof(char)*length);
    while(1){
    printf("Pleaseinputthemessenger:");
            delay(100);
    scanf("%s",code);
    code=strupr(code);
    printf("%s\n",code);
            delay(100);
            morsecode(code);
        }
    }

Cuando ingreses los caracteres relevantes con el teclado, code=strupr(code) 
convertir谩 las letras ingresadas a may煤sculas.

Printf() luego imprimir谩 el texto claro en la pantalla de la computadora, 
y la funci贸n morsecode() har谩 que el zumbador y el LED emitan el c贸digo Morse.

Ten en cuenta que la longitud de los caracteres ingresados no debe exceder 
el **length** (se puede modificar).

**Para Usuarios de Lenguaje Python**
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

**Paso 2**: Abre el archivo de c贸digo.

.. raw:: html

   <run></run>

.. code-block:: 

    cd ~/davinci-kit-for-raspberry-pi/python

**Paso 3**: Ejecuta.

.. raw:: html

   <run></run>

.. code-block:: 

    sudo python3 3.1.11_MorseCodeGenerator.py

Despu茅s de ejecutar el programa, escribe una serie de caracteres y el 
zumbador y el LED enviar谩n las se帽ales correspondientes en c贸digo Morse.

**C贸digo**

.. note::

    Puedes **Modificar/Restablecer/Copiar/Ejecutar/Detener** el c贸digo a continuaci贸n. Pero antes, necesitas dirigirte a la ruta del c贸digo fuente, como ``davinci-kit-for-raspberry-pi/python``. 
    

.. code-block:: python

    import RPi.GPIO as GPIO
    import time

    BeepPin=22
    ALedPin=17

    MORSECODE = {
        'A':'01', 'B':'1000', 'C':'1010', 'D':'100', 'E':'0', 'F':'0010', 'G':'110',
        'H':'0000', 'I':'00', 'J':'0111', 'K':'101', 'L':'0100', 'M':'11', 'N':'10',
        'O':'111', 'P':'0110', 'Q':'1101', 'R':'010', 'S':'000', 'T':'1',
        'U':'001', 'V':'0001', 'W':'011', 'X':'1001', 'Y':'1011', 'Z':'1100',
        '1':'01111', '2':'00111', '3':'00011', '4':'00001', '5':'00000',
        '6':'10000', '7':'11000', '8':'11100', '9':'11110', '0':'11111',
        '?':'001100', '/':'10010', ',':'110011', '.':'010101', ';':'101010',
        '!':'101011', '@':'011010', ':':'111000',
        }

    def setup():
        GPIO.setmode(GPIO.BCM)
        GPIO.setup(BeepPin, GPIO.OUT, initial=GPIO.LOW)
        GPIO.setup(ALedPin,GPIO.OUT,initial=GPIO.LOW)

    def on():
        GPIO.output(BeepPin, 1)
        GPIO.output(ALedPin, 1)

    def off():
        GPIO.output(BeepPin, 0)
        GPIO.output(ALedPin, 0)

    def beep(dt):  # dt es el tiempo de retardo.
        on()
        time.sleep(dt)
        off()
        time.sleep(dt)

    def morsecode(code):
        pause = 0.25
        for letter in code:
            for tap in MORSECODE[letter]:
                if tap == '0':
                    beep(pause/2)
                if tap == '1':
                    beep(pause)
            time.sleep(pause)

    def main():
        while True:
            code=input("Please input the messenger:")
            code = code.upper()
            print(code)
            morsecode(code)

    def destroy():
        print("")
        GPIO.output(BeepPin, GPIO.LOW)
        GPIO.output(ALedPin, GPIO.LOW)
        GPIO.cleanup()  

    if __name__ == '__main__':
        setup()
        try:
            main()
        except KeyboardInterrupt:
            destroy()

**Explicaci贸n del C贸digo**

.. code-block:: python

    MORSECODE={
    'A':'01','B':'1000','C':'1010','D':'100','E':'0','F':'0010','G':'110',
    'H':'0000','I':'00','J':'0111','K':'101','L':'0100','M':'11','N':'10',
    'O':'111','P':'0110','Q':'1101','R':'010','S':'000','T':'1',
    'U':'001','V':'0001','W':'011','X':'1001','Y':'1011','Z':'1100',
    '1':'01111','2':'00111','3':'00011','4':'00001','5':'00000',
    '6':'10000','7':'11000','8':'11100','9':'11110','0':'11111',
    '?':'001100','/':'10010',',':'110011','.':'010101',';':'101010',
    '!':'101011','@':'011010',':':'111000',
    }

Esta estructura MORSE es el diccionario del c贸digo Morse, que contiene
los caracteres de la A a la Z, los n煤meros del 0 al 9 y los s铆mbolos \"?\" \"/\" \":\" \",\" \".\" \";\" \"!\" \"@\".

.. code-block:: python

    defon():
    GPIO.output(BeepPin,1)
    GPIO.output(ALedPin,1)

La funci贸n on() activa el zumbador y el LED.

.. code-block:: python

    defoff():
    GPIO.output(BeepPin,0)
    GPIO.output(ALedPin,0)

La funci贸n off() se utiliza para apagar el zumbador y el LED.

.. code-block:: python

    def beep(dt):   # dt es el tiempo de retardo.
        on()
        time.sleep(dt)
        off()
        time.sleep(dt)

Define una funci贸n beep() para hacer que el zumbador y el LED emitan sonidos y
parpadeen en un intervalo determinado de **dt**.

.. code-block:: python

    defmorsecode(code):
    pause=0.25
    forletterincode:
    fortapinMORSECODE[letter]:
    iftap=='0':
                    beep(pause/2)
    iftap=='1':
                    beep(pause)
            time.sleep(pause)

La funci贸n morsecode() procesa el c贸digo Morse de los caracteres ingresados 
haciendo que el "1" del c贸digo emita sonidos o luces prolongados, mientras 
que el "0" produce sonidos o luces breves; por ejemplo, al ingresar "SOS", 
se generar谩 una se帽al con tres segmentos cortos, tres largos y luego tres 
cortos " 路 路 路 - - - 路 路 路 ".

.. code-block:: python

    defmain():
    whileTrue:
    code=input("Pleaseinputthemessenger:")
    code=code.upper()
            print(code)
            morsecode(code)

Cuando ingreses los caracteres relevantes con el teclado, upper() convertir谩 
las letras ingresadas a may煤sculas.

Printf() luego imprimir谩 el texto claro en la pantalla de la computadora, y 
la funci贸n morsecode() har谩 que el zumbador y el LED emitan el c贸digo Morse.


Imagen del Fen贸meno
-----------------------

.. image:: img/image270.jpeg
   :align: center