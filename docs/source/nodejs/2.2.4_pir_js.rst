.. note::

    隆Hola! Bienvenido a la Comunidad de Entusiastas de SunFounder para Raspberry Pi, Arduino y ESP32 en Facebook. Sum茅rgete en el apasionante mundo de Raspberry Pi, Arduino y ESP32 junto a otros entusiastas.

    **驴Por qu茅 unirte?**

    - **Soporte Experto**: Resuelve problemas postventa y desaf铆os t茅cnicos con la ayuda de nuestra comunidad y equipo.
    - **Aprende y Comparte**: Intercambia consejos y tutoriales para mejorar tus habilidades.
    - **Avances Exclusivos**: Obt茅n acceso anticipado a nuevos anuncios de productos y adelantos exclusivos.
    - **Descuentos Especiales**: Disfruta de descuentos exclusivos en nuestros productos m谩s recientes.
    - **Promociones Festivas y Sorteos**: Participa en sorteos y promociones especiales de temporada.

     驴Listo para explorar y crear con nosotros? Haz clic en [|link_sf_facebook|] y 煤nete hoy mismo.

2.2.4 PIR
==========

Introducci贸n
---------------

En este proyecto, vamos a crear un dispositivo utilizando sensores 
de infrarrojos pirosensibles al cuerpo humano. Cuando alguien se 
acerque al LED, este se encender谩 autom谩ticamente. Si no hay nadie 
cerca, la luz se apagar谩. Este sensor de movimiento infrarrojo puede 
detectar la radiaci贸n infrarroja emitida por personas y animales.

Componentes
--------------

.. image:: ../img/list_2.2.4_pir2.png

Diagrama del Circuito
-------------------------

.. image:: ../img/image327.png


Procedimientos Experimentales
--------------------------------

**Paso 1:** Construye el circuito.

.. image:: ../img/image214.png

**Paso 2:** Dir铆gete a la carpeta del c贸digo.

.. raw:: html

   <run></run>

.. code-block::

    cd ~/davinci-kit-for-raspberry-pi/nodejs/

**Paso 3:** Ejecuta el c贸digo.

.. raw:: html

   <run></run>

.. code-block::

    sudo node pir.js

Despu茅s de ejecutar el c贸digo, el sensor PIR detectar谩 el entorno y har谩 
que el LED RGB emita una luz amarilla si detecta que alguien pasa cerca. 
Hay dos potenci贸metros en el m贸dulo PIR: uno para ajustar la sensibilidad 
y otro para ajustar la distancia de detecci贸n. Para optimizar el funcionamiento 
del m贸dulo PIR, ajusta estos dos potenci贸metros.

**C贸digo**

.. code-block:: js

    const Gpio = require('pigpio').Gpio;

    const pirPin = new Gpio(17, {
        mode: Gpio.INPUT,
        pullUpDown: Gpio.PUD_DOWN,
        edge: Gpio.EITHER_EDGE
    })    // el PIR est谩 conectado al pin 17

    const redPin = new Gpio(18, { mode: Gpio.OUTPUT, })
    const greenPin = new Gpio(27, { mode: Gpio.OUTPUT, })
    const bluePin = new Gpio(22, { mode: Gpio.OUTPUT, })
    //'Rojo':18, 'Verde':27, 'Azul':22

    var p_R, p_G, p_B

    // Configurar todos los LEDs como canales PWM y frecuencia a 2 kHz
    p_R = redPin.pwmFrequency(2000)
    p_G = greenPin.pwmFrequency(2000)
    p_B = bluePin.pwmFrequency(2000)

    // Todos empiezan con valor 0
    p_R.pwmWrite(0)
    p_G.pwmWrite(0)
    p_B.pwmWrite(0)

    // Definir una funci贸n MAP para mapear valores, como de 0~255 a 0~100
    function MAP(x, in_min, in_max, out_min, out_max) {
        return (x - in_min) * (out_max - out_min) / (in_max - in_min) + out_min
    }

    // Definir una funci贸n para configurar colores
    function setColor(color) {
        // Configura la luminancia de los tres LEDs seg煤n el valor del color ingresado.
        // Divide los colores de la variable 'color'
        R_val = (color & 0xFF0000) >> 16
        G_val = (color & 0x00FF00) >> 8
        B_val = (color & 0x0000FF) >> 0
        // Mapear el valor del color de 0~255 a 0~100
        R_val = MAP(R_val, 0, 255, 0, 100)
        G_val = MAP(G_val, 0, 255, 0, 100)
        B_val = MAP(B_val, 0, 255, 0, 100)

        // Asigna el valor del ciclo de trabajo mapeado al canal PWM correspondiente para ajustar la luminancia.
        p_R.pwmWrite(R_val)
        p_G.pwmWrite(G_val)
        p_B.pwmWrite(B_val)
        //print ("color_msg: R_val = %s, G_val = %s, B_val = %s"%(R_val, G_val, B_val))
    }

    pirPin.on('interrupt', (level) => {
        if (level) {
            setColor(0xFFFF00)
        }else{
            setColor(0x0000FF)
        }
    });

    process.on('SIGINT', function () {
        p_R.pwmWrite(0)
        p_G.pwmWrite(0)
        p_B.pwmWrite(0)
        process.exit();
    })

**Explicaci贸n del C贸digo**

El c贸digo de este ejemplo es una combinaci贸n de :ref:`2.1.1 Button` y :ref:`1.1.2 RGB LED`, por lo que no es necesario profundizar en los detalles.


Imagen del Fen贸meno
----------------------

.. image:: ../img/image215.jpeg
