.. note::

    ã“ã‚“ã«ã¡ã¯ã€SunFounderã®Raspberry Pi & Arduino & ESP32æ„›å¥½å®¶ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ã¸ã‚ˆã†ã“ãï¼Facebookä¸Šã§Raspberry Piã€Arduinoã€ESP32ã«ã¤ã„ã¦ã‚‚ã£ã¨æ·±ãæ˜ã‚Šä¸‹ã’ã€ä»–ã®æ„›å¥½å®¶ã¨äº¤æµã—ã¾ã—ã‚‡ã†ã€‚

    **å‚åŠ ã™ã‚‹ç†ç”±ã¯ï¼Ÿ**

    - **ã‚¨ã‚­ã‚¹ãƒ‘ãƒ¼ãƒˆã‚µãƒãƒ¼ãƒˆ**ï¼šã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ã‚„ãƒãƒ¼ãƒ ã®åŠ©ã‘ã‚’å€Ÿã‚Šã¦ã€è²©å£²å¾Œã®å•é¡Œã‚„æŠ€è¡“çš„ãªèª²é¡Œã‚’è§£æ±ºã—ã¾ã™ã€‚
    - **å­¦ã³ï¼†å…±æœ‰**ï¼šãƒ’ãƒ³ãƒˆã‚„ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã‚’äº¤æ›ã—ã¦ã‚¹ã‚­ãƒ«ã‚’å‘ä¸Šã•ã›ã¾ã—ã‚‡ã†ã€‚
    - **ç‹¬å çš„ãªãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼**ï¼šæ–°è£½å“ã®ç™ºè¡¨ã‚„å…ˆè¡Œãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã«æ—©æœŸã‚¢ã‚¯ã‚»ã‚¹ã—ã¾ã—ã‚‡ã†ã€‚
    - **ç‰¹åˆ¥å‰²å¼•**ï¼šæœ€æ–°è£½å“ã®ç‹¬å å‰²å¼•ã‚’ãŠæ¥½ã—ã¿ãã ã•ã„ã€‚
    - **ç¥­ã‚Šã®ãƒ—ãƒ­ãƒ¢ãƒ¼ã‚·ãƒ§ãƒ³ã¨ã‚®ãƒ•ãƒˆ**ï¼šã‚®ãƒ•ãƒˆã‚„ç¥æ—¥ã®ãƒ—ãƒ­ãƒ¢ãƒ¼ã‚·ãƒ§ãƒ³ã«å‚åŠ ã—ã¾ã—ã‚‡ã†ã€‚

    ğŸ‘‰ ç§ãŸã¡ã¨ä¸€ç·’ã«æ¢ç´¢ã—ã€å‰µé€ ã™ã‚‹æº–å‚™ã¯ã§ãã¦ã„ã¾ã™ã‹ï¼Ÿ[|link_sf_facebook|]ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ä»Šã™ãå‚åŠ ã—ã¾ã—ã‚‡ã†ï¼

1.2.2 ãƒ‘ãƒƒã‚·ãƒ–ãƒ–ã‚¶ãƒ¼
=====================

å‰æ›¸ã
------------

ã“ã®ãƒ¬ãƒƒã‚¹ãƒ³ã§ã¯ã€ãƒ‘ãƒƒã‚·ãƒ–ãƒ–ã‚¶ãƒ¼ã§éŸ³æ¥½ã‚’å†ç”Ÿã™ã‚‹æ–¹æ³•ã‚’å­¦ç¿’ã™ã‚‹ã€‚

éƒ¨å“
----------

.. image:: media/list_1.2.2.png

å›è·¯å›³
-----------------

ã“ã®å®Ÿé¨“ã§ã¯ã€ãƒˆãƒ©ãƒ³ã‚¸ã‚¹ã‚¿ã‚’ä¿è­·ã™ã‚‹ãŸã‚ã«ã€ãƒˆãƒ©ãƒ³ã‚¸ã‚¹ã‚¿ã®ãƒ™ãƒ¼ã‚¹ã¨GPIOã®é–“ã«ãƒ‘ãƒƒã‚·ãƒ–ãƒ–ã‚¶ãƒ¼ã€PNPãƒˆãƒ©ãƒ³ã‚¸ã‚¹ã‚¿ã€ãŠã‚ˆã³1kæŠµæŠ—å™¨ã‚’ä½¿ç”¨ã™ã‚‹ã€‚

GPIO17ã«ç•°ãªã‚‹å‘¨æ³¢æ•°ãŒä¸ãˆã‚‰ã‚Œã‚‹ã¨ã€ãƒ‘ãƒƒã‚·ãƒ–ãƒ–ã‚¶ãƒ¼ã¯ç•°ãªã‚‹éŸ³ã‚’å‡ºã™ã€‚ã“ã®ã‚ˆã†ã«ã—ã¦ã€ãƒ–ã‚¶ãƒ¼ã¯éŸ³æ¥½ã‚’å†ç”Ÿã™ã‚‹ã€‚

.. image:: media/image333.png


å®Ÿé¨“æ‰‹é †
-----------------------

ã‚¹ãƒ†ãƒƒãƒ—1ï¼š å›è·¯ã‚’ä½œã‚‹ã€‚

.. image:: media/image106.png
    :width: 800



Cè¨€èªãƒ¦ãƒ¼ã‚¶ãƒ¼å‘ã‘
^^^^^^^^^^^^^^^^^^^^

ã‚¹ãƒ†ãƒƒãƒ—2ï¼š ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’å¤‰æ›´ã™ã‚‹ã€‚

.. raw:: html

   <run></run>

.. code-block::

    cd /home/pi/davinci-kit-for-raspberry-pi/c/1.2.2/

ã‚¹ãƒ†ãƒƒãƒ—3ï¼š ã‚³ãƒ¼ãƒ‰ã‚’ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã™ã‚‹ã€‚

.. raw:: html

   <run></run>

.. code-block::

    gcc 1.2.2_PassiveBuzzer.c -lwiringPi

ã‚¹ãƒ†ãƒƒãƒ—4ï¼š å®Ÿè¡Œã€‚

.. raw:: html

   <run></run>

.. code-block::

    sudo ./a.out

ã‚³ãƒ¼ãƒ‰ãŒå®Ÿè¡Œã•ã‚Œã‚‹ã¨ã€ãƒ–ã‚¶ãƒ¼ãŒéŸ³æ¥½ã‚’å†ç”Ÿã™ã‚‹ã€‚

**ã‚³ãƒ¼ãƒ‰**

.. code-block:: c

    #include <wiringPi.h>
    #include <softTone.h>
    #include <stdio.h>

    #define BuzPin    0

    #define  CL1  131
    #define  CL2  147
    #define  CL3  165
    #define  CL4  175
    #define  CL5  196
    #define  CL6  221
    #define  CL7  248

    #define  CM1  262
    #define  CM2  294
    #define  CM3  330
    #define  CM4  350
    #define  CM5  393
    #define  CM6  441
    #define  CM7  495

    #define  CH1  525
    #define  CH2  589
    #define  CH3  661
    #define  CH4  700
    #define  CH5  786
    #define  CH6  882
    #define  CH7  990

    int song_1[] = {CM3,CM5,CM6,CM3,CM2,CM3,CM5,CM6,CH1,CM6,CM5,CM1,CM3,CM2,
                    CM2,CM3,CM5,CM2,CM3,CM3,CL6,CL6,CL6,CM1,CM2,CM3,CM2,CL7,
                    CL6,CM1,CL5};

    int beat_1[] = {1,1,3,1,1,3,1,1,1,1,1,1,1,1,3,1,1,3,1,1,1,1,1,1,1,2,1,1,
                    1,1,1,1,1,1,3};


    int song_2[] = {CM1,CM1,CM1,CL5,CM3,CM3,CM3,CM1,CM1,CM3,CM5,CM5,CM4,CM3,CM2,
                    CM2,CM3,CM4,CM4,CM3,CM2,CM3,CM1,CM1,CM3,CM2,CL5,CL7,CM2,CM1
                    };

    int beat_2[] = {1,1,1,3,1,1,1,3,1,1,1,1,1,1,3,1,1,1,2,1,1,1,3,1,1,1,3,3,2,3};

    int main(void)
    {
        int i, j;
        if(wiringPiSetup() == -1){ //when initialize wiring failed,print message to screen
            printf("setup wiringPi failed !");
            return 1;
        }

        if(softToneCreate(BuzPin) == -1){
            printf("setup softTone failed !");
            return 1;
        }

        while(1){
            printf("music is being played...\n");
            delay(100);
            for(i=0;i<sizeof(song_1)/4;i++){
                softToneWrite(BuzPin, song_1[i]);   
                delay(beat_1[i] * 500);
            }

            for(i=0;i<sizeof(song_2)/4;i++){
                softToneWrite(BuzPin, song_2[i]);   
                delay(beat_2[i] * 500);
            }   
        }

        return 0;
    }

**ã‚³ãƒ¼ãƒ‰ã®èª¬æ˜**

.. code-block:: c

    #define  CL1  131
    #define  CL2  147
    #define  CL3  165
    #define  CL4  175
    #define  CL5  196
    #define  CL6  221
    #define  CL7  248

    #define  CM1  262
    #define  CM2  294


å„éŸ³ã®å‘¨æ³¢æ•°ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«ç¤ºã—ã¦ã„ã‚‹ã€‚CLï¼ä½éŸ³ã€CMï¼ä¸­éŸ³ã€CHï¼é«˜éŸ³ã€1ï½7ã¯éŸ³Cã€Dã€Eã€Fã€Gã€Aã€Bã«å¯¾å¿œã™ã‚‹ã€‚

.. code-block:: c

    int song_1[] = {CM3,CM5,CM6,CM3,CM2,CM3,CM5,CM6,CH1,CM6,CM5,CM1,CM3,CM2,
                    CM2,CM3,CM5,CM2,CM3,CM3,CL6,CL6,CL6,CM1,CM2,CM3,CM2,CL7,
                    CL6,CM1,CL5};
    int beat_1[] = {1,1,3,1,1,3,1,1,1,1,1,1,1,1,3,1,1,3,1,1,1,1,1,1,1,2,1,1,
                    1,1,1,1,1,1,3};

é…åˆ— ``song_1[]`` ã¯æ›²ã®æ¥½è­œã‚’ä¿å­˜ã™ã‚‹ã€‚ ``beat_1[]`` ã¯æ›²ã®å„éŸ³ç¬¦ã®æ‹ã‚’è¡¨ã™ï¼ˆ1æ‹ã”ã¨ã«0.5ç§’ï¼‰ã€‚

.. code-block:: c

    if(softToneCreate(BuzPin) == -1){
            printf("setup softTone failed !");
            return 1;
        
ã“ã‚Œã«ã‚ˆã‚Šã€ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢åˆ¶å¾¡ã®ãƒˆãƒ¼ãƒ³ãƒ”ãƒ³ãŒä½œæˆã•ã‚Œã‚‹ã€‚
ä»»æ„ã®GPIOãƒ”ãƒ³ã‚’ä½¿ç”¨ã§ãã€ãƒ”ãƒ³ã®ç•ªå·ã¯ä½¿ç”¨ã—ãŸ ``wiringPiSetup()`` é–¢æ•°ã®ç•ªå·ã«ãªã‚‹ã€‚æˆåŠŸã—ãŸå ´åˆã®æˆ»ã‚Šå€¤ã¯0ã§ã‚ã‚‹ã€‚
ãã‚Œä»¥å¤–ã®å ´åˆã¯ã€ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°errnoã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ã€ä½•ãŒå•é¡Œãªã®ã‹ã‚’ç¢ºèªã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã€‚

.. code-block:: c

    for(i=0;i<sizeof(song_1)/4;i++){
        softToneWrite(BuzPin, song_1[i]);   
        delay(beat_1[i] * 500);
    }



``song_1`` ã‚’å†ç”Ÿã™ã‚‹ãŸã‚ã« ``for statement`` ã‚’ä½¿ç”¨ã™ã‚‹ã€‚

åˆ¤æ–­æ¡ä»¶ ``i<sizeof(song_1)/4`` ã§ã¯ã€ é…åˆ— ``song_1[]`` ã¯æ•´æ•°ã®ãƒ‡ãƒ¼ã‚¿å‹ã®é…åˆ—ã§ã‚ã‚Šã€å„è¦ç´ ã¯ 4 ãƒ“ãƒ¼ãƒˆã‚’å–ã‚‹ãŸã‚ã€4 ã§é™¤ç®—ã—ã¾ã™ã€‚

song_1ã®è¦ç´ ã®æ•°ï¼ˆéŸ³ç¬¦ã®æ•°ï¼‰ã¯ã€ ``sizeof(song_4)`` ã‚’4ã§å‰²ã‚‹ã“ã¨ã«ã‚ˆã£ã¦å¾—ã‚‰ã‚Œã‚‹ã€‚

å„éŸ³ç¬¦ã‚’æ‹* 500msã§å†ç”Ÿã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹ã«ã¯ã€é–¢æ•° ``delay(beat_1[i]*500)`` ãŒå‘¼ã³å‡ºã•ã‚Œã‚‹ã€‚

``softToneWrite(BuzPinã€song_1[i])`` ã®ãƒ—ãƒ­ãƒˆã‚¿ã‚¤ãƒ—ï¼š

.. code-block:: c

    void softToneWrite (int pin, int freq);

ã“ã‚Œã«ã‚ˆã‚Šã€æŒ‡å®šã•ã‚ŒãŸãƒ”ãƒ³ã®ãƒˆãƒ¼ãƒ³å‘¨æ³¢æ•°å€¤ãŒæ›´æ–°ã•ã‚Œã‚‹ã€‚å‘¨æ³¢æ•°ã‚’0ã«è¨­å®šã™ã‚‹ã¾ã§ã€ãƒˆãƒ¼ãƒ³ã®å†ç”Ÿã¯åœæ­¢ã—ãªã„ã€‚

Pythonè¨€èªãƒ¦ãƒ¼ã‚¶ãƒ¼å‘ã‘
^^^^^^^^^^^^^^^^^^^^^^^^^

ã‚¹ãƒ†ãƒƒãƒ—2ï¼šãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’å¤‰æ›´ã™ã‚‹ã€‚

.. raw:: html

   <run></run>

.. code-block::

    cd /home/pi/davinci-kit-for-raspberry-pi/python/

ã‚¹ãƒ†ãƒƒãƒ—3ï¼šå®Ÿè¡Œã™ã‚‹ã€‚

.. raw:: html

   <run></run>

.. code-block::

    sudo python3 1.2.2_PassiveBuzzer.py

ã‚³ãƒ¼ãƒ‰ãŒå®Ÿè¡Œã•ã‚Œã‚‹ã¨ã€ãƒ–ã‚¶ãƒ¼ãŒéŸ³æ¥½ã‚’å†ç”Ÿã™ã‚‹ã€‚

**ã‚³ãƒ¼ãƒ‰**


.. note::

   ä»¥ä¸‹ã®ã‚³ãƒ¼ãƒ‰ã‚’ **å¤‰æ›´/ãƒªã‚»ãƒƒãƒˆ/ã‚³ãƒ”ãƒ¼/å®Ÿè¡Œ/åœæ­¢** ã§ãã¾ã™ã€‚ ãŸã ã—ã€ãã®å‰ã«ã€ ``davinci-kit-for-raspberry-pi/python`` ã®ã‚ˆã†ãªã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ãƒ‘ã‚¹ã«ç§»å‹•ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ 
   
.. raw:: html

    <run></run>

.. code-block:: python

    import RPi.GPIO as GPIO
    import time

    Buzzer = 11

    CL = [0, 131, 147, 165, 175, 196, 211, 248]		# Frequency of Bass tone in C major

    CM = [0, 262, 294, 330, 350, 393, 441, 495]		# Frequency of Midrange tone in C major

    CH = [0, 525, 589, 661, 700, 786, 882, 990]		# Frequency of Treble tone in C major

    song_1 = [	CM[3], CM[5], CM[6], CM[3], CM[2], CM[3], CM[5], CM[6], # Notes of song1
                CH[1], CM[6], CM[5], CM[1], CM[3], CM[2], CM[2], CM[3], 
                CM[5], CM[2], CM[3], CM[3], CL[6], CL[6], CL[6], CM[1],
                CM[2], CM[3], CM[2], CL[7], CL[6], CM[1], CL[5]	]

    beat_1 = [	1, 1, 3, 1, 1, 3, 1, 1, 			# Beats of song 1, 1 means 1/8 beat
                1, 1, 1, 1, 1, 1, 3, 1, 
                1, 3, 1, 1, 1, 1, 1, 1, 
                1, 2, 1, 1, 1, 1, 1, 1, 
                1, 1, 3	]

    song_2 = [	CM[1], CM[1], CM[1], CL[5], CM[3], CM[3], CM[3], CM[1], # Notes of song2
                CM[1], CM[3], CM[5], CM[5], CM[4], CM[3], CM[2], CM[2], 
                CM[3], CM[4], CM[4], CM[3], CM[2], CM[3], CM[1], CM[1], 
                CM[3], CM[2], CL[5], CL[7], CM[2], CM[1]	]

    beat_2 = [	1, 1, 2, 2, 1, 1, 2, 2, 			# Beats of song 2, 1 means 1/8 beat
                1, 1, 2, 2, 1, 1, 3, 1, 
                1, 2, 2, 1, 1, 2, 2, 1, 
                1, 2, 2, 1, 1, 3 ]

    def setup():

        GPIO.setmode(GPIO.BOARD)		# Numbers GPIOs by physical location
        GPIO.setup(Buzzer, GPIO.OUT)	# Set pins' mode is output
        global Buzz						# Assign a global variable to replace GPIO.PWM 
        Buzz = GPIO.PWM(Buzzer, 440)	# 440 is initial frequency.
        Buzz.start(50)					# Start Buzzer pin with 50% duty cycle

    def loop():
        while True:
            print ('\n    Playing song 1...')
            for i in range(1, len(song_1)):		# Play song 1
                Buzz.ChangeFrequency(song_1[i])	# Change the frequency along the song note
                time.sleep(beat_1[i] * 0.5)		# delay a note for beat * 0.5s
            time.sleep(1)						# Wait a second for next song.

            print ('\n\n    Playing song 2...')
            for i in range(1, len(song_2)):     # Play song 1
                Buzz.ChangeFrequency(song_2[i]) # Change the frequency along the song note
                time.sleep(beat_2[i] * 0.5)     # delay a note for beat * 0.5s

    def destory():
        Buzz.stop()                 # Stop the buzzer
        GPIO.output(Buzzer, 1)      # Set Buzzer pin to High
        GPIO.cleanup()				# Release resource

    if __name__ == '__main__':		# Program start from here
        setup()
        try:
            loop()
        except KeyboardInterrupt:  	# When 'Ctrl+C' is pressed, the program destroy() will be executed.
            destory()

**ã‚³ãƒ¼ãƒ‰ã®èª¬æ˜**

.. code-block:: python

    CL = [0, 131, 147, 165, 175, 196, 211, 248]     # Frequency of Bass tone in C major
    CM = [0, 262, 294, 330, 350, 393, 441, 495]     # Frequency of Midrange tone in C major
    CH = [0, 525, 589, 661, 700, 786, 882, 990]     # Frequency of Treble tone in C major     

ã“ã‚Œã‚‰ã¯å„éŸ³ç¬¦ã®å‘¨æ³¢æ•°ã§ã‚ã‚‹ã€‚ç•ªå·1ã€œ7ãŒéŸ³è‰²ã®CDEFGABã«å¯¾å¿œã™ã‚‹ã‚ˆã†ã«ã€æœ€åˆã®0ã¯ ``CL[0]`` ã‚’ã‚¹ã‚­ãƒƒãƒ—ã™ã‚‹ã€‚

.. code-block:: python

    song_1 = [  CM[3], CM[5], CM[6], CM[3], CM[2], CM[3], CM[5], CM[6], 
                CH[1], CM[6], CM[5], CM[1], CM[3], CM[2], CM[2], CM[3],
                CM[5], CM[2], CM[3], CM[3], CL[6], CL[6], CL[6], CM[1],
                CM[2], CM[3], CM[2], CL[7], CL[6], CM[1], CL[5] ]

ã“ã‚Œã‚‰ã®é…åˆ—ã¯æ­Œã®éŸ³ç¬¦ã§ã‚ã‚‹ã€‚

.. code-block:: python

    beat_1 = [  1, 1, 3, 1, 1, 3, 1, 1, 1, 1, 1, 1, 1, 1, 3, 1,
                1, 3, 1, 1, 1, 1, 1, 1, 1, 2, 1, 1, 1, 1, 1, 1,
                1, 1, 3 ]

ã™ã¹ã¦ã®éŸ³ç¬¦ã®æ‹ï¼ˆå„ç•ªå·ï¼‰ã¯ã€â…›æ‹ã§ã€ã¤ã¾ã‚Š0.5ç§’ã‚’è¡¨ã™ã€‚

.. code-block:: python

    Buzz = GPIO.PWM(Buzzer, 440)
    Buzz.start(50)  

ãƒ”ãƒ³ãƒ–ã‚¶ãƒ¼ã‚’PWMãƒ”ãƒ³ã¨ã—ã¦å®šç¾©ã—ã€ãã®å‘¨æ³¢æ•°ã‚’440ã«è¨­å®šã—ã€ ``Buzz.start(50)`` ã‚’ä½¿ç”¨ã—ã¦PWMã‚’å®Ÿè¡Œã™ã‚‹ã€‚
ã•ã‚‰ã«ã€ãƒ‡ãƒ¥ãƒ¼ãƒ†ã‚£ã‚µã‚¤ã‚¯ãƒ«ã‚’50ï¼…ã«è¨­å®šã™ã‚‹ã€‚

.. code-block:: python

    for i in range(1, len(song_1)): 
                Buzz.ChangeFrequency(song_1[i]) 
                time.sleep(beat_1[i] * 0.5)  

for æ–‡ã‚’å®Ÿè¡Œã™ã‚‹ã¨ã€ãƒ–ã‚¶ãƒ¼ã¯é…åˆ— ``song_1[]`` ã®éŸ³ç¬¦ã‚’ ``beat_1[]`` é…åˆ—ã®æ‹ã§å†ç”Ÿã™ã‚‹ã€‚

ã“ã‚Œã§ã€ãƒ‘ãƒƒã‚·ãƒ–ãƒ–ã‚¶ãƒ¼ãŒéŸ³æ¥½ã‚’å†ç”Ÿã—ã¦ã„ã‚‹ã“ã¨ãŒèã“ãˆã‚‹ã€‚

ç¾è±¡ç”»åƒ
------------------

.. image:: media/image107.jpeg