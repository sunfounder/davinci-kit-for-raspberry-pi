.. note::

    Ciao, benvenuto nella Community di Facebook per gli appassionati di SunFounder Raspberry Pi, Arduino ed ESP32! Approfondisci le tue conoscenze su Raspberry Pi, Arduino ed ESP32 insieme ad altri appassionati.

    **PerchÃ© unirti a noi?**

    - **Supporto Esperto**: Risolvi problemi post-vendita e sfide tecniche con lâ€™aiuto della nostra community e del nostro team.
    - **Impara e Condividi**: Scambia suggerimenti e tutorial per migliorare le tue competenze.
    - **Anteprime Esclusive**: Accedi in anteprima agli annunci di nuovi prodotti e sneak peek.
    - **Sconti Speciali**: Approfitta di sconti esclusivi sui nostri prodotti piÃ¹ recenti.
    - **Promozioni e Giveaway Festivi**: Partecipa a concorsi e promozioni in occasione delle festivitÃ .

    ğŸ‘‰ Pronto a esplorare e creare con noi? Clicca su [|link_sf_facebook|] e unisciti oggi stesso!

3.1.12 GIOCO â€“ Indovina il Numero
====================================

Introduzione
---------------

"Indovina il Numero" Ã¨ un divertente gioco di societÃ  in cui tu e i tuoi 
amici inserite a turno un numero (0~99). Lâ€™intervallo di numeri si restringe 
ad ogni input fino a quando qualcuno indovina correttamente il numero segreto. 
A quel punto, il giocatore che ha dato la risposta esatta viene dichiarato 
sconfitto e â€œpunitoâ€. Per esempio, se il numero fortunato Ã¨ 51 (che i giocatori 
non conoscono) e il giocatore â‘  inserisce 50, lâ€™intervallo numerico diventa 
50~99; se il giocatore â‘¡ inserisce 70, lâ€™intervallo diventa 50~70; se il 
giocatore â‘¢ inserisce 51, questo giocatore Ã¨ quello sfortunato. In questo 
progetto, utilizziamo il tastierino per inserire i numeri e lâ€™LCD per visualizzare i risultati.

Componenti
------------

.. image:: img/list_GAME_Guess_Number.png
    :align: center

Schema di Collegamento
-------------------------

============ ======== ======== =======
T-Board Name physical wiringPi BCM
GPIO18       Pin 12   1        18
GPIO23       Pin 16   4        23
GPIO24       Pin 18   5        24
GPIO25       Pin 22   6        25
SPIMOSI      Pin 19   12       10
GPIO22       Pin 15   3        22
GPIO27       Pin 13   2        27
GPIO17       Pin 11   0        17
SDA1         Pin 3    SDA1(8)  SDA1(2)
SCL1         Pin 5    SCL1(9)  SDA1(3)
============ ======== ======== =======

.. image:: img/Schematic_three_one12.png
   :align: center

Procedure Sperimentali
--------------------------

**Passo 1:** Costruisci il circuito.

.. image:: img/image273.png
   :width: 800

**Passo 2**: Configura I2C (vedi Appendice. Se hai giÃ  configurato I2C, 
salta questo passo).

**Passo 3**: Cambia la directory.

.. raw:: html

   <run></run>

.. code-block::

    cd ~/davinci-kit-for-raspberry-pi/c/3.1.12/

**Passo 4**: Compila il codice.

.. raw:: html

   <run></run>

.. code-block::

    gcc 3.1.12_GAME_GuessNumber.c -lwiringPi

**Passo 5**: Esegui il programma.

.. raw:: html

   <run></run>

.. code-block::

    sudo ./a.out

Dopo lâ€™avvio del programma, sulla schermata LCD apparirÃ  la pagina iniziale:

.. code-block:: 

   Welcome!
   PressÂ AÂ toÂ go!

Premi 'A' per iniziare il gioco e sul display LCD apparirÃ  la schermata 
del gioco.

.. code-block:: 

   Enter number:
   0 â€¹pointâ€¹ 99

.. note::

   Se il programma non funziona o appare un messaggio di errore: \"wiringPi.h: No such file or directory", consulta :ref:`Il codice C non funziona?`.

Allâ€™avvio del gioco, viene generato un numero casuale â€œ **point** â€ che 
non appare sul display LCD, e il tuo compito Ã¨ indovinarlo. Il numero 
inserito apparirÃ  alla fine della prima riga fino a quando non sarÃ  eseguita 
la verifica finale. (Premi 'D' per iniziare la comparazione; se il numero 
inserito Ã¨ superiore a **10**, la comparazione si avvierÃ  automaticamente.)

L'intervallo del numero **point** appare sulla seconda riga, e dovrai inserire 
il numero all'interno di questo intervallo. Quando inserisci un numero, 
l'intervallo si restringe; se indovini il numero fortunato (o sfortunato), 
apparirÃ  â€œHai indovinato!â€.

**Spiegazione del Codice**

Nella parte iniziale del codice troviamo le funzioni per **keypad** e 
**I2C LCD1602**. Per ulteriori dettagli, puoi consultare **1.1.7 LCD1602 I2C** 
e **2.1.5 Tastierino.**

Ecco alcuni elementi chiave da conoscere:

.. code-block:: c

    /****************************************/
    //Inizia qui
    /****************************************/
    voidÂ init(void){
    Â Â Â Â fdÂ =Â wiringPiI2CSetup(LCDAddr);
        lcd_init();
        lcd_clear();
    Â Â Â Â for(intÂ i=0Â ;Â i<4Â ;Â i++)Â {
    Â Â Â Â Â Â Â Â pinMode(rowPins[i],Â OUTPUT);
    Â Â Â Â Â Â Â Â pinMode(colPins[i],Â INPUT);
        }
        lcd_clear();
    Â Â Â Â write(0,Â 0,Â "Welcome!");
    Â Â Â Â write(0,Â 1,Â "PressÂ AÂ toÂ go!");
    }

Questa funzione inizializza **I2C LCD1602** e **Keypad** e visualizza 
"Benvenuto!" e "Premi A per iniziare!".

.. code-block:: c

    voidÂ init_new_value(void){
        srand(time(0));
    Â Â Â Â pointValueÂ =Â rand()%100;
    Â Â Â Â upperÂ =Â 99;
    Â Â Â Â lowerÂ =Â 0;
    Â Â Â Â countÂ =Â 0;
    Â Â Â Â printf("pointÂ isÂ %d\n",pointValue);
    }

La funzione genera un numero casuale 'point' e resetta lâ€™intervallo del 
suggerimento numerico.

.. code-block:: c

    boolÂ detect_point(void){
    Â Â Â Â if(countÂ >Â pointValue){
    Â Â Â Â Â Â Â Â if(countÂ <Â upper){
    Â Â Â Â Â Â Â Â Â Â Â Â upperÂ =Â count;
            }
        }
    Â Â Â Â elseÂ if(countÂ <Â pointValue){
    Â Â Â Â Â Â Â Â if(countÂ >Â lower){
    Â Â Â Â Â Â Â Â Â Â Â Â lowerÂ =Â count;
            }
        }
    Â Â Â Â elseÂ if(countÂ =Â pointValue){
    Â Â Â Â Â Â Â Â countÂ =Â 0;
    Â Â Â Â Â Â Â Â returnÂ 1;
        }
    Â Â Â Â countÂ =Â 0;
    Â Â Â Â returnÂ 0;
    }

La funzione `detect_point()` confronta il numero inserito con â€œpointâ€. 
Se non coincidono, **count** assegna valori a **upper** e **lower** e 
restituisce '0'; in caso contrario, restituisce '1'.

.. code-block:: c

    voidÂ lcd_show_input(boolÂ result){
    Â Â Â Â charÂ *str=NULL;
    Â Â Â Â strÂ =(char*)malloc(sizeof(char)*3);
        lcd_clear();
    Â Â Â Â ifÂ (resultÂ ==Â 1){
    Â Â Â Â Â Â Â Â write(0,1,"You'veÂ gotÂ it!");
            delay(5000);
            init_new_value();
            lcd_show_input(0);
            return;
        }
    Â Â Â Â write(0,0,"EnterÂ number:");
    Â Â Â Â Int2Str(str,count);
    Â Â Â Â write(13,0,str);
    Â Â Â Â Int2Str(str,lower);
    Â Â Â Â write(0,1,str);
    Â Â Â Â write(3,1,"<Point<");
    Â Â Â Â Int2Str(str,upper);
    Â Â Â Â write(12,1,str);
    }

Questa funzione visualizza la schermata del gioco. La funzione 
**Int2Str(str,count)** converte **count**, **lower** e **upper** 
da **intero** a **stringa** per il corretto display su **lcd**.

.. code-block:: c

    intÂ main(){
    Â Â Â Â unsignedÂ charÂ pressed_keys[BUTTON_NUM];
    Â Â Â Â unsignedÂ charÂ last_key_pressed[BUTTON_NUM];
    Â Â Â Â if(wiringPiSetup()Â ==Â -1){Â //whenÂ initializeÂ wiringÂ failed,printÂ messagetoÂ screen
    Â Â Â Â Â Â Â Â printf("setupÂ wiringPiÂ failedÂ !");
    Â Â Â Â Â Â Â Â returnÂ 1;Â 
        }
        init();
        init_new_value();
        while(1){
            keyRead(pressed_keys);
    Â Â Â Â Â Â Â Â boolÂ compÂ =Â keyCompare(pressed_keys,Â last_key_pressed);
    Â Â Â Â Â Â Â Â ifÂ (!comp){
    Â Â Â Â Â Â Â Â Â Â Â Â if(pressed_keys[0]Â !=Â 0){
    Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â boolÂ resultÂ =Â 0;
    Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â if(pressed_keys[0]Â ==Â 'A'){
                        init_new_value();
                        lcd_show_input(0);
                    }
    Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â elseÂ if(pressed_keys[0]Â ==Â 'D'){
    Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â resultÂ =Â detect_point();
                        lcd_show_input(result);
                    }
    Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â elseÂ if(pressed_keys[0]Â >='0'Â &&Â pressed_keys[0]Â <=Â '9'){
    Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â countÂ =Â countÂ *Â 10;
    Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â countÂ =Â countÂ +Â (pressed_keys[0]Â -Â 48);
    Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â ifÂ (count>=10){
    Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â resultÂ =Â detect_point();
                        }
                        lcd_show_input(result);
                    }
                }
    Â Â Â Â Â Â Â Â Â Â Â Â keyCopy(last_key_pressed,Â pressed_keys);
            }
            delay(100);
        }
    Â Â Â Â returnÂ 0;Â Â Â 
    }

**main()** contiene l'intero processo del programma:

1) Inizializza **I2C LCD1602** e **Keypad**.

2) Usa **init_new_value()** per creare un numero casuale **0-99**.

3) Verifica se Ã¨ stato premuto un pulsante e ne acquisisce il valore.

4) Se viene premuto il pulsante 'A', appare un numero casuale **0-99** 
   e inizia il gioco.

5) Se viene rilevata la pressione del pulsante '**D**', il programma 
   entrerÃ  nella fase di valutazione del risultato e lo visualizzerÃ  
   sullo schermo LCD. Questo passaggio consente di verificare il risultato 
   anche inserendo solo un numero e poi premendo il pulsante '**D**'.


6) Se vengono premuti i pulsanti **0-9**, il valore di **count** cambia; 
   se **count** Ã¨ maggiore di **10**, inizia la verifica.

7) Gli aggiornamenti e i valori del gioco sono visualizzati su **LCD1602**.

