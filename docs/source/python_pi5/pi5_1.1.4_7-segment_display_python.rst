.. note::

    隆Hola! Bienvenido a la Comunidad de Entusiastas de SunFounder para Raspberry Pi, Arduino y ESP32 en Facebook. Sum茅rgete en el mundo de Raspberry Pi, Arduino y ESP32 junto a otros entusiastas.

    **驴Por qu茅 unirse?**

    - **Soporte Experto**: Resuelve problemas postventa y desaf铆os t茅cnicos con la ayuda de nuestra comunidad y equipo.
    - **Aprende y Comparte**: Intercambia consejos y tutoriales para mejorar tus habilidades.
    - **Avances Exclusivos**: Accede anticipadamente a anuncios de nuevos productos y adelantos exclusivos.
    - **Descuentos Especiales**: Aprovecha descuentos exclusivos en nuestros productos m谩s recientes.
    - **Promociones Festivas y Sorteos**: Participa en sorteos y promociones especiales.

     驴Listo para explorar y crear con nosotros? Haz clic en [|link_sf_facebook|] y 煤nete hoy mismo.

.. _1.1.4_py_pi5:

1.1.4 Pantalla de 7 Segmentos
=============================

Introducci贸n
-----------------

Vamos a aprender c贸mo controlar una pantalla de 7 segmentos para mostrar cifras del 0 al 9 y de la A a la F.

Componentes Necesarios
------------------------------

En este proyecto, necesitamos los siguientes componentes.

.. image:: ../python_pi5/img/1.1.4_7_segment_list.png

.. raw:: html

   <br/>

Diagrama de Conexiones
-------------------------

Conecta el pin ST_CP del 74HC595 al GPIO18 de Raspberry Pi, SH_CP al GPIO27 
y DS al GPIO17. Los puertos de salida paralela se conectan a los 8 segmentos 
de la pantalla de 7 segmentos LED.

Los datos se ingresan en el pin DS para el registro de desplazamiento cuando 
SH_CP (la entrada de reloj del registro de desplazamiento) est谩 en el flanco 
de subida, y se transfieren al registro de memoria cuando ST_CP (entrada de 
reloj de la memoria) tambi茅n est谩 en el flanco de subida.

Luego, puedes controlar los estados de SH_CP y ST_CP a trav茅s de los GPIOs de 
la Raspberry Pi para transformar la entrada de datos en serie en salida de datos 
en paralelo, ahorrando as铆 pines de GPIO en la Raspberry Pi para controlar la pantalla.

============ ======== ===
T-Board Name physical BCM
GPIO17       Pin 11   17
GPIO18       Pin 12   18
GPIO27       Pin 13   27
============ ======== ===

.. image:: ../python_pi5/img/1.1.4_7_segment_schematic.png


Procedimientos del Experimento
-----------------------------------

**Paso 1:** Construye el circuito.

.. image:: ../python_pi5/img/1.1.4_7-Segment_circuit.png

**Paso 2:** Accede a la carpeta del c贸digo.

.. raw:: html

   <run></run>

.. code-block::

    cd ~/davinci-kit-for-raspberry-pi/python-pi5

**Paso 3:** Ejecuta el c贸digo.

.. raw:: html

   <run></run>

.. code-block::

    sudo python3 1.1.4_7-Segment_zero.py

Despu茅s de ejecutar el c贸digo, ver谩s que la pantalla de 7 segmentos muestra del 0 al 9 y de la A a la F.

.. warning::

    Si aparece un mensaje de error ``RuntimeError: Cannot determine SOC peripheral base address``, consulta :ref:`faq_soc`

**C贸digo**

.. note::
    Puedes **Modificar/Restablecer/Copiar/Ejecutar/Detener** el c贸digo a continuaci贸n. Pero antes, debes ir a la ruta del c贸digo fuente, como ``davinci-kit-for-raspberry-pi/python-pi5``. Tras confirmar que no hay problemas, puedes copiar el c贸digo modificado, abrir el c贸digo fuente en Terminal mediante el comando ``nano`` y pegarlo.

.. raw:: html

    <run></run>

.. code-block:: python

   #!/usr/bin/env python3
   from gpiozero import OutputDevice
   from time import sleep

   # Pines GPIO conectados al registro de desplazamiento 74HC595
   SDI = OutputDevice(17)   # Entrada de datos en serie
   RCLK = OutputDevice(18)  # Entrada de reloj de memoria (Reloj de Registro)
   SRCLK = OutputDevice(27) # Reloj de Registro de Desplazamiento

   # C贸digos hexadecimales para d铆gitos en una pantalla de 7 segmentos de c谩todo com煤n
   segCode = [
       0x3f, 0x06, 0x5b, 0x4f, 0x66, 0x6d, 0x7d,
       0x07, 0x7f, 0x6f, 0x77, 0x7c, 0x39, 0x5e, 0x79, 0x71
   ]

   def hc595_shift(data):
       # Desplazar 8 bits de datos al 74HC595
       for bit in range(8):
           # Configurar SDI en alto o bajo seg煤n el bit de datos
           SDI.value = 0x80 & (data << bit)
           # Activar el reloj del registro de desplazamiento
           SRCLK.on()
           sleep(0.001)
           SRCLK.off()
       # Transferir datos a la salida activando el reloj de memoria
       RCLK.on()
       sleep(0.001)
       RCLK.off()

   def display_all_on():
       # Funci贸n para encender todos los segmentos (para una pantalla de 7 segmentos de c谩todo com煤n)
       all_on_code = 0x3f
       hc595_shift(all_on_code)
       print("Displaying all segments on")

   try:
       while True:
           # Mostrar cada d铆gito hexadecimal en la pantalla de 7 segmentos
           for code in segCode:
               hc595_shift(code)  # Desplazar el c贸digo en el 74HC595
               # Imprimir el c贸digo de segmento mostrado
               print(f"Displaying segCode[{segCode.index(code)}]: 0x{code:02X}")
               sleep(0.5)  # Pausa entre cada d铆gito

   except KeyboardInterrupt:
       # Manejar la interrupci贸n del script (por ejemplo, Ctrl+C) de forma segura
       pass


**Explicaci贸n del C贸digo**

#. Este fragmento importa las clases necesarias para el proyecto. ``OutputDevice`` de ``gpiozero`` se usa para controlar componentes de hardware conectados a pines GPIO, y ``sleep`` de ``time`` para agregar retrasos.

   .. code-block:: python

       #!/usr/bin/env python3
       from gpiozero import OutputDevice
       from time import sleep

#. SDI, RCLK y SRCLK corresponden a la Entrada de Datos en Serie, Entrada de Reloj de Memoria (Reloj de Registro) y Reloj de Registro de Desplazamiento del 74HC595.

   .. code-block:: python

       # Pines GPIO conectados al registro de desplazamiento 74HC595
       SDI = OutputDevice(17)   # Entrada de datos en serie
       RCLK = OutputDevice(18)  # Entrada de reloj de memoria (Reloj de Registro)
       SRCLK = OutputDevice(27) # Reloj de Registro de Desplazamiento

#. ``segCode`` es una matriz que contiene c贸digos hexadecimales para cada d铆gito a mostrar en la pantalla de 7 segmentos.

   .. code-block:: python

       # C贸digos hexadecimales para d铆gitos en una pantalla de 7 segmentos de c谩todo com煤n
       segCode = [
           0x3f, 0x06, 0x5b, 0x4f, 0x66, 0x6d, 0x7d,
           0x07, 0x7f, 0x6f, 0x77, 0x7c, 0x39, 0x5e, 0x79, 0x71
       ]

#. Esta funci贸n desplaza 8 bits de datos al 74HC595. Ingresa cada bit en ``SDI``, activa ``SRCLK`` para desplazar el bit y usa ``RCLK`` para transferir los datos a la salida.

   .. code-block:: python

       def hc595_shift(data):
           # Desplazar 8 bits de datos al 74HC595
           for bit in range(8):
               # Configurar SDI en alto o bajo seg煤n el bit de datos
               SDI.value = 0x80 & (data << bit)
               # Activar el reloj del registro de desplazamiento
               SRCLK.on()
               sleep(0.001)
               SRCLK.off()
           # Transferir datos a la salida activando el reloj de memoria
           RCLK.on()
           sleep(0.001)
           RCLK.off()

#. Esta funci贸n enciende todos los segmentos de la pantalla enviando un c贸digo espec铆fico a ``hc595_shift``.

   .. code-block:: python

       def display_all_on():
           # Funci贸n para encender todos los segmentos (para una pantalla de 7 segmentos de c谩todo com煤n)
           all_on_code = 0x3f
           hc595_shift(all_on_code)
           print("Displaying all segments on")

#. En el bucle principal, cada c贸digo en ``segCode`` se env铆a a la pantalla en secuencia, con una pausa entre cada uno.

   .. code-block:: python

       try:
           while True:
               # Mostrar cada d铆gito hexadecimal en la pantalla de 7 segmentos
               for code in segCode:
                   hc595_shift(code)  # Desplazar el c贸digo en el 74HC595
                   # Imprimir el c贸digo de segmento mostrado
                   print(f"Displaying segCode[{segCode.index(code)}]: 0x{code:02X}")
                   sleep(0.5)  # Pausa entre cada d铆gito

#. Esta parte del c贸digo maneja de forma segura la interrupci贸n del script (como Ctrl+C).

   .. code-block:: python

       except KeyboardInterrupt:
           # Manejar la interrupci贸n del script (por ejemplo, Ctrl+C) de forma segura
           pass

