.. note::

    ã“ã‚“ã«ã¡ã¯ã€SunFounderã®Raspberry Pi & Arduino & ESP32æ„›å¥½å®¶ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ã¸ã‚ˆã†ã“ãï¼Facebookä¸Šã§Raspberry Piã€Arduinoã€ESP32ã«ã¤ã„ã¦ã‚‚ã£ã¨æ·±ãæ˜ã‚Šä¸‹ã’ã€ä»–ã®æ„›å¥½å®¶ã¨äº¤æµã—ã¾ã—ã‚‡ã†ã€‚

    **å‚åŠ ã™ã‚‹ç†ç”±ã¯ï¼Ÿ**

    - **ã‚¨ã‚­ã‚¹ãƒ‘ãƒ¼ãƒˆã‚µãƒãƒ¼ãƒˆ**ï¼šã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ã‚„ãƒãƒ¼ãƒ ã®åŠ©ã‘ã‚’å€Ÿã‚Šã¦ã€è²©å£²å¾Œã®å•é¡Œã‚„æŠ€è¡“çš„ãªèª²é¡Œã‚’è§£æ±ºã—ã¾ã™ã€‚
    - **å­¦ã³ï¼†å…±æœ‰**ï¼šãƒ’ãƒ³ãƒˆã‚„ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã‚’äº¤æ›ã—ã¦ã‚¹ã‚­ãƒ«ã‚’å‘ä¸Šã•ã›ã¾ã—ã‚‡ã†ã€‚
    - **ç‹¬å çš„ãªãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼**ï¼šæ–°è£½å“ã®ç™ºè¡¨ã‚„å…ˆè¡Œãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã«æ—©æœŸã‚¢ã‚¯ã‚»ã‚¹ã—ã¾ã—ã‚‡ã†ã€‚
    - **ç‰¹åˆ¥å‰²å¼•**ï¼šæœ€æ–°è£½å“ã®ç‹¬å å‰²å¼•ã‚’ãŠæ¥½ã—ã¿ãã ã•ã„ã€‚
    - **ç¥­ã‚Šã®ãƒ—ãƒ­ãƒ¢ãƒ¼ã‚·ãƒ§ãƒ³ã¨ã‚®ãƒ•ãƒˆ**ï¼šã‚®ãƒ•ãƒˆã‚„ç¥æ—¥ã®ãƒ—ãƒ­ãƒ¢ãƒ¼ã‚·ãƒ§ãƒ³ã«å‚åŠ ã—ã¾ã—ã‚‡ã†ã€‚

    ğŸ‘‰ ç§ãŸã¡ã¨ä¸€ç·’ã«æ¢ç´¢ã—ã€å‰µé€ ã™ã‚‹æº–å‚™ã¯ã§ãã¦ã„ã¾ã™ã‹ï¼Ÿ[|link_sf_facebook|]ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ä»Šã™ãå‚åŠ ã—ã¾ã—ã‚‡ã†ï¼

2.2.6 MPU6050ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«
=======================


å‰æ›¸ã
------------

MPU-6050ã¯ã€ä½æ¶ˆè²»é›»åŠ›ã€ä½ã‚³ã‚¹ãƒˆã€é«˜æ€§èƒ½ãªã©ã®æ©Ÿèƒ½ã‚’å‚™ãˆãŸã‚¹ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ³ã€ã‚¿ãƒ–ãƒ¬ãƒƒãƒˆã€ã‚¦ã‚§ã‚¢ãƒ©ãƒ–ãƒ«ã‚»ãƒ³ã‚µãƒ¼å‘ã‘ã«è¨­è¨ˆã•ã‚ŒãŸä¸–ç•Œåˆã§å”¯ä¸€ã®6è»¸ç‰©æ¨™è¿½è·¡è£…ç½®ï¼ˆ3è»¸ã‚¸ãƒ£ã‚¤ãƒ­ã‚¹ã‚³ãƒ¼ãƒ—ã¨3è»¸åŠ é€Ÿåº¦ã‚»ãƒ³ã‚µãƒ¼ï¼‰ã§ã‚ã‚‹ã€‚

ã“ã®å®Ÿé¨“ã§ã¯ã€I2Cã‚’ä½¿ç”¨ã—ã¦ã€MPU6050ã®3è»¸åŠ é€Ÿåº¦ã‚»ãƒ³ã‚µãƒ¼ã¨3è»¸ã‚¸ãƒ£ã‚¤ãƒ­ã‚¹ã‚³ãƒ¼ãƒ—ã®å€¤ã‚’å–å¾—ã—ã€ç”»é¢ã«è¡¨ç¤ºã™ã‚‹ã€‚

éƒ¨å“
----------

.. image:: media/list_2.2.6.png

åŸç†
---------

**MPU6050**

MPU-6050ã¯ã€6è»¸ï¼ˆ3è»¸ã‚¸ãƒ£ã‚¤ãƒ­ã‚¹ã‚³ãƒ¼ãƒ—ã€3è»¸åŠ é€Ÿåº¦è¨ˆã‚’çµ„ã¿åˆã‚ã›ãŸï¼‰ç‰©æ¨™è¿½è·¡è£…ç½®ã§ã‚ã‚‹ã€‚

ãã®ä¸‰ã¤ã®åº§æ¨™ç³»ã¯æ¬¡ã®ã‚ˆã†ã«å®šç¾©ã•ã‚Œã‚‹ï¼š

MPU6050ã‚’ãƒ†ãƒ¼ãƒ–ãƒ«ã®ä¸Šã«å¹³ã‚‰ã«ç½®ãã€ãƒ©ãƒ™ãƒ«ã®ã‚ã‚‹é¢ãŒä¸Šå‘ãã§ã€
ã“ã®è¡¨é¢ã®ãƒ‰ãƒƒãƒˆãŒå·¦ä¸Šéš…ã«ã‚ã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚
æ¬¡ã«ã€ä¸Šå‘ãã®ç›´ç«‹æ–¹å‘ãŒãƒãƒƒãƒ—ã®zè»¸ã§ã‚ã‚‹ã€‚å·¦ã‹ã‚‰å³ã¸ã®æ–¹å‘ã¯Xè»¸ã¨è¦‹ãªã•ã‚Œã‚‹ã€‚
ã—ãŸãŒã£ã¦ã€å¾Œã‚ã‹ã‚‰å‰ã¸ã®æ–¹å‘ã¯Yè»¸ã¨ã—ã¦å®šç¾©ã•ã‚Œã‚‹ã€‚

.. image:: media/image223.png


**3-è»¸åŠ é€Ÿåº¦è¨ˆ**

åŠ é€Ÿåº¦è¨ˆã¯åŠ ãˆã‚‰ã‚ŒãŸæ©Ÿæ¢°å¿œåŠ›ã«å¿œç­”ã—ã¦é›»è·ã‚’ç”Ÿæˆã™ã‚‹ç‰¹å®šã®ææ–™ã®èƒ½åŠ›ã§ã‚ã‚‹åœ§é›»åŠ¹æœã®åŸç†ã§å‹•ä½œã™ã‚‹ã€‚

ã“ã“ã§ã€ä¸Šè¨˜ã®å†™çœŸã®ã‚ˆã†ã«ã€å°ã•ãªãƒœãƒ¼ãƒ«ã®ä¸­ã«ç›´æ–¹ä½“ã®ç®±ãŒã‚ã‚‹ã“ã¨ã‚’æƒ³åƒã—ã¦ãã ã•ã„ã€‚
ã“ã®ç®±ã®å£ã¯åœ§é›»çµæ™¶ã§ä½œã‚‰ã‚Œã¦ã„ã‚‹ã€‚ç®±ã‚’å‚¾ã‘ã‚‹ã¨ã€é‡åŠ›ã«ã‚ˆã‚Šãƒœãƒ¼ãƒ«ãŒå‚¾æ–œã®æ–¹å‘ã«ç§»å‹•ã™ã‚‹ã€‚
ãƒœãƒ¼ãƒ«ãŒè¡çªã™ã‚‹å£ã¯ã€å°ã•ãªåœ§é›»é›»æµã‚’ç”Ÿæˆã™ã‚‹ã€‚
åˆè¨ˆã§ã€ç«‹æ–¹ä½“ã«ã¯3çµ„ã®å‘ã‹ã„åˆã£ãŸå£ãŒã‚ã‚‹ã€‚
å„ãƒšã‚¢ã¯ã€3Dç©ºé–“ã®è»¸ï¼šXã€Yã€Zè»¸ã«å¯¾å¿œã™ã‚‹ã€‚
åœ§é›»å£ã‹ã‚‰ç”Ÿæˆã•ã‚Œã‚‹é›»æµã«å¿œã˜ã¦ã€å‚¾æ–œã®æ–¹å‘ã¨ãã®å¤§ãã•ã‚’æ±ºå®šã§ãã‚‹ã€‚

.. image:: media/image224.png


MPU6050ã‚’ä½¿ç”¨ã—ã¦ã€å„åº§æ¨™è»¸ã®åŠ é€Ÿåº¦ã‚’æ¤œå‡ºã§ãã‚‹ï¼ˆé™æ­¢ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—çŠ¶æ…‹ã§ã¯ã€Zè»¸ã®åŠ é€Ÿåº¦ã¯1é‡åŠ›å˜ä½ã§ã€Xè»¸ã¨Yè»¸ã¯0ã§ã‚ã‚‹ï¼‰ã€‚å‚¾æ–œã¾ãŸã¯ç„¡é‡é‡/é‡é‡è¶…éã®çŠ¶æ…‹ã«ã‚ã‚‹å ´åˆã€å¯¾å¿œã™ã‚‹æ¸¬å®šå€¤ãŒå¤‰åŒ–ã™ã‚‹ã€‚

ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã§é¸æŠã§ãã‚‹æ¸¬å®šç¯„å›²ã«ã¯ã€+/-2gã€+/-4gã€+/-8gã€ã¨å„ç²¾åº¦ã«å¯¾å¿œã™ã‚‹+/-16gï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã¯2gï¼‰ã®4ç¨®é¡ãŒã‚ã‚‹ã€‚å€¤ã®ç¯„å›²ã¯-32768ã€œ32767ã§ã‚ã‚‹ã€‚

èª­ã¿å–ã‚Šå€¤ã‚’æ¸¬å®šç¯„å›²ã«ãƒãƒƒãƒ”ãƒ³ã‚°ã™ã‚‹ã“ã¨ã«ã‚ˆã‚Šã€åŠ é€Ÿåº¦è¨ˆã®èª­ã¿å–ã‚Šå€¤ã¯åŠ é€Ÿåº¦å€¤ã«å¤‰æ›ã•ã‚Œã‚‹ã€‚

åŠ é€Ÿåº¦=ï¼ˆåŠ é€Ÿåº¦è¨ˆè»¸ã®ç”Ÿãƒ‡ãƒ¼ã‚¿ / 65536 * ãƒ•ãƒ«ã‚¹ã‚±ãƒ¼ãƒ«ã®åŠ é€Ÿåº¦ç¯„å›²ï¼‰g

Xè»¸ã‚’ä¾‹ã¨ã—ã¦ã€åŠ é€Ÿåº¦è¨ˆXè»¸ã®ç”Ÿãƒ‡ãƒ¼ã‚¿ã¯16384ã®å ´åˆã€ç¯„å›²ã‚’ +/-2gã«é¸æŠã™ã‚‹ï¼š

**Xè»¸ã«ã‚ˆã‚‹åŠ é€Ÿåº¦ = (16384 / 65536 \* 4) g**  **=1g**

**3è»¸ã‚¸ãƒ£ã‚¤ãƒ­ã‚¹ã‚³ãƒ¼ãƒ—**

ã‚¸ãƒ£ã‚¤ãƒ­ã‚¹ã‚³ãƒ¼ãƒ—ã¯ã‚³ãƒªã‚ªãƒªåŠ é€Ÿã®åŸç†ã§å‹•ä½œã™ã‚‹ã€‚
ãƒ•ã‚©ãƒ¼ã‚¯ã®ã‚ˆã†ãªæ§‹é€ ãŒã‚ã‚Šã€å¸¸ã«å‰å¾Œã«å‹•ã„ã¦ã„ã‚‹ã¨æƒ³åƒã—ã¦ãã ã•ã„ã€‚
åœ§é›»çµæ™¶ã‚’ä½¿ç”¨ã—ã¦æ‰€å®šã®ä½ç½®ã«ä¿æŒã•ã‚Œã‚‹ã€‚
ã“ã®é…ç½®ã‚’å‚¾ã‘ã‚ˆã†ã¨ã™ã‚‹ãŸã³ã«ã€çµæ™¶ã¯å‚¾æ–œã®æ–¹å‘ã«åŠ›ã‚’å—ã‘ã‚‹ã€‚
ã“ã‚Œã¯ã€å¯å‹•ãƒ•ã‚©ãƒ¼ã‚¯ã®æ…£æ€§ã®çµæœã«ã‚ˆã£ã¦å¼•ãèµ·ã“ã•ã‚Œã‚‹ã€‚
ã—ãŸãŒã£ã¦ã€çµæ™¶ã¯åœ§é›»åŠ¹æœã¨ä¸€è‡´ã—ã¦é›»æµã‚’ç”Ÿæˆã—ã€ã“ã®é›»æµã¯å¢—å¹…ã•ã‚Œã‚‹ã€‚

.. image:: media/image225.png
    :width: 800
    :align: center

ã¾ãŸã€ã‚¸ãƒ£ã‚¤ãƒ­ã‚¹ã‚³ãƒ¼ãƒ—ã«ã¯ã€+ /-250ã€+ /-500ã€+ /-1000ã€+/- 2000.è¨ˆç®—æ–¹æ³•ã¨åŠ é€Ÿã¯åŸºæœ¬çš„ã«ä¸€è²«ã—ã¦ã„ã‚‹ã€‚

èª­ã¿å–ã‚Šå€¤ã‚’è§’é€Ÿåº¦ã«å¤‰æ›ã™ã‚‹å¼ã¯æ¬¡ã®é€šã‚Šã§ã‚ã‚‹ï¼š

è§’é€Ÿåº¦=ï¼ˆã‚¸ãƒ£ã‚¤ãƒ­ã‚¹ã‚³ãƒ¼ãƒ—ã®è»¸ç”Ÿãƒ‡ãƒ¼ã‚¿/ 65536 *ãƒ•ãƒ«ã‚¹ã‚±ãƒ¼ãƒ«ã‚¸ãƒ£ã‚¤ãƒ­ã‚¹ã‚³ãƒ¼ãƒ—ã®ç¯„å›²ï¼‰Â°/ s

Xè»¸ã€ãŸã¨ãˆã°ã€åŠ é€Ÿåº¦è¨ˆã®Xè»¸ã®ç”Ÿãƒ‡ãƒ¼ã‚¿ã¯16384ã§ã€ç¯„å›²ã¯+ /-250Â°/ sã§ã‚ã‚‹ï¼š

**Xè»¸ã«ã‚ˆã‚‹è§’é€Ÿåº¦ = (16384 / 65536 \* 500)Â°/s** **=125Â°/s**

å›è·¯å›³
-----------------

MPU6050ã¯I2Cãƒã‚¹ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ã‚¤ã‚¹ã‚’ä»‹ã—ã¦ãƒã‚¤ã‚¯ãƒ­ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ã¨é€šä¿¡ã™ã‚‹ã€‚
SDA1ã¨SCL1ã‚’å¯¾å¿œã™ã‚‹ãƒ”ãƒ³ã«æ¥ç¶šã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã€‚

.. image:: media/image330.png
    :width: 600
    :align: center


å®Ÿé¨“æ‰‹é †
---------------------------

ã‚¹ãƒ†ãƒƒãƒ—1ï¼š å›è·¯ã‚’ä½œã‚‹ã€‚

.. image:: media/image227.png
    :width: 800



ã‚¹ãƒ†ãƒƒãƒ—2ï¼š :ref:`i2c_config` ï¼ˆä»˜éŒ²ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚I2Cã‚’è¨­å®šã—ã¦ã„ã‚‹å ´åˆã¯ã€ã“ã®æ‰‹é †ã‚’ã‚¹ã‚­ãƒƒãƒ—ã—ã¦ãã ã•ã„ã€‚ï¼‰

Cè¨€èªãƒ¦ãƒ¼ã‚¶ãƒ¼å‘ã‘
^^^^^^^^^^^^^^^^^^^^

ã‚¹ãƒ†ãƒƒãƒ—3ï¼š ã‚³ãƒ¼ãƒ‰ã®ãƒ•ã‚©ãƒ«ãƒ€ãƒ¼ã«å…¥ã‚‹ã€‚

.. raw:: html

   <run></run>

.. code-block::

    cd /home/pi/davinci-kit-for-raspberry-pi/c/2.2.6/

ã‚¹ãƒ†ãƒƒãƒ—4ï¼š ã‚³ãƒ¼ãƒ‰ã‚’ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã™ã‚‹ã€‚

.. raw:: html

   <run></run>

.. code-block::

    gcc 2.2.6_mpu6050.c -lwiringPi -lm

ã‚¹ãƒ†ãƒƒãƒ—5ï¼š EXEãƒ•ã‚¡ã‚¤ãƒ«ã‚’å®Ÿè¡Œã™ã‚‹ã€‚

.. raw:: html

   <run></run>

.. code-block::

    sudo ./a.out

ã‚³ãƒ¼ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ã¨ã€MPU6050ã«ã‚ˆã£ã¦èª­ã¿å–ã‚‰ã‚ŒãŸxè»¸ã€yè»¸ã®è»¢å‘è§’ã€åŠ é€Ÿåº¦ã€å„è»¸ã®è§’é€Ÿåº¦ãŒè¨ˆç®—å¾Œã«ç”»é¢ã«å…¥åŠ›ã•ã‚Œã‚‹ã€‚

**ã‚³ãƒ¼ãƒ‰**

.. code-block:: c

    #include  <wiringPiI2C.h>
    #include <wiringPi.h>
    #include  <stdio.h>
    #include  <math.h>
    int fd;
    int acclX, acclY, acclZ;
    int gyroX, gyroY, gyroZ;
    double acclX_scaled, acclY_scaled, acclZ_scaled;
    double gyroX_scaled, gyroY_scaled, gyroZ_scaled;

    int read_word_2c(int addr)
    {
    int val;
    val = wiringPiI2CReadReg8(fd, addr);
    val = val << 8;
    val += wiringPiI2CReadReg8(fd, addr+1);
    if (val >= 0x8000)
        val = -(65536 - val);
    return val;
    }

    double dist(double a, double b)
    {
    return sqrt((a*a) + (b*b));
    }

    double get_y_rotation(double x, double y, double z)
    {
    double radians;
    radians = atan2(x, dist(y, z));
    return -(radians * (180.0 / M_PI));
    }

    double get_x_rotation(double x, double y, double z)
    {
    double radians;
    radians = atan2(y, dist(x, z));
    return (radians * (180.0 / M_PI));
    }

    int main()
    {
    fd = wiringPiI2CSetup (0x68);
    wiringPiI2CWriteReg8 (fd,0x6B,0x00);//disable sleep mode 
    printf("set 0x6B=%X\n",wiringPiI2CReadReg8 (fd,0x6B));
    
    while(1) {

        gyroX = read_word_2c(0x43);
        gyroY = read_word_2c(0x45);
        gyroZ = read_word_2c(0x47);

        gyroX_scaled = gyroX / 131.0;
        gyroY_scaled = gyroY / 131.0;
        gyroZ_scaled = gyroZ / 131.0;

        //Print values for the X, Y, and Z axes of the gyroscope sensor.
        printf("My gyroX_scaled: %f\n", gyroY X_scaled);
        delay(100);
        printf("My gyroY_scaled: %f\n", gyroY Y_scaled);
        delay(100);
        printf("My gyroZ_scaled: %f\n", gyroY Z_scaled);
        delay(100);

        acclX = read_word_2c(0x3B);
        acclY = read_word_2c(0x3D);
        acclZ = read_word_2c(0x3F);

        acclX_scaled = acclX / 16384.0;
        acclY_scaled = acclY / 16384.0;
        acclZ_scaled = acclZ / 16384.0;
        
        //Print the X, Y, and Z values of the acceleration sensor.
        printf("My acclX_scaled: %f\n", acclX_scaled);
        delay(100);
        printf("My acclY_scaled: %f\n", acclY_scaled);
        delay(100);
        printf("My acclZ_scaled: %f\n", acclZ_scaled);
        delay(100);

        printf("My X rotation: %f\n", get_x_rotation(acclX_scaled, acclY_scaled, acclZ_scaled));
        delay(100);
        printf("My Y rotation: %f\n", get_y_rotation(acclX_scaled, acclY_scaled, acclZ_scaled));
        delay(100);
        
        delay(100);
    }
    return 0;
    }

**ã‚³ãƒ¼ãƒ‰ã®èª¬æ˜**

.. code-block:: c

    int read_word_2c(int addr)
    {
    int val;
    val = wiringPiI2CReadReg8(fd, addr);
    val = val << 8;
    val += wiringPiI2CReadReg8(fd, addr+1);
    if (val >= 0x8000)
        val = -(65536 - val);
    return val;
    }

MPU6050ã‹ã‚‰é€ä¿¡ã•ã‚ŒãŸã‚»ãƒ³ã‚µãƒ¼ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿å–ã‚‹ã€‚

.. code-block:: c

    double get_y_rotation(double x, double y, double z)
    {
    double radians;
    radians = atan2(x, dist(y, z));
    return -(radians * (180.0 / M_PI));
    }

Yè»¸ã®è»¢å‘è§’ã‚’å–å¾—ã™ã‚‹ã€‚

.. code-block:: c

    double get_x_rotation(double x, double y, double z)
    {
    double radians;
    radians = atan2(y, dist(x, z));
    return (radians * (180.0 / M_PI));
    }

xè»¸ã®è»¢å‘è§’ã‚’è¨ˆç®—ã™ã‚‹ã€‚

.. code-block:: c

    gyroX = read_word_2c(0x43);
    gyroY = read_word_2c(0x45);
    gyroZ = read_word_2c(0x47);

    gyroX_scaled = gyroX / 131.0;
    gyroY_scaled = gyroY / 131.0;
    gyroZ_scaled = gyroZ / 131.0;

    //Print values for the X, Y, and Z axes of the gyroscope sensor.
    printf("My gyroX_scaled: %f\n", gyroY X_scaled);
    printf("My gyroY_scaled: %f\n", gyroY Y_scaled);
    printf("My gyroZ_scaled: %f\n", gyroY Z_scaled);

ã‚¸ãƒ£ã‚¤ãƒ­ã‚»ãƒ³ã‚µãƒ¼ã®xè»¸ã€yè»¸ã€zè»¸ã®å€¤ã‚’èª­ã¿å–ã‚Šã€ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã‚’è§’é€Ÿåº¦å€¤ã«å¤‰æ›ã—ã¦ã‹ã‚‰å‡ºåŠ›ã™ã‚‹ã€‚

.. code-block:: c

    acclX = read_word_2c(0x3B);
    acclY = read_word_2c(0x3D);
    acclZ = read_word_2c(0x3F);

    acclX_scaled = acclX / 16384.0;
    acclY_scaled = acclY / 16384.0;
    acclZ_scaled = acclZ / 16384.0;
        
    //Print the X, Y, and Z values of the acceleration sensor.
    printf("My acclX_scaled: %f\n", acclX_scaled);
    printf("My acclY_scaled: %f\n", acclY_scaled);
    printf("My acclZ_scaled: %f\n", acclZ_scaled);

åŠ é€Ÿåº¦ã‚»ãƒ³ã‚µãƒ¼ã®xè»¸ã€yè»¸ã€zè»¸ã®å€¤ã‚’èª­ã¿å–ã‚Šã€ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã‚’åŠ é€Ÿé€Ÿåº¦å€¤ï¼ˆé‡åŠ›å˜ä½ï¼‰ã«å¤‰æ›ã—ã¦ã‹ã‚‰å‡ºåŠ›ã™ã‚‹ã€‚

.. code-block:: c

    printf("My X rotation: %f\n", get_x_rotation(acclX_scaled, acclY_scaled, acclZ_scaled));
    printf("My Y rotation: %f\n", get_y_rotation(acclX_scaled, acclY_scaled, acclZ_scaled));

xè»¸ã¨yè»¸ã®è»¢å‘è§’ã‚’ãƒ—ãƒªãƒ³ãƒˆã™ã‚‹ã€‚

Pythonè¨€èªãƒ¦ãƒ¼ã‚¶ãƒ¼å‘ã‘
^^^^^^^^^^^^^^^^^^^^^^^^^

ã‚¹ãƒ†ãƒƒãƒ—3ï¼š ã‚³ãƒ¼ãƒ‰ã®ãƒ•ã‚©ãƒ«ãƒ€ãƒ¼ã«å…¥ã‚‹ã€‚

.. raw:: html

   <run></run>

.. code-block::

    cd /home/pi/davinci-kit-for-raspberry-pi/python

ã‚¹ãƒ†ãƒƒãƒ—4ï¼š EXEãƒ•ã‚¡ã‚¤ãƒ«ã‚’å®Ÿè¡Œã™ã‚‹ã€‚

.. raw:: html

   <run></run>

.. code-block::

    sudo python3 2.2.6_mpu6050.py

ã‚³ãƒ¼ãƒ‰ã‚’å®Ÿè¡Œã—ã€xè»¸ã¨yè»¸ã®è»¢å‘è§’ã€åŠ é€Ÿåº¦ã¨MPU6050ã«ã‚ˆã£ã¦èª­ã¿å–ã‚‰ã‚ŒãŸå„è»¸ã®è§’é€Ÿåº¦ã¯ã€è¨ˆç®—å¾Œã«ç”»é¢ã«å…¥åŠ›ã•ã‚Œã‚‹ã€‚

**ã‚³ãƒ¼ãƒ‰**

.. note::

   ä»¥ä¸‹ã®ã‚³ãƒ¼ãƒ‰ã‚’ **å¤‰æ›´/ãƒªã‚»ãƒƒãƒˆ/ã‚³ãƒ”ãƒ¼/å®Ÿè¡Œ/åœæ­¢** ã§ãã¾ã™ã€‚ ãŸã ã—ã€ãã®å‰ã«ã€ ``davinci-kit-for-raspberry-pi/python`` ã®ã‚ˆã†ãªã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ãƒ‘ã‚¹ã«ç§»å‹•ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ 
   
.. raw:: html

    <run></run>

.. code-block:: python

    import smbus
    import math
    import time

    # Power management registers
    power_mgmt_1 = 0x6b
    power_mgmt_2 = 0x6c

    def read_byte(adr):
        return bus.read_byte_data(address, adr)

    def read_word(adr):
        high = bus.read_byte_data(address, adr)
        low = bus.read_byte_data(address, adr+1)
        val = (high << 8) + low
        return val

    def read_word_2c(adr):
        val = read_word(adr)
        if (val >= 0x8000):
            return -((65535 - val) + 1)
        else:
            return val

    def dist(a,b):
        return math.sqrt((a*a)+(b*b))

    def get_y_rotation(x,y,z):
        radians = math.atan2(x, dist(y,z))
        return -math.degrees(radians)

    def get_x_rotation(x,y,z):
        radians = math.atan2(y, dist(x,z))
        return math.degrees(radians)


    bus = smbus.SMBus(1) # or bus = smbus.SMBus(1) for Revision 2 boards
    address = 0x68       # This is the address value read via the i2cdetect command

    # Now wake the 6050 up as it starts in sleep mode
    bus.write_byte_data(address, power_mgmt_1, 0)

    while True:
        time.sleep(0.1)
        gyro_xout = read_word_2c(0x43)
        gyro_yout = read_word_2c(0x45)
        gyro_zout = read_word_2c(0x47)

        print ("gyro_xout : ", gyro_xout, " scaled: ", (gyro_xout / 131))
        print ("gyro_yout : ", gyro_yout, " scaled: ", (gyro_yout / 131))
        print ("gyro_zout : ", gyro_zout, " scaled: ", (gyro_zout / 131))

        accel_xout = read_word_2c(0x3b)
        accel_yout = read_word_2c(0x3d)
        accel_zout = read_word_2c(0x3f)

        accel_xout_scaled = accel_xout / 16384.0
        accel_yout_scaled = accel_yout / 16384.0
        accel_zout_scaled = accel_zout / 16384.0

        print ("accel_xout: ", accel_xout, " scaled: ", accel_xout_scaled)
        print ("accel_yout: ", accel_yout, " scaled: ", accel_yout_scaled)
        print ("accel_zout: ", accel_zout, " scaled: ", accel_zout_scaled)

        print ("x rotation: " , get_x_rotation(accel_xout_scaled, accel_yout_scaled, accel_zout_scaled))
        print ("y rotation: " , get_y_rotation(accel_xout_scaled, accel_yout_scaled, accel_zout_scaled))

        time.sleep(0.5)

**ã‚³ãƒ¼ãƒ‰ã®èª¬æ˜**

.. code-block:: python

    def read_word(adr):
        high = bus.read_byte_data(address, adr)
        low = bus.read_byte_data(address, adr+1)
        val = (high << 8) + low
        return val

    def read_word_2c(adr):
        val = read_word(adr)
        if (val >= 0x8000):
            return -((65535 - val) + 1)
        else:
            return val

MPU6050ã‹ã‚‰é€ä¿¡ã•ã‚ŒãŸã‚»ãƒ³ã‚µãƒ¼ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿å–ã‚‹ã€‚


.. code-block:: python

    def get_y_rotation(x,y,z):
        radians = math.atan2(x, dist(y,z))
        return -math.degrees(radians)

yè»¸ã®è»¢å‘è§’ã‚’è¨ˆç®—ã™ã‚‹ã€‚

.. code-block:: python

    def get_x_rotation(x,y,z):
        radians = math.atan2(y, dist(x,z))
        return math.degrees(radians)

xè»¸ã®è»¢å‘è§’ã‚’è¨ˆç®—ã™ã‚‹ã€‚

.. code-block:: python

    gyro_xout = read_word_2c(0x43)
    gyro_yout = read_word_2c(0x45)
    gyro_zout = read_word_2c(0x47)

    print ("gyro_xout : ", gyro_xout, " scaled: ", (gyro_xout / 131))
    print ("gyro_yout : ", gyro_yout, " scaled: ", (gyro_yout / 131))
    print ("gyro_zout : ", gyro_zout, " scaled: ", (gyro_zout / 131))

ã‚¸ãƒ£ã‚¤ãƒ­ã‚»ãƒ³ã‚µãƒ¼ã®xè»¸ã€yè»¸ã€zè»¸ã®å€¤ã‚’èª­ã¿å–ã‚Šã€ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã‚’è§’é€Ÿåº¦å€¤ã«å¤‰æ›ã—ã¦ã‹ã‚‰å‡ºåŠ›ã™ã‚‹ã€‚

.. code-block:: python

    accel_xout = read_word_2c(0x3b)
    accel_yout = read_word_2c(0x3d)
    accel_zout = read_word_2c(0x3f)

    accel_xout_scaled = accel_xout / 16384.0
    accel_yout_scaled = accel_yout / 16384.0
    accel_zout_scaled = accel_zout / 16384.0

    print ("accel_xout: ", accel_xout, " scaled: ", accel_xout_scaled)
    print ("accel_yout: ", accel_yout, " scaled: ", accel_yout_scaled)
    print ("accel_zout: ", accel_zout, " scaled: ", accel_zout_scaled)

åŠ é€Ÿåº¦ã‚»ãƒ³ã‚µãƒ¼ã®xè»¸ã€yè»¸ã€zè»¸ã®å€¤ã‚’èª­ã¿å–ã‚Šã€ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã‚’åŠ é€Ÿé€Ÿåº¦å€¤ï¼ˆé‡åŠ›å˜ä½ï¼‰ã«å¤‰æ›ã—ã¦ã‹ã‚‰å‡ºåŠ›ã™ã‚‹ã€‚

.. code-block:: python

    print ("x rotation: " , get_x_rotation(accel_xout_scaled, accel_yout_scaled, accel_zout_scaled))
    print ("y rotation: " , get_y_rotation(accel_xout_scaled, accel_yout_scaled, accel_zout_scaled))

xè»¸ã¨yè»¸ã®è»¢å‘è§’ã‚’ãƒ—ãƒªãƒ³ãƒˆã™ã‚‹ã€‚

ç¾è±¡ç”»åƒ
------------------

.. image:: media/image228.jpeg