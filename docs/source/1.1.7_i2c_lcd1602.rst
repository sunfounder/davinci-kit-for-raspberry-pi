.. note::

    隆Hola, bienvenido a la comunidad de entusiastas de SunFounder Raspberry Pi & Arduino & ESP32 en Facebook! Sum茅rgete en el mundo de Raspberry Pi, Arduino y ESP32 con otros entusiastas.

    **驴Por qu茅 unirte?**

    - **Soporte de expertos**: Resuelve problemas post-venta y desaf铆os t茅cnicos con la ayuda de nuestra comunidad y equipo.
    - **Aprende y comparte**: Intercambia consejos y tutoriales para mejorar tus habilidades.
    - **Acceso exclusivo**: Obt茅n acceso anticipado a nuevos anuncios de productos y adelantos.
    - **Descuentos especiales**: Disfruta de descuentos exclusivos en nuestros productos m谩s recientes.
    - **Promociones festivas y sorteos**: Participa en sorteos y promociones especiales de temporada.

     驴Listo para explorar y crear con nosotros? Haz clic en [|link_sf_facebook|] y 煤nete hoy mismo.

1.1.7 I2C LCD1602
====================

Introducci贸n
---------------

El LCD1602 es una pantalla de cristal l铆quido de tipo car谩cter, que 
puede mostrar 32 caracteres (16*2) al mismo tiempo.

Componentes
--------------

.. image:: img/list_i2c_lcd.png

Principio
-------------

**LCD1602 I2C**

.. image:: img/i2c_lcd1602.png
    :width: 800

* **GND**: Tierra
* **VCC**: Fuente de voltaje, 5V.
* **SDA**: L铆nea de datos serial. Conectar a VCC mediante una resistencia pull-up.
* **SCL**: L铆nea de reloj serial. Conectar a VCC mediante una resistencia pull-up.

Como sabemos, aunque las pantallas LCD y otras enriquecen la interacci贸n hombre-m谩quina, comparten una debilidad com煤n: al conectarse a un controlador, ocupan m煤ltiples pines de E/S, limitando otras funciones del controlador.

Por ello, el LCD1602 con un m贸dulo I2C se desarroll贸 para resolver este problema. El m贸dulo I2C tiene un chip I2C PCF8574 incorporado que convierte datos seriales I2C en datos paralelos para el LCD.

* `PCF8574 Datasheet <https://www.ti.com/lit/ds/symlink/pcf8574.pdf?ts=1627006546204&ref_url=https%253A%252F%252Fwww.google.com%252F>`_

**Direcci贸n I2C**

La direcci贸n predeterminada es generalmente 0x27, aunque en algunos casos puede ser 0x3F.

Tomando la direcci贸n predeterminada de 0x27 como ejemplo, la direcci贸n del dispositivo se puede modificar uniendo los pines A0/A1/A2; en el estado predeterminado, A0/A1/A2 est谩n en 1, y si el pin se une, A0/A1/A2 est谩n en 0.

.. image:: img/i2c_address.jpg
    :width: 600

**Retroiluminaci贸n/Contraste**

La retroiluminaci贸n se puede habilitar con un puente (jumper cap); quita el puente para desactivar la retroiluminaci贸n. El potenci贸metro azul en la parte posterior se usa para ajustar el contraste (la relaci贸n entre el blanco m谩s brillante y el negro m谩s oscuro).

.. image:: img/back_lcd1602.jpg

* **Puente de conexi贸n**: La retroiluminaci贸n se puede activar con este puente; al retirarlo, la retroiluminaci贸n se desactiva.
* **Potenci贸metro**: Se usa para ajustar el contraste (la claridad del texto mostrado), que aumenta en direcci贸n de las agujas del reloj y disminuye en sentido contrario.

Diagrama Esquem谩tico
------------------------

============ ========
T-Board Name physical
SDA1         Pin 3
SCL1         Pin 5
============ ========

.. image:: img/schematic_i2c_lcd.png

Procedimientos Experimentales
-------------------------------

**Paso 1:** Construye el circuito.

.. image:: img/image96.png
    :width: 800

**Paso 2**: Configura I2C (consulta :ref:`i2c_config`. Si ya has configurado I2C, omite este paso.)

Para Usuarios de Lenguaje C
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

**Paso 3:** Cambia de directorio.

.. raw:: html

   <run></run>

.. code-block::

    cd ~/davinci-kit-for-raspberry-pi/c/1.1.7/

**Paso 4:** Compila.

.. raw:: html

   <run></run>

.. code-block::

    gcc 1.1.7_Lcd1602.c -lwiringPi

**Paso 5:** Ejecuta.

.. raw:: html

   <run></run>

.. code-block::

    sudo ./a.out

Despu茅s de ejecutar el c贸digo, ver谩s "Greetings","From SunFounder" en el LCD.

.. note::

    * Si aparece un error ``wiringPi.h: No such file or directory``, consulta :ref:`install_wiringpi`.
    * Si obtienes ``Unable to open I2C device: No such file or directory``, consulta :ref:`i2c_config` para habilitar I2C y verificar que el cableado sea correcto.
    * Si el c贸digo y el cableado est谩n correctos pero el LCD no muestra contenido, ajusta el potenci贸metro en la parte posterior para aumentar el contraste.

**C贸digo**

.. code-block:: c

    #include <stdio.h>
    #include <wiringPi.h>
    #include <wiringPiI2C.h>
    #include <string.h>

    int LCDAddr = 0x27;
    int BLEN = 1;
    int fd;

    void write_word(int data){
        int temp = data;
        if ( BLEN == 1 )
            temp |= 0x08;
        else
            temp &= 0xF7;
        wiringPiI2CWrite(fd, temp);
    }

    void send_command(int comm){
        int buf;
        // Enviar bits 7-4 primero
        buf = comm & 0xF0;
        buf |= 0x04;			// RS = 0, RW = 0, EN = 1
        write_word(buf);
        delay(2);
        buf &= 0xFB;			// Hacer EN = 0
        write_word(buf);

        // Enviar bits 3-0 despu茅s
        buf = (comm & 0x0F) << 4;
        buf |= 0x04;			// RS = 0, RW = 0, EN = 1
        write_word(buf);
        delay(2);
        buf &= 0xFB;			// Hacer EN = 0
        write_word(buf);
    }

    void send_data(int data){
        int buf;
        // Enviar bits 7-4 primero
        buf = data & 0xF0;
        buf |= 0x05;			// RS = 1, RW = 0, EN = 1
        write_word(buf);
        delay(2);
        buf &= 0xFB;			// Hacer EN = 0
        write_word(buf);

        // Enviar bits 3-0 despu茅s
        buf = (data & 0x0F) << 4;
        buf |= 0x05;			// RS = 1, RW = 0, EN = 1
        write_word(buf);
        delay(2);
        buf &= 0xFB;			// Hacer EN = 0
        write_word(buf);
    }

    void init(){
        send_command(0x33);	// Inicializar en modo de 8 l铆neas primero
        delay(5);
        send_command(0x32);	// Luego inicializar en modo de 4 l铆neas
        delay(5);
        send_command(0x28);	// 2 L铆neas y puntos 5*7
        delay(5);
        send_command(0x0C);	// Activar pantalla sin cursor
        delay(5);
        send_command(0x01);	// Limpiar pantalla
        wiringPiI2CWrite(fd, 0x08);
    }

    void clear(){
        send_command(0x01);	// Limpiar pantalla
    }

    void write(int x, int y, char data[]){
        int addr, i;
        int tmp;
        if (x < 0)  x = 0;
        if (x > 15) x = 15;
        if (y < 0)  y = 0;
        if (y > 1)  y = 1;

        // Mover cursor
        addr = 0x80 + 0x40 * y + x;
        send_command(addr);
        
        tmp = strlen(data);
        for (i = 0; i < tmp; i++){
            send_data(data[i]);
        }
    }


    void main(){
        fd = wiringPiI2CSetup(LCDAddr);
        init();
        write(0, 0, "Greetings!");
        write(1, 1, "From SunFounder");
    }

**Explicaci贸n del C贸digo**

.. code-block::

    void write_word(int data){}
    void send_command(int comm){}
    void send_data(int data){}
    void init(){}
    void clear(){}
    void write(int x, int y, char data[]){}

Estas funciones se utilizan para controlar el c贸digo fuente abierto del I2C LCD1602. Nos permiten usar f谩cilmente el I2C LCD1602.
Entre estas funciones, init() se utiliza para la inicializaci贸n, clear() para limpiar la pantalla, write() para escribir lo que se muestra, y las dem谩s funciones brindan soporte a las anteriores.

.. code-block:: c

    fd = wiringPiI2CSetup(LCDAddr);

Esta funci贸n inicializa el sistema I2C con el dispositivo especificado. La funci贸n tiene el siguiente prototipo:

.. code-block:: c

    int wiringPiI2CSetup(int devId);

El par谩metro devId es la direcci贸n del dispositivo I2C, que se puede encontrar a trav茅s del comando i2cdetect (ver el Ap茅ndice). Generalmente, el devId del I2C LCD1602 es 0x27.

.. code-block:: c

    void write(int x, int y, char data[]){}

En esta funci贸n, data[] es el car谩cter que se imprimir谩 en el LCD, y los par谩metros x e y determinan la posici贸n de impresi贸n (la l铆nea y+1, columna x+1 es la posici贸n inicial del car谩cter a imprimir).

Para Usuarios de Python
^^^^^^^^^^^^^^^^^^^^^^^^^^^^

**Paso 3:** Cambiar de directorio.

.. raw:: html

   <run></run>

.. code-block::

    cd ~/davinci-kit-for-raspberry-pi/python/

**Paso 4:** Ejecutar.

.. raw:: html

   <run></run>

.. code-block::

    sudo python3 1.1.7_Lcd1602.py

Despu茅s de ejecutar el c贸digo, puedes ver \"Saludos\",\"De SunFounder\" en el LCD.

.. note::

    * Si obtienes el error ``FileNotFoundError: [Errno 2] No such file or directory: '/dev/i2c-1'``, debes consultar :ref:`i2c_config` para habilitar el I2C.
    * Si obtienes el error ``ModuleNotFoundError: No module named 'smbus2'``, por favor ejecuta ``sudo pip3 install smbus2``.
    * Si aparece el error ``OSError: [Errno 121] Remote I/O``, significa que el m贸dulo est谩 mal conectado o est谩 da帽ado.
    * Puedes intentar ajustar el potenci贸metro en la parte posterior si el c贸digo y el cableado est谩n correctos, pero el LCD a煤n no muestra el contenido.

**C贸digo**

.. note::

    Puedes **Modificar/Restablecer/Copiar/Ejecutar/Detener** el c贸digo a continuaci贸n. Antes de eso, debes ir a la ruta del c贸digo fuente como ``davinci-kit-for-raspberry-pi/python``. 

.. raw:: html

    <run></run>

.. code-block:: python

    import LCD1602
    import time

    def setup():
        LCD1602.init(0x27, 1)	# init(direcci贸n del esclavo, luz de fondo)
        LCD1602.write(0, 0, 'Greetings!!')
        LCD1602.write(1, 1, 'from SunFounder')
        time.sleep(2)

    def destroy():
        LCD1602.clear()

    if __name__ == "__main__":
        try:
            setup()
        except KeyboardInterrupt:
            destroy()

**Explicaci贸n del C贸digo**

.. code-block:: python

    import LCD1602

Este archivo es un archivo de c贸digo abierto para controlar el I2C LCD1602. Nos permite usar f谩cilmente el I2C LCD1602.

.. code-block:: python

    LCD1602.init(0x27, 1) 

La funci贸n inicializa el sistema I2C con el dispositivo designado. El primer par谩metro es la direcci贸n del dispositivo I2C, que se puede detectar a trav茅s del comando i2cdetect (consulta el Ap茅ndice para m谩s detalles). Generalmente, la direcci贸n del I2C LCD1602 es 0x27.

.. code-block:: python

    LCD1602.write(0, 0, 'Greetings!!')

Dentro de esta funci贸n, \'隆Saludos!\' es el texto que se imprimir谩 en la fila 0+1, columna 0+1 en el LCD.
Ahora puedes ver \"隆Saludos! De SunFounder\" en el LCD.

Imagen del Fen贸meno
--------------------------

.. image:: img/image97.jpeg
