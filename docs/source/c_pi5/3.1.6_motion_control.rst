.. note::

    춰Hola! Bienvenidos a la comunidad de entusiastas de SunFounder para Raspberry Pi, Arduino y ESP32 en Facebook. Sum칠rgete en el mundo de Raspberry Pi, Arduino y ESP32 junto con otros apasionados.

    **쯇or qu칠 unirse?**

    - **Soporte de Expertos**: Soluciona problemas post-venta y desaf칤os t칠cnicos con la ayuda de nuestra comunidad y equipo.
    - **Aprende y Comparte**: Intercambia consejos y tutoriales para mejorar tus habilidades.
    - **Avances Exclusivos**: Accede anticipadamente a anuncios de nuevos productos y adelantos.
    - **Descuentos Especiales**: Disfruta de descuentos exclusivos en nuestros productos m치s recientes.
    - **Promociones y Sorteos Festivos**: Participa en sorteos y promociones especiales en d칤as festivos.

    游녤 쯃isto para explorar y crear con nosotros? Haz clic en [|link_sf_facebook|] y 칰nete hoy.

3.1.6 Control de Movimiento
=============================

Introducci칩n
--------------

En esta lecci칩n, crearemos un dispositivo simple de detecci칩n y control 
de movimiento. El MPU6050 se usa como sensor y el motor paso a paso como 
dispositivo controlado. Con el MPU6050 montado en un guante, podr치s controlar 
el motor paso a paso girando tu mu침eca.

Componentes
-------------

.. image:: img/list_Motion_Control.png
    :align: center

Diagrama de Circuito
-----------------------

============ ======== ======== ===
T-Board Name physical wiringPi BCM
GPIO18       Pin 12   1        18
GPIO23       Pin 16   4        23
GPIO24       Pin 18   5        24
GPIO25       Pin 22   6        25
SDA1         Pin 3             
SCL1         Pin 5             
============ ======== ======== ===

.. image:: img/Schematic_three_one6.png
   :align: center

Procedimientos Experimentales
-------------------------------

**Paso 1:** Construye el circuito.

.. image:: img/image251.png
   :alt: 3.1.6 Motion Control_bb
   :width: 800
   :align: center


**Paso 2**: Dir칤gete a la carpeta del c칩digo.

.. raw:: html

   <run></run>

.. code-block:: 

    cd ~/davinci-kit-for-raspberry-pi/c/3.1.6/

**Paso 3**: Compila el c칩digo.

.. raw:: html

   <run></run>

.. code-block:: 

    gcc 3.1.6_MotionControl.c -lwiringPi -lm

**Paso 4**: Ejecuta el archivo ejecutable.

.. raw:: html

   <run></run>

.. code-block:: 

    sudo ./a.out

Cuando se ejecuta el c칩digo, si el 치ngulo de inclinaci칩n de **mpu6050** en 
el eje `Y <https://cn.bing.com/dict/search?q=Y&FORM=BDVSP6&mkt=zh-cn>`__-`axis <https://cn.bing.com/dict/search?q=axis&FORM=BDVSP6&mkt=zh-cn>`__ es mayor a **45** 춿, el motor paso a paso rota en sentido 
antihorario; si es menor a **-45** 춿, el motor rota en sentido horario.

.. note::

    Si no funciona despu칠s de ejecutar el c칩digo, o aparece el mensaje de error: \"wiringPi.h: No such file or directory", consulta :ref:`C code is not working?`.


**Explicaci칩n del C칩digo**

.. code-block:: c

    double맔pu6050(){
    먝먝먝마cclX=read_word_2c(0x3B);
    먝먝먝마cclY=read_word_2c(0x3D);
    먝먝먝마cclZ=read_word_2c(0x3F);
    먝먝먝마cclX_scaled=마cclX/16384.0;
    먝먝먝마cclY_scaled=마cclY/16384.0;
    먝먝먝마cclZ_scaled=마cclZ/16384.0;
    먝먝먝맋ouble마ngle=get_y_rotation(acclX_scaled,마cclY_scaled,마cclZ_scaled);
    먝먝먝return마ngle;
    }

mpu6050 obtiene el 치ngulo de inclinaci칩n en la direcci칩n del eje Y.

.. code-block:: c

    voidrotary(char맋irection){
    먝먝먝말f(direction=='c'){
    먝먝먝먝먝먝먝맍or(int맑=0;j<4;j++){
    먝먝먝먝먝먝먝먝먝먝먝맍or(int말=0;i<4;i++)
    먝먝먝먝먝먝먝먝먝먝먝먝먝먝먝맡digitalWrite(motorPin[i],0x99>>j&(0x08>>i));}
    먝먝먝먝먝먝먝먝먝먝먝맋elayMicroseconds(stepSpeed);
    먝먝먝먝먝먝먝맣먝먝먝먝먝먝먝
    먝먝먝맣
    먝먝먝만lse말f(direction=='a'){
    먝먝먝먝먝먝먝맍or(int맑=0;j<4;j++){
    먝먝먝먝먝먝먝먝먝먝먝맍or(int말=0;i<4;i++)
    먝먝먝먝먝먝먝먝먝먝먝먝먝먝먝맡digitalWrite(motorPin[i],0x99<<j&(0x80>>i));}
    먝먝먝먝먝먝먝먝먝먝먝맋elayMicroseconds(stepSpeed);
    먝먝먝먝먝먝먝맣먝먝
    먝먝먝맣
    }

Si la direcci칩n **key** recibida es \'**c**\', el motor paso a paso rota 
en sentido horario; si la **key** es \'**a**\', el motor rota en sentido 
antihorario. Consulta :ref:`1.3.3 Motor Paso a Paso` para m치s detalles sobre 
el c치lculo de la direcci칩n de rotaci칩n del motor paso a paso.

.. code-block:: c

    int맔ain()
    {
    먝먝먝맙etup();
    먝먝먝맋ouble마ngle;
    먝먝먝망hile(1)맡
    먝먝먝먝먝먝먝마ngle=맔pu6050();
    먝먝먝먝먝먝먝말f(angle>=45){rotary('a');}
    먝먝먝먝먝먝먝만lse말f(angle<=-45){rotary('c');}
    먝먝먝맣
    먝먝먝return0;
    }

El 치ngulo de inclinaci칩n en la direcci칩n del eje Y se lee desde **mpu6050**. 
Si es mayor a **45** 춿, el motor paso a paso rota en sentido antihorario; 
si es menor a **-45** 춿, el motor rota en sentido horario.

