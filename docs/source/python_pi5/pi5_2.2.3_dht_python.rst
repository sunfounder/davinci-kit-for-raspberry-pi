.. note::

    ã“ã‚“ã«ã¡ã¯ã€SunFounderã®Raspberry Pi & Arduino & ESP32æ„›å¥½å®¶ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ã¸ã‚ˆã†ã“ãï¼Facebookä¸Šã§Raspberry Piã€Arduinoã€ESP32ã«ã¤ã„ã¦ã‚‚ã£ã¨æ·±ãæ˜ã‚Šä¸‹ã’ã€ä»–ã®æ„›å¥½å®¶ã¨äº¤æµã—ã¾ã—ã‚‡ã†ã€‚

    **å‚åŠ ã™ã‚‹ç†ç”±ã¯ï¼Ÿ**

    - **ã‚¨ã‚­ã‚¹ãƒ‘ãƒ¼ãƒˆã‚µãƒãƒ¼ãƒˆ**ï¼šã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ã‚„ãƒãƒ¼ãƒ ã®åŠ©ã‘ã‚’å€Ÿã‚Šã¦ã€è²©å£²å¾Œã®å•é¡Œã‚„æŠ€è¡“çš„ãªèª²é¡Œã‚’è§£æ±ºã—ã¾ã™ã€‚
    - **å­¦ã³ï¼†å…±æœ‰**ï¼šãƒ’ãƒ³ãƒˆã‚„ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã‚’äº¤æ›ã—ã¦ã‚¹ã‚­ãƒ«ã‚’å‘ä¸Šã•ã›ã¾ã—ã‚‡ã†ã€‚
    - **ç‹¬å çš„ãªãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼**ï¼šæ–°è£½å“ã®ç™ºè¡¨ã‚„å…ˆè¡Œãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã«æ—©æœŸã‚¢ã‚¯ã‚»ã‚¹ã—ã¾ã—ã‚‡ã†ã€‚
    - **ç‰¹åˆ¥å‰²å¼•**ï¼šæœ€æ–°è£½å“ã®ç‹¬å å‰²å¼•ã‚’ãŠæ¥½ã—ã¿ãã ã•ã„ã€‚
    - **ç¥­ã‚Šã®ãƒ—ãƒ­ãƒ¢ãƒ¼ã‚·ãƒ§ãƒ³ã¨ã‚®ãƒ•ãƒˆ**ï¼šã‚®ãƒ•ãƒˆã‚„ç¥æ—¥ã®ãƒ—ãƒ­ãƒ¢ãƒ¼ã‚·ãƒ§ãƒ³ã«å‚åŠ ã—ã¾ã—ã‚‡ã†ã€‚

    ğŸ‘‰ ç§ãŸã¡ã¨ä¸€ç·’ã«æ¢ç´¢ã—ã€å‰µé€ ã™ã‚‹æº–å‚™ã¯ã§ãã¦ã„ã¾ã™ã‹ï¼Ÿ[|link_sf_facebook|]ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ä»Šã™ãå‚åŠ ã—ã¾ã—ã‚‡ã†ï¼

.. _2.2.3_py_pi5:

2.2.3 DHT-11
================

ã¯ã˜ã‚ã«
--------------

ã“ã®ãƒ¬ãƒƒã‚¹ãƒ³ã§ã¯ã€ãƒ©ã‚ºãƒ™ãƒªãƒ¼ãƒ‘ã‚¤ã‚’ä½¿ç”¨ã—ã¦DHT11æ¸©æ¹¿åº¦ã‚»ãƒ³ã‚µã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿å–ã‚‹æ–¹æ³•ã‚’å­¦ã³ã¾ã™ã€‚ã‚»ãƒ³ã‚µãƒ¼ã®è¨­å®šã€æ‘‚æ°åŠã³è¯æ°ã§ã®æ¸©åº¦èª­ã¿å–ã‚Šã€æ¹¿åº¦ã®å–å¾—æ–¹æ³•ã«ã¤ã„ã¦èª¬æ˜ã—ã¾ã™ã€‚ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã¯ã€å¤–éƒ¨ã‚»ãƒ³ã‚µãƒ¼ã®ä½¿ç”¨ã€ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒ‡ãƒ¼ã‚¿ã®å–ã‚Šæ‰±ã„ã€Pythonã«ãŠã‘ã‚‹åŸºæœ¬çš„ãªä¾‹å¤–å‡¦ç†ã«ã¤ã„ã¦å­¦ã¶ã“ã¨ãŒã§ãã¾ã™ã€‚

å¿…è¦ãªéƒ¨å“
------------------------------

ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«ã¯ä»¥ä¸‹ã®éƒ¨å“ãŒå¿…è¦ã§ã™ã€‚

.. image:: ../img/list_2.2.3_dht-11.png

å›è·¯å›³
-----------------

.. image:: ../img/image326.png

å®Ÿé¨“æ‰‹é †
-----------------------

**ã‚¹ãƒ†ãƒƒãƒ— 1:** å›è·¯ã‚’çµ„ã¿ç«‹ã¦ã¾ã™ã€‚

.. image:: ../img/image207.png

**ã‚¹ãƒ†ãƒƒãƒ— 2:** ã‚³ãƒ¼ãƒ‰ã®ãƒ•ã‚©ãƒ«ãƒ€ã«ç§»å‹•ã—ã¾ã™ã€‚

.. raw:: html

   <run></run>

.. code-block::

    cd ~/davinci-kit-for-raspberry-pi/python-pi5

**ã‚¹ãƒ†ãƒƒãƒ— 4:** EXEãƒ•ã‚¡ã‚¤ãƒ«ã‚’å®Ÿè¡Œã™ã‚‹ã€‚

.. raw:: html

   <run></run>

.. code-block::

    sudo python3 2.2.3_DHT.py

ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’å®Ÿè¡Œã™ã‚‹ã¨ã€DHT11ã«ã‚ˆã£ã¦æ¤œå‡ºã•ã‚ŒãŸæ¸©åº¦ã¨æ¹¿åº¦ãŒã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ç”»é¢ã«è¡¨ç¤ºã•ã‚Œã¾ã™ã€‚

**ã‚³ãƒ¼ãƒ‰**

.. note::

    ä¸‹è¨˜ã®ã‚³ãƒ¼ãƒ‰ã‚’ **å¤‰æ›´/ãƒªã‚»ãƒƒãƒˆ/ã‚³ãƒ”ãƒ¼/å®Ÿè¡Œ/åœæ­¢** ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ãŸã ã—ã€ãã®å‰ã« ``davinci-kit-for-raspberry-pi/python-pi5`` ã®ã‚ˆã†ãªã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã®ãƒ‘ã‚¹ã«ç§»å‹•ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ã‚³ãƒ¼ãƒ‰ã‚’å¤‰æ›´ã—ãŸå¾Œã€ç›´æ¥å®Ÿè¡Œã—ã¦åŠ¹æœã‚’ç¢ºèªã§ãã¾ã™ã€‚

.. raw:: html

    <run></run>

.. code-block:: python

   from gpiozero import OutputDevice, InputDevice
   import time

   class DHT11():
      MAX_DELAY_COUINT = 100
      BIT_1_DELAY_COUNT = 10
      BITS_LEN = 40

      def __init__(self, pin, pull_up=False):
         self._pin = pin
         self._pull_up = pull_up


      def read_data(self):
         bit_count = 0
         delay_count = 0
         bits = ""

         # -------------- send start --------------
         gpio = OutputDevice(self._pin)
         gpio.off()
         time.sleep(0.02)

         gpio.close()
         gpio = InputDevice(self._pin, pull_up=self._pull_up)

         # -------------- wait response --------------
         while gpio.value == 1:
               pass
         
         # -------------- read data --------------
         while bit_count < self.BITS_LEN:
               while gpio.value == 0:
                  pass

               # st = time.time()
               while gpio.value == 1:
                  delay_count += 1
                  # break
                  if delay_count > self.MAX_DELAY_COUINT:
                     break
               if delay_count > self.BIT_1_DELAY_COUNT:
                  bits += "1"
               else:
                  bits += "0"

               delay_count = 0
               bit_count += 1

         # -------------- verify --------------
         humidity_integer = int(bits[0:8], 2)
         humidity_decimal = int(bits[8:16], 2)
         temperature_integer = int(bits[16:24], 2)
         temperature_decimal = int(bits[24:32], 2)
         check_sum = int(bits[32:40], 2)

         _sum = humidity_integer + humidity_decimal + temperature_integer + temperature_decimal

         if check_sum != _sum:
               humidity = 0.0
               temperature = 0.0
         else:
               humidity = float(f'{humidity_integer}.{humidity_decimal}')
               temperature = float(f'{temperature_integer}.{temperature_decimal}')

         # -------------- return --------------
         return humidity, temperature


   if __name__ == '__main__':
      dht11 = DHT11(17)
      while True:
         humidity, temperature = dht11.read_data()
         print(f"{time.time():.3f}  temperature:{temperature}Â°C  humidity: {humidity}%")
         time.sleep(2)


**ã‚³ãƒ¼ãƒ‰ã®èª¬æ˜**

.. code-block:: python

      def read_data(self):
         bit_count = 0
         delay_count = 0
         bits = ""

         # -------------- send start --------------
         gpio = OutputDevice(self._pin)
         gpio.off()
         time.sleep(0.02)

         gpio.close()
         gpio = InputDevice(self._pin, pull_up=self._pull_up)
         #...

ã“ã®é–¢æ•°ã¯DHT11ã®é–¢æ•°ã‚’å®Ÿè£…ã™ã‚‹ãŸã‚ã«ä½¿ç”¨ã•ã‚Œã‚‹ã€‚ãã‚Œã¯æ¤œå‡ºã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã‚’ ``bits[]`` é…åˆ—ã«ä¿å­˜ã™ã‚‹ã€‚
DHT11ã¯ä¸€åº¦ã«40ãƒ“ãƒƒãƒˆã®ãƒ‡ãƒ¼ã‚¿ã‚’ç‚¹ç¯ã™ã‚‹ã€‚
æœ€åˆã®16ãƒ“ãƒƒãƒˆã¯æ¹¿åº¦ã«é–¢é€£ã—ã€ä¸­å¤®ã®16ãƒ“ãƒƒãƒˆã¯æ¸©åº¦ã«é–¢é€£ã—ã€æœ€å¾Œã®8ãƒ“ãƒƒãƒˆã¯æ¤œè¨¼ã«ä½¿ç”¨ã•ã‚Œã‚‹ã€‚
ãƒ‡ãƒ¼ã‚¿å½¢å¼ã¯æ¬¡ã®ã¨ãŠã‚Šã§ã‚ã‚‹ï¼š

8ãƒ“ãƒƒãƒˆæ¹¿åº¦æ•´æ•°ãƒ‡ãƒ¼ã‚¿ +8ãƒ“ãƒƒãƒˆæ¹¿åº¦10é€²ãƒ‡ãƒ¼ã‚¿ +8ãƒ“ãƒƒãƒˆæ¸©åº¦æ•´æ•°ãƒ‡ãƒ¼ã‚¿ + 8ãƒ“ãƒƒãƒˆæ¸©åº¦10é€²ãƒ‡ãƒ¼ã‚¿ + 8ãƒ“ãƒƒãƒˆãƒã‚§ãƒƒã‚¯ãƒ“ãƒƒãƒˆã€‚

ãƒã‚§ãƒƒã‚¯ãƒ“ãƒƒãƒˆã‚’ä»‹ã—ã¦æœ‰åŠ¹æ€§ãŒæ¤œå‡ºã•ã‚Œã‚‹ã¨ã€é–¢æ•°ã¯2ã¤ã®çµæœã‚’è¿”ã™ï¼š1. ã‚¨ãƒ©ãƒ¼; 2.æ¹¿åº¦ã¨æ¸©åº¦ã€‚

.. code-block:: python

      _sum = humidity_integer + humidity_decimal + temperature_integer + temperature_decimal

      if check_sum != _sum:
            humidity = 0.0
            temperature = 0.0
      else:
            humidity = float(f'{humidity_integer}.{humidity_decimal}')
            temperature = float(f'{temperature_integer}.{temperature_decimal}')

ãŸã¨ãˆã°ã€å—ä¿¡ã—ãŸæ—¥ä»˜ãŒ00101011ï¼ˆæ¹¿åº¦æ•´æ•°ã®8ãƒ“ãƒƒãƒˆå€¤ï¼‰00000000ï¼ˆæ¹¿åº¦10é€²æ•°ã®8ãƒ“ãƒƒãƒˆå€¤ï¼‰00111100ï¼ˆæ¸©åº¦æ•´æ•°ã®8ãƒ“ãƒƒãƒˆå€¤ï¼‰00000000ï¼ˆæ¸©åº¦10é€²æ•°ã®8ãƒ“ãƒƒãƒˆå€¤ï¼‰01100111ï¼ˆãƒã‚§ãƒƒã‚¯ãƒ“ãƒƒãƒˆï¼‰ã®å ´åˆ

**è¨ˆç®—:**

00101011+00000000+00111100+00000000=01100111.

æœ€çµ‚çµæœãŒãƒã‚§ãƒƒã‚¯ãƒ“ãƒƒãƒˆãƒ‡ãƒ¼ã‚¿ã¨ç­‰ã—ã„å ´åˆã€ãƒ‡ãƒ¼ã‚¿é€ä¿¡ã¯ç•°å¸¸ã§ã‚ã‚‹ï¼šFalseã‚’è¿”ã™ã€‚

æœ€çµ‚çµæœãŒãƒã‚§ãƒƒã‚¯ãƒ“ãƒƒãƒˆãƒ‡ãƒ¼ã‚¿ã¨ç­‰ã—ãã€å—ä¿¡ãƒ‡ãƒ¼ã‚¿ã¯æ­£ã—ã„å ´åˆã€
``humidity`` ã¨ ``temperature`` ãŒè¿”ã•ã‚Œã€ã€ŒHumidity = 43ï¼…ã€Temperature= 60Cã€ãŒå‡ºåŠ›ã•ã‚Œã‚‹ã€‚
