.. note::

    隆Hola! Bienvenido a la Comunidad de Entusiastas de SunFounder para Raspberry Pi, Arduino y ESP32 en Facebook. Sum茅rgete en el mundo de Raspberry Pi, Arduino y ESP32 junto a otros entusiastas.

    **驴Por qu茅 unirte?**

    - **Soporte Experto**: Resuelve problemas postventa y desaf铆os t茅cnicos con la ayuda de nuestra comunidad y equipo.
    - **Aprende y Comparte**: Intercambia consejos y tutoriales para mejorar tus habilidades.
    - **Avances Exclusivos**: Obt茅n acceso anticipado a nuevos anuncios de productos y adelantos exclusivos.
    - **Descuentos Especiales**: Disfruta de descuentos exclusivos en nuestros productos m谩s recientes.
    - **Promociones Festivas y Sorteos**: Participa en sorteos y promociones especiales de temporada.

     驴Listo para explorar y crear con nosotros? Haz clic en [|link_sf_facebook|] y 煤nete hoy mismo.

2.2.5M贸dulo Sensor Ultras贸nico
=================================

Introducci贸n
---------------

El sensor ultras贸nico utiliza ondas ultras贸nicas para detectar objetos 
con precisi贸n y medir distancias. Emite ondas ultras贸nicas y las convierte 
en se帽ales electr贸nicas.

Componentes
-------------
.. image:: ../img/list_2.2.5.png

Diagrama del Circuito
-------------------------

.. image:: ../img/image329.png


Procedimientos Experimentales
---------------------------------

**Paso 1:** Construye el circuito.

.. image:: ../img/image220.png

**Paso 2:** Dir铆gete a la carpeta del c贸digo.

.. raw:: html

   <run></run>

.. code-block::

    cd ~/davinci-kit-for-raspberry-pi/nodejs/

**Paso 3:** Ejecuta el c贸digo.

.. raw:: html

   <run></run>

.. code-block::

    sudo node ultrasonic_sensor.js

Despu茅s de ejecutar el c贸digo, el m贸dulo de sensor ultras贸nico detectar谩 la 
distancia entre el obst谩culo y el propio m贸dulo, y el valor de la distancia 
se imprimir谩 en la pantalla.

**C贸digo**

.. code-block:: js

    const Gpio = require('pigpio').Gpio;

    // N煤mero de microsegundos que tarda el sonido en viajar 1 cm a 20 grados Celsius
    const MICROSECDONDS_PER_CM = 1e6/34321;

    const trigger = new Gpio(23, {mode: Gpio.OUTPUT});
    const echo = new Gpio(24, {mode: Gpio.INPUT, alert: true});

    trigger.digitalWrite(0); // Asegura que el trigger est茅 bajo

    const watchHCSR04 = () => {
      let startTick;

      echo.on('alert', (level, tick) => {
        if (level === 1) {
          startTick = tick;
        } else {
          const endTick = tick;
          const diff = (endTick >> 0) - (startTick >> 0); // Aritm茅tica de 32 bits sin signo
          console.log(diff / 2 / MICROSECDONDS_PER_CM);
        }
      });
    };

    watchHCSR04();

    // Activa la medici贸n de distancia una vez por segundo
    setInterval(() => {
      trigger.trigger(10, 1); // Configura el trigger en alto durante 10 microsegundos
    }, 1000);




**Explicaci贸n del C贸digo**

La funci贸n ``trigger`` se utiliza para generar un pulso en un GPIO, 
y ``alerts`` para determinar el tiempo de cambio de estado de un GPIO 
con precisi贸n de unos microsegundos.

Estas dos caracter铆sticas se pueden combinar para medir distancias 
utilizando el sensor ultras贸nico HC-SR04.

.. code-block:: js

    setInterval(() => {
      trigger.trigger(10, 1); // Configura el trigger en alto durante 10 microsegundos
    }, 1000);

Esto env铆a un pulso ultras贸nico de 10 microsegundos peri贸dicamente.

.. code-block:: js

  const watchHCSR04 = () => {

    echo.on('alert', (level, tick) => {
        if (level === 1) {
          startTick = tick;
        } else {
          const endTick = tick;
          const diff = (endTick >> 0) - (startTick >> 0); // Aritm茅tica de 32 bits sin signo
          console.log(diff / 2 / MICROSECDONDS_PER_CM);
        }    
    });
  };

Esta funci贸n configura una alerta que registrar谩 el tiempo entre el env铆o 
del pulso (nivel 1) y la recepci贸n del eco (nivel 0). Multiplicando la 
diferencia de tiempo por la velocidad del sonido (y dividiendo por 2), 
se obtiene la distancia al obst谩culo.

.. https://github.com/fivdi/pigpio

Imagen del Fen贸meno
----------------------

.. image:: ../img/image221.jpeg
